<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MSWRPVHBQF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MSWRPVHBQF');
    </script>
    
	<!-- Primary Meta Tags -->
		<title>Free Financial Calculators 2025 - Loan, Mortgage, Investment & Retirement Tools</title>
		<meta name="title" content="Free Financial Calculators 2025 - Loan, Mortgage, Investment & Retirement Tools">
		<meta name="description" content="Professional financial calculators with live data: loan amortization schedules, mortgage payment breakdown, investment ROI projections, salary tax calculator, retirement planning tools. 100% free, no signup required.">
		<meta name="keywords" content="financial calculator 2025, free loan calculator with amortization, mortgage payment calculator, investment return calculator, compound interest calculator, retirement savings calculator, salary after tax calculator, budget planner tool, currency converter live rates, inflation calculator purchasing power, APR calculator, debt payoff calculator, 401k calculator, financial planning tools">
		<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
		<meta name="language" content="English">
		<meta name="author" content="RapidPercent">
		<link rel="canonical" href="https://rapidpercent.com/financial-calculators.html">

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website">
		<meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="RapidPercent">
		<meta property="og:url" content="https://rapidpercent.com/financial-calculators.html">
		<meta property="og:title" content="Free Financial Calculators 2025 - Professional Money Management Tools">
		<meta property="og:description" content="Calculate loans, mortgages, investments, retirement savings & more. Live exchange rates, progressive tax brackets, compound interest visualization. Trusted by 100,000+ users monthly.">
		<meta property="og:image" content="https://rapidpercent.com/og-image.png">
		<meta property="og:image:width" content="1200">
		<meta property="og:image:height" content="630">
		<meta property="og:image:alt" content="RapidPercent Financial Calculators Suite">

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image">
		<meta property="twitter:url" content="https://rapidpercent.com/financial-calculators.html">
		<meta property="twitter:title" content="2025 Financial Calculators: Free Loan, Mortgage & Investment Tools | RapidPercent">
		<meta property="twitter:description" content="Free 2025 financial calculators: Loan amortization, mortgage planning, investment ROI, salary breakdown, retirement projections. Real-time data & charts.">
		<meta property="twitter:image" content="https://rapidpercent.com/twitter-image.png">

		<!-- Additional SEO Meta Tags for Rich Results -->
		<meta name="rating" content="General">
		<meta name="distribution" content="Global">
		<meta name="revisit-after" content="7 days">
		<meta name="format-detection" content="telephone=no">

<!-- Breadcrumb Schema for SEO -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://rapidpercent.com"
    },{
        "@type": "ListItem",
        "position": 2,
        "name": "Financial Calculators",
        "item": "https://rapidpercent.com/financial-calculators.html"
    }]
}
</script>

<!-- FAQ Schema for Rich Snippets -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [{
        "@type": "Question",
        "name": "How accurate are these financial calculators?",
        "acceptedAnswer": {
            "@type": "Answer",
            "text": "Our calculators use industry-standard financial formulas and real-time data (for currency conversion). Loan and mortgage calculations follow standard amortization formulas used by banks. Tax calculations use current federal brackets but are estimates only."
        }
    },{
        "@type": "Question",
        "name": "Are these financial calculators free to use?",
        "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, all 10 financial calculators are completely free with no registration required. We support the site through ethical advertising while keeping all tools accessible to everyone."
        }
    },{
        "@type": "Question",
        "name": "Can I save or print my calculations?",
        "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, each calculator has a Print button that generates a printer-friendly version of your results including detailed breakdowns and amortization schedules."
        }
    }]
}
</script>
    
    <!-- Theme -->
    <meta name="theme-color" content="#2dd4bf">
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Chart.js will be lazy loaded when first chart is needed -->
    
    <!-- JSON-LD Structured Data -->
	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "WebApplication",
		"name": "RapidPercent Financial Calculators",
		"url": "https://rapidpercent.com/financial-calculators.html",
		"description": "Professional financial calculator suite with real-time data including loan amortization, mortgage payment breakdown, investment ROI analyzer, salary tax calculator, retirement planner, car loan calculator, credit card payoff strategy, budget tracker, live currency converter, and inflation calculator.",
		"applicationCategory": "FinanceApplication",
		"operatingSystem": "Web Browser",
		"browserRequirements": "Requires JavaScript. Works on Chrome, Firefox, Safari, Edge.",
		"offers": {
			"@type": "Offer",
			"price": "0",
			"priceCurrency": "USD"
		},
		"creator": {
			"@type": "Organization",
			"name": "RapidPercent",
			"url": "https://rapidpercent.com"
		},
		"aggregateRating": {
			"@type": "AggregateRating",
			"ratingValue": "4.8",
			"ratingCount": "2847",
			"bestRating": "5",
			"worstRating": "1"
		},
		"featureList": [
			"Loan calculator with full amortization schedule",
			"Mortgage calculator with 15-year vs 30-year comparison",
			"Investment return calculator with compound interest visualization",
			"Salary calculator with 2025 federal tax brackets",
			"Retirement savings calculator with inflation adjustment",
			"Car loan calculator with 20/4/10 rule validation",
			"Credit card payoff calculator with debt spiral detection",
			"Budget calculator with 50/30/20 rule analysis",
			"Currency converter with real-time exchange rates",
			"Inflation calculator with purchasing power analysis"
		],
		"screenshot": "https://rapidpercent.com/og-image.png",
		"softwareVersion": "2.1",
		"datePublished": "2024-01-15",
		"dateModified": "2025-01-20"
	}
	</script>

	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "SoftwareApplication",
		"name": "Loan Calculator",
		"applicationCategory": "FinanceApplication",
		"operatingSystem": "Any",
		"offers": {
			"@type": "Offer",
			"price": "0"
		},
		"description": "Calculate loan payments with full amortization schedule. See principal vs interest breakdown for any loan amount, rate, and term."
	}
	</script>

	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "SoftwareApplication",
		"name": "Mortgage Calculator",
		"applicationCategory": "FinanceApplication",
		"operatingSystem": "Any",
		"offers": {
			"@type": "Offer",
			"price": "0"
		},
		"description": "Calculate monthly mortgage payments with PMI detection. Compare 15-year vs 30-year loans. Visualize payment breakdown with interactive charts."
	}
	</script>

	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "SoftwareApplication",
		"name": "Investment Calculator",
		"applicationCategory": "FinanceApplication",
		"operatingSystem": "Any",
		"offers": {
			"@type": "Offer",
			"price": "0"
		},
		"description": "Calculate investment returns with compound interest. Project portfolio growth with monthly contributions. Year-by-year breakdown included."
	}
	</script>

	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "Organization",
		"name": "RapidPercent",
		"url": "https://rapidpercent.com",
		"logo": "https://rapidpercent.com/images/favicon.png",
		"sameAs": [
			"https://twitter.com/rapidpercent",
			"https://facebook.com/rapidpercent"
		],
		"contactPoint": {
			"@type": "ContactPoint",
			"contactType": "Customer Support",
			"email": "support@rapidpercent.com"
		}
	}
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 25%, #0d9488 50%, #0f766e 75%, #134e4a 100%);
            --secondary: linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 25px 50px -12px rgba(45, 212, 191, 0.25);
            --text: #0f172a;
            --text-light: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(45, 212, 191, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(20, 184, 166, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(13, 148, 136, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 0 0 32px 32px;
            padding: 40px 0;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: visible;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(45, 212, 191, 0.8), transparent);
        }

        .header h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 900;
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 30%, rgba(255, 255, 255, 0.95) 70%, rgba(255, 255, 255, 0.85) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
            filter: drop-shadow(0 1px 3px rgba(255, 255, 255, 0.2));
            backdrop-filter: blur(2px);
        }

        .header .tagline {
            text-align: center;
            color: var(--text-light);
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            font-weight: 400;
            opacity: 0.95;
            margin-bottom: 8px;
        }

        .header .subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            font-weight: 300;
            opacity: 0.85;
        }

        .calculator-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 50px;
            margin-bottom: 50px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .calculator-section::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 32px;
            padding: 1px;
            background: var(--secondary);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: subtract;
            -webkit-mask-composite: destination-out;
        }

        .section-title {
            text-align: center;
            background: var(--secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: clamp(1.8rem, 4vw, 2.2rem);
            font-weight: 800;
            margin-bottom: 15px;
        }

        .section-description {
            text-align: center;
            color: var(--text-light);
            font-size: clamp(1rem, 2vw, 1.1rem);
            font-weight: 400;
            opacity: 0.9;
            margin-bottom: 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .calculator-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 8px 15px;
            text-align: center;
            color: var(--text-light);
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
            font-weight: 500;
            opacity: 0.95;
            margin-bottom: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 20px rgba(45, 212, 191, 0.1);
        }

        .calculator-list span {
            display: inline-block;
            padding: 6px 12px;
            background: transparent;
            border-radius: 8px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .calculator-list span:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .calculator-list span:not(:last-child)::after {
			content: "\2022";  /* Unicode bullet point */
			margin-left: 15px;
			opacity: 0.6;
			font-weight: 300;
		}

        @media (max-width: 768px) {
            .calculator-list {
                flex-direction: column;
                gap: 6px;
                padding: 15px;
            }
            
            .calculator-list span:not(:last-child)::after {
                display: none;
            }
            
            .calculator-list span {
                width: 100%;
                text-align: center;
            }
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
        }

        .calc-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(45, 212, 191, 0.1);
            transition: all 0.4s ease;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        .calc-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 32px 40px -8px rgba(45, 212, 191, 0.2);
        }

        .calc-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary);
            border-radius: 24px 24px 0 0;
        }

        .calc-card h3 {
            color: var(--text);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            background: var(--secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #475569;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(45, 212, 191, 0.2);
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            outline: none;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: #2dd4bf;
            box-shadow: 0 0 0 4px rgba(45, 212, 191, 0.1);
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.95);
        }

        .input-group input.error {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        .error-message {
            color: #dc2626;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
            display: none;
        }

        .calculating-indicator {
            display: none;
            text-align: center;
            color: #059669;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .result {
            background: var(--secondary);
            color: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 25px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(45, 212, 191, 0.3);
            position: relative;
            overflow: hidden;
        }

        .result::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: resultShimmer 4s infinite;
        }

        .result-detailed {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(45, 212, 191, 0.3);
            color: var(--text);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .result-detailed h4 {
            color: #0d9488;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(45, 212, 191, 0.1);
        }

        .result-row:last-child {
            border-bottom: none;
            font-weight: 700;
            color: #0d9488;
            font-size: 1.05rem;
            padding-top: 12px;
            margin-top: 8px;
            border-top: 2px solid rgba(45, 212, 191, 0.3);
        }

        .amortization-schedule {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(45, 212, 191, 0.3);
            border-radius: 16px;
            padding: 15px;
        }

        .amortization-schedule table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .amortization-schedule th {
            background: var(--secondary);
            color: white;
            padding: 10px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .amortization-schedule td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(45, 212, 191, 0.1);
        }

        .amortization-schedule tr:hover {
            background: rgba(45, 212, 191, 0.05);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(45, 212, 191, 0.3);
            border-radius: 16px;
            padding: 20px;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(45, 212, 191, 0.3);
            border-radius: 12px;
            padding: 15px;
        }

        .comparison-card h5 {
            color: #0d9488;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .action-btn.primary {
            background: var(--secondary);
            color: white;
        }

        .action-btn.secondary {
            background: white;
            color: #0d9488;
            border: 2px solid #2dd4bf;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(45, 212, 191, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .clear-btn {
    position: absolute;
    top: 15px;
    left: 15px;
    background: #dc2626;
    color: white;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 5;
    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3);
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.clear-btn:hover {
    background: #b91c1c;
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 4px 8px rgba(220, 38, 38, 0.4);
}

.clear-btn:active {
    transform: scale(0.95) rotate(90deg);
}

.clear-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3);
}
        .info-icon {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 1.4rem;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.7;
    z-index: 10;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    background: transparent;
    border: none;
    outline: none;
    padding: 5px;
    border-radius: 50%;
}

.info-icon:hover {
    transform: scale(1.15) rotate(15deg);
    opacity: 1;
    filter: drop-shadow(0 4px 8px rgba(45, 212, 191, 0.4));
    background: rgba(45, 212, 191, 0.1);
}

.info-icon:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.3);
    border-radius: 50%;
}

.info-icon:active {
    transform: scale(1.05);
}
        .info-modal {
			display: none;
			position: fixed;
			z-index: 10000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.65);
			backdrop-filter: blur(5px);
			animation: fadeIn 0.3s ease;
			/* ✅ NUEVO: Permitir scroll del modal en mobile */
			overflow-y: auto;
			-webkit-overflow-scrolling: touch;
		}

        .info-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-modal-content {
			background: linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fcd34d 100%);
			padding: 35px 40px;
			border: 3px solid #f59e0b;
			border-radius: 24px;
			width: 90%;
			max-width: 600px;
			max-height: 85vh;
			overflow-y: auto;
			box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
			animation: slideDown 0.4s ease;
			position: relative;
			/* ✅ NUEVO: Forzar scroll en mobile */
			-webkit-overflow-scrolling: touch;
			overscroll-behavior: contain;
		}

        .info-modal-content h3 {
            background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 50%, #0d9488 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.9rem;
            font-weight: 800;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.3;
        }

        .info-modal-content .modal-section {
            margin-bottom: 20px;
        }

        .info-modal-content .modal-section h4 {
            color: #92400e;
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-modal-content .modal-section p {
            color: #78350f;
            font-size: 1.05rem;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .info-modal-content .example-box {
            background: rgba(255, 255, 255, 0.6);
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 12px;
            font-size: 0.98rem;
            color: #78350f;
            font-weight: 500;
        }

        .modal-close-btn {
            background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 50%, #0d9488 100%);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(45, 212, 191, 0.4);
            display: block;
            margin: 25px auto 0;
            min-width: 150px;
        }

        .modal-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(45, 212, 191, 0.5);
        }

        .disclaimer-box {
            background: rgba(245, 158, 11, 0.15);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.85rem;
            color: #92400e;
            font-weight: 600;
        }

        @keyframes resultShimmer {
            0%, 90%, 100% { left: -100%; }
            50% { left: 100%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .calc-card:nth-child(1) { animation-delay: 0.1s; }
        .calc-card:nth-child(2) { animation-delay: 0.2s; }
        .calc-card:nth-child(3) { animation-delay: 0.3s; }
        .calc-card:nth-child(4) { animation-delay: 0.4s; }
        .calc-card:nth-child(5) { animation-delay: 0.5s; }
        .calc-card:nth-child(6) { animation-delay: 0.6s; }
        .calc-card:nth-child(7) { animation-delay: 0.7s; }
        .calc-card:nth-child(8) { animation-delay: 0.8s; }
        .calc-card:nth-child(9) { animation-delay: 0.9s; }
        .calc-card:nth-child(10) { animation-delay: 1.0s; }

        .info-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 50px;
            margin-bottom: 50px;
            box-shadow: var(--shadow);
        }

        .info-section h2 {
            text-align: center;
            background: var(--secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: clamp(2rem, 4vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 40px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border-left: 4px solid #2dd4bf;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            animation: fadeInUp 0.8s ease-out;
        }

        .info-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 30px rgba(45, 212, 191, 0.15);
        }

        .info-card h4 {
            color: var(--text);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .info-card p {
            color: #475569;
            font-size: 1rem;
            line-height: 1.7;
        }

        .highlight-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 24px;
            margin-top: 40px;
            border: 1px solid rgba(45, 212, 191, 0.3);
            box-shadow: var(--shadow);
        }

        .highlight-box h3 {
            background: var(--secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .highlight-box p {
            color: #475569;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .footer {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px 32px 0 0;
            padding: 40px 0;
            text-align: center;
            color: var(--text-light);
            margin-top: 60px;
        }

       /* Tablets Landscape & Small Desktops (1024px - 1280px) */
		@media (max-width: 1280px) {
		.calc-grid { 
			grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
			gap: 35px;
		}
    
    .container {
        max-width: 1200px;
    }
}

/* Tablets Portrait (768px - 1024px) */
@media (max-width: 1024px) {
    .calc-grid { 
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
    }
    
    .header h1 {
        font-size: clamp(2rem, 4vw, 3rem);
    }
    
    .calculator-section, .info-section {
        padding: 40px 30px;
    }
}

/* Mobile Landscape & Small Tablets (600px - 768px) */
@media (max-width: 768px) {
    .container { 
        padding: 0 15px; 
    }
    
    .header {
        padding: 30px 0;
    }
    
    .header h1 {
        font-size: clamp(1.8rem, 5vw, 2.5rem);
        margin-bottom: 10px;
    }
    
    .header .tagline {
        font-size: clamp(0.9rem, 2vw, 1rem);
    }
    
    .header .subtitle {
        font-size: clamp(0.85rem, 1.8vw, 0.95rem);
    }
    
    .calculator-section, .info-section { 
        padding: 30px 20px;
        border-radius: 24px;
    }
    
    .section-title {
        font-size: clamp(1.5rem, 3.5vw, 1.8rem);
    }
    
    .calc-grid {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .calc-card { 
        padding: 30px 25px;
    }
    
    .calc-card h3 {
        font-size: 1.3rem;
    }
    
    .input-group input,
    .input-group select {
        padding: 14px 18px;
        font-size: 15px;
    }
    
    .result {
        font-size: 1.15rem;
        padding: 20px;
        min-height: 60px;
    }
    
    .comparison-container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .action-buttons {
        gap: 8px;
    }
    
    .action-btn {
        padding: 12px 18px;
        font-size: 0.85rem;
    }
    
    .info-modal-content {
        padding: 30px 25px;
        width: 92%;
        max-height: 85vh;
    }
    
    .info-modal-content h3 {
        font-size: 1.6rem;
        margin-bottom: 20px;
    }
    
    .info-modal-content .modal-section h4 {
        font-size: 1.1rem;
    }
    
    .info-modal-content .modal-section p {
        font-size: 0.95rem;
        line-height: 1.6;
    }
    
    .modal-close-btn {
        padding: 12px 35px;
        font-size: 1rem;
    }
    
    .info-icon {
        font-size: 1.3rem;
        top: 14px;
        right: 14px;
    }
    
    .clear-btn {
        padding: 7px 14px;
        font-size: 0.85rem;
        top: 15px;
        left: 15px;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .info-card {
        padding: 25px 20px;
    }
    
    .highlight-box {
        padding: 30px 25px;
    }
}

/* Mobile Portrait (480px - 600px) */
@media (max-width: 600px) {
    .header {
        padding: 25px 0;
    }
    
    .header h1 {
        font-size: clamp(1.6rem, 6vw, 2.2rem);
    }
    
    .calculator-section, .info-section {
        padding: 25px 18px;
        margin-bottom: 35px;
    }
    
    .calc-card {
        padding: 25px 20px;
    }
    
    .calc-card h3 {
        font-size: 1.2rem;
        margin-bottom: 25px;
    }
    
    .input-group {
        margin-bottom: 18px;
    }
    
    .input-group label {
        font-size: 0.9rem;
        margin-bottom: 8px;
    }
    
    .input-group input,
    .input-group select {
        padding: 13px 16px;
        font-size: 14px;
    }
    
    .result {
        font-size: 1.1rem;
        padding: 18px;
    }
    
    .result-detailed {
        padding: 18px;
        font-size: 0.9rem;
    }
    
    .chart-container {
        height: 250px;
        padding: 15px;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 10px;
    }
    
    .action-btn {
        min-width: 100%;
        padding: 13px 20px;
        font-size: 0.9rem;
    }
    
    .info-modal-content {
        padding: 25px 18px;
        width: 94%;
        max-height: 88vh;
        border-radius: 20px;
    }
    
    .info-modal-content h3 {
        font-size: 1.4rem;
        margin-bottom: 18px;
        line-height: 1.25;
    }
    
    .info-modal-content .modal-section {
        margin-bottom: 18px;
    }
    
    .info-modal-content .modal-section h4 {
        font-size: 1.05rem;
        margin-bottom: 8px;
    }
    
    .info-modal-content .modal-section p {
        font-size: 0.92rem;
        line-height: 1.6;
        margin-bottom: 10px;
    }
    
    .info-modal-content .example-box {
        padding: 12px;
        font-size: 0.88rem;
        margin-top: 10px;
    }
    
    .modal-close-btn {
        padding: 12px 30px;
        font-size: 0.95rem;
        margin-top: 20px;
    }
    
    .info-icon {
        font-size: 1.25rem;
        top: 12px;
        right: 12px;
    }
    
    .clear-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
        top: 12px;
        left: 12px;
    }
    
    .info-card {
        padding: 22px 18px;
    }
    
    .info-card h4 {
        font-size: 1.1rem;
    }
    
    .info-card p {
        font-size: 0.95rem;
    }
    
    .highlight-box {
        padding: 25px 18px;
    }
    
    .highlight-box h3 {
        font-size: 1.2rem;
    }
    
    .highlight-box p {
        font-size: 1rem;
    }
}

/* Small Mobile (375px - 480px) */
@media (max-width: 480px) {
    .container {
        padding: 0 12px;
    }
    
    .header {
        padding: 20px 0;
    }
    
    .header h1 {
        font-size: clamp(1.5rem, 7vw, 2rem);
        letter-spacing: -0.01em;
    }
    
    .calculator-list {
        padding: 15px;
        gap: 6px 12px;
    }
    
    .calculator-list span {
        font-size: 0.8rem;
        padding: 5px 10px;
    }
    
    .calculator-section, .info-section {
        padding: 22px 15px;
        margin-bottom: 30px;
    }
    
    .calc-card {
        padding: 22px 18px;
    }
    
    .input-group input,
    .input-group select {
        padding: 12px 14px;
        font-size: 14px;
        border-radius: 12px;
    }
    
    .result {
        font-size: 1.05rem;
        padding: 16px;
        border-radius: 12px;
    }
    
    .amortization-schedule {
        max-height: 300px;
        padding: 12px;
        font-size: 0.8rem;
    }
    
    .amortization-schedule th,
    .amortization-schedule td {
        padding: 6px 8px;
    }
    
    .info-modal-content {
        padding: 20px 15px;
        width: 96%;
    }
    
    .info-modal-content h3 {
        font-size: 1.3rem;
    }
    
    .disclaimer-box {
        padding: 12px;
        font-size: 0.8rem;
    }
}

/* Extra Small Mobile (320px - 375px) */
@media (max-width: 375px) {
    .container {
        padding: 0 10px;
    }
    
    .header {
        padding: 18px 0;
    }
    
    .header h1 {
        font-size: clamp(1.4rem, 8vw, 1.8rem);
    }
    
    .header .tagline,
    .header .subtitle {
        font-size: 0.85rem;
    }
    
    .calculator-section, .info-section {
        padding: 20px 12px;
        border-radius: 20px;
        margin-bottom: 25px;
    }
    
    .section-title {
        font-size: 1.4rem;
        margin-bottom: 12px;
    }
    
    .section-description {
        font-size: 0.9rem;
        margin-bottom: 30px;
    }
    
    .calc-grid {
        gap: 25px;
    }
    
    .calc-card {
        padding: 20px 15px;
        border-radius: 20px;
    }
    
    .calc-card h3 {
        font-size: 1.15rem;
        margin-bottom: 22px;
    }
    
    .input-group {
        margin-bottom: 16px;
    }
    
    .input-group label {
        font-size: 0.85rem;
        margin-bottom: 7px;
    }
    
    .input-group input,
    .input-group select {
        padding: 11px 13px;
        font-size: 13px;
        border-radius: 10px;
    }
    
    .result {
        font-size: 1rem;
        padding: 14px;
        min-height: 55px;
    }
    
    .result-detailed {
        padding: 15px;
        font-size: 0.85rem;
    }
    
    .result-row {
        padding: 6px 0;
        font-size: 0.85rem;
    }
    
    .chart-container {
        height: 220px;
        padding: 12px;
    }
    
    .action-btn {
        padding: 11px 18px;
        font-size: 0.85rem;
    }
    
    .info-icon {
        font-size: 1.2rem;
        top: 10px;
        right: 10px;
    }
    
    .clear-btn {
        padding: 5px 10px;
        font-size: 0.75rem;
        top: 10px;
        left: 10px;
    }
    
    .info-modal-content {
        padding: 18px 12px;
        width: 97%;
    }
    
    .info-modal-content h3 {
        font-size: 1.2rem;
        margin-bottom: 15px;
    }
    
    .info-modal-content .modal-section h4 {
        font-size: 1rem;
    }
    
    .info-modal-content .modal-section p {
        font-size: 0.88rem;
    }
    
    .info-modal-content .example-box {
        padding: 10px;
        font-size: 0.82rem;
    }
    
    .modal-close-btn {
        padding: 10px 25px;
        font-size: 0.9rem;
    }
    
    .info-card {
        padding: 18px 15px;
    }
    
    .info-card h4 {
        font-size: 1.05rem;
    }
    
    .info-card p {
        font-size: 0.9rem;
    }
    
    .highlight-box {
        padding: 20px 15px;
        border-radius: 16px;
    }
    
    .footer {
        padding: 30px 0;
        font-size: 0.85rem;
    }
}

/* iPhone SE & Very Small Devices (280px - 320px) */
@media (max-width: 320px) {
    .container {
        padding: 0 8px;
    }
    
    .header h1 {
        font-size: 1.3rem;
    }
    
    .calc-card {
        padding: 18px 12px;
    }
    
    .calc-card h3 {
        font-size: 1.1rem;
    }
    
    .input-group input,
    .input-group select {
        padding: 10px 12px;
        font-size: 13px;
    }
    
    .result {
        font-size: 0.95rem;
        padding: 12px;
    }
    
    .action-btn {
        padding: 10px 15px;
        font-size: 0.8rem;
    }
    
    .clear-btn {
        font-size: 0.7rem;
        padding: 4px 8px;
    }
    
    .info-icon {
        font-size: 1.1rem;
    }
}

/* Landscape Mobile Devices */
@media (max-height: 500px) and (orientation: landscape) {
    .header {
        padding: 15px 0;
    }
    
    .header h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
    }
    
    .header .tagline,
    .header .subtitle {
        font-size: 0.8rem;
    }
    
    .calculator-section {
        padding: 20px 15px;
    }
    
    .calc-card {
        padding: 20px 15px;
    }
    
    .info-modal-content {
        max-height: 92vh;
        padding: 15px;
    }
    
    .info-modal-content h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
    }
    
    .info-modal-content .modal-section {
        margin-bottom: 12px;
    }
}

/* High DPI / Retina Displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .calc-card {
        border-width: 0.5px;
    }
    
    .input-group input,
    .input-group select {
        border-width: 1.5px;
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .action-btn,
    .modal-close-btn,
    .clear-btn,
    .info-icon {
        min-height: 44px;
        min-width: 44px;
    }
    
    .input-group input,
    .input-group select {
        min-height: 44px;
    }
    
    .calc-card:hover {
        transform: none;
    }
    
    .action-btn:hover {
        transform: none;
    }
    
    .info-icon:hover {
        transform: none;
    }
}

/* Print Styles */
@media print {
    body {
        background: white;
    }
    
    .header::before,
    body::before {
        display: none;
    }
    
    .header,
    .footer,
    .info-icon,
    .clear-btn,
    .action-buttons,
    .banner-2-container {
        display: none !important;
    }
    
    .calc-card,
    .info-card {
        break-inside: avoid;
        page-break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
    }
    
    .result,
    .result-detailed {
        background: white !important;
        color: black !important;
        border: 1px solid #ddd;
    }
    
    .chart-container {
        display: none;
    }
}
        /* Loading spinner for currency rates */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Accessibility improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 3px solid #2dd4bf;
            outline-offset: 2px;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .header, .footer, .info-icon, .clear-btn, .action-buttons {
                display: none;
            }
            
            .calc-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <header class="header" role="banner">
        <div class="container">
            <a href="https://rapidpercent.com" style="position: absolute; left: 35px; top: 54%; transform: translateY(-50%); z-index: 9999; text-decoration: none; display: block; transition: all 0.3s ease; filter: drop-shadow(0 4px 15px rgba(251, 191, 36, 0.5)); cursor: pointer; pointer-events: all;" onmouseover="this.style.transform='translateY(-50%) translateX(-6px) scale(1.06)'; this.style.filter='drop-shadow(0 6px 20px rgba(251, 191, 36, 0.7))';" onmouseout="this.style.transform='translateY(-50%)'; this.style.filter='drop-shadow(0 4px 15px rgba(251, 191, 36, 0.5))';" title="Back to RapidPercent home" aria-label="Return to RapidPercent homepage">
                <svg width="95" height="75" viewBox="0 0 85 75" xmlns="http://www.w3.org/2000/svg" style="display: block; pointer-events: auto;" aria-hidden="true">
                    <path d="M18 37.5 L48 8 L48 26 L85 26 L85 49 L48 49 L48 67 Z" fill="#fbbf24" style="pointer-events: all;"/>
                </svg>
            </a>
            <h1>Free Financial Calculators 2025</h1>
			<p class="tagline">Loan Amortization • Mortgage Planning • Investment ROI • Tax Calculator • Retirement Savings</p>
			<p class="subtitle">Professional-grade financial tools with live data, visual charts & instant results. No signup required.</p>
        </div>
    </header>
	
	<!-- Rich snippet breadcrumbs for Google -->
	<nav aria-label="Breadcrumb" style="max-width: 1400px; margin: 0 auto; padding: 10px 20px 0;">
		<ol style="display: flex; list-style: none; padding: 0; font-size: 0.85rem; color: rgba(255,255,255,0.8);">
			<li><a href="https://rapidpercent.com" style="color: rgba(255,255,255,0.9); text-decoration: none;">Home</a></li>
			<li style="margin: 0 8px;">›</li>
			<li style="color: rgba(255,255,255,0.6);">Financial Calculators</li>
		</ol>
	</nav>

    <main class="container">
        <section class="calculator-section" role="main" aria-label="Financial calculators suite">
            <h2 class="section-title">10 Professional Financial Calculators - Calculate Loans, Mortgages, Investments, Taxes & Retirement Savings</h2>
            
            <div class="calculator-list" role="list" aria-label="Available financial calculators">
				<span role="listitem">Loan Amortization Calculator</span>
				<span role="listitem">Mortgage Payment Calculator</span>
				<span role="listitem">Investment ROI Calculator</span>
				<span role="listitem">Salary Tax Calculator</span>
				<span role="listitem">Retirement Savings Planner</span>
				<span role="listitem">Car Loan Calculator</span>
				<span role="listitem">Credit Card Debt Payoff</span>
				<span role="listitem">Budget Planning Tool</span>
				<span role="listitem">Currency Exchange Converter</span>
				<span role="listitem">Inflation Impact Calculator</span>
			</div>
            
            <div class="calc-grid">
                <!-- Calculator 1: Loan Calculator -->
                <article class="calc-card" id="loan-calc" role="region" aria-labelledby="loan-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('loan-calc')" title="Clear all fields" aria-label="Clear loan calculator fields">✕</button>
                    <h3 id="loan-calc-title">Loan Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal1')" title="How to use this calculator?" aria-label="Show loan calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="loan-amount">Loan Amount ($):</label>
                        <input type="number" id="loan-amount" placeholder="e.g., 50000" step="100" min="0" aria-label="Loan amount in dollars" aria-describedby="error-loan-amount">
                        <div class="error-message" id="error-loan-amount" role="alert">Please enter a valid amount</div>
					</div>
					
					<!-- ⬇️ NUEVO INPUT OPCIONAL -->
					<div class="input-group">
						<label for="retire-salary-optional">Current Annual Salary (optional):</label>
						<input type="number" id="retire-salary-optional" placeholder="e.g., 75000 (leave blank to auto-estimate)" step="1000" min="0" aria-label="Current annual salary (optional for better benchmarks)">
						<div style="font-size: 0.8rem; color: #6b7280; margin-top: 5px;">
							💡 Helps calculate more accurate age-based retirement benchmarks
						</div>
					</div>
                    
                    <div class="input-group">
                        <label for="loan-rate">Annual Interest Rate (%):</label>
                        <input type="number" id="loan-rate" placeholder="e.g., 5.5" step="0.01" min="0" max="100" aria-label="Annual interest rate percentage" aria-describedby="error-loan-rate">
                        <div class="error-message" id="error-loan-rate" role="alert">Please enter a valid rate (0-100)</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="loan-term">Loan Term (years):</label>
                        <input type="number" id="loan-term" placeholder="e.g., 10" step="1" min="1" max="50" aria-label="Loan term in years" aria-describedby="error-loan-term">
                        <div class="error-message" id="error-loan-term" role="alert">Please enter a valid term (1-50 years)</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-loan-indicator">Calculating...</div>
                    <div class="result" id="result-loan" role="status" aria-live="polite">Enter loan details above</div>
                    <div class="result-detailed" id="result-loan-detailed" style="display: none;"></div>
                    <div class="amortization-schedule" id="amortization-loan" style="display: none;"></div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showLoanComparison()" id="btn-loan-compare" disabled>Compare Options</button>
                        <button class="action-btn secondary" onclick="exportToPDF('loan-calc')" id="btn-loan-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 2: Mortgage Calculator -->
                <article class="calc-card" id="mortgage-calc" role="region" aria-labelledby="mortgage-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('mortgage-calc')" title="Clear all fields" aria-label="Clear mortgage calculator fields">✕</button>
                    <h3 id="mortgage-calc-title">Mortgage Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal2')" title="How to use this calculator?" aria-label="Show mortgage calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="mortgage-price">Home Price ($):</label>
                        <input type="number" id="mortgage-price" placeholder="e.g., 300000" step="1000" min="0" aria-label="Home price in dollars" aria-describedby="error-mortgage-price">
                        <div class="error-message" id="error-mortgage-price" role="alert">Please enter a valid price</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="mortgage-down">Down Payment ($):</label>
                        <input type="number" id="mortgage-down" placeholder="e.g., 60000" step="1000" min="0" aria-label="Down payment in dollars" aria-describedby="error-mortgage-down">
                        <div class="error-message" id="error-mortgage-down" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="mortgage-rate">Interest Rate (%):</label>
                        <input type="number" id="mortgage-rate" placeholder="e.g., 4.5" step="0.01" min="0" max="100" aria-label="Interest rate percentage" aria-describedby="error-mortgage-rate">
                        <div class="error-message" id="error-mortgage-rate" role="alert">Please enter a valid rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="mortgage-term">Loan Term (years):</label>
                        <input type="number" id="mortgage-term" placeholder="e.g., 30" step="1" min="1" max="50" aria-label="Loan term in years" aria-describedby="error-mortgage-term">
                        <div class="error-message" id="error-mortgage-term" role="alert">Please enter a valid term</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-mortgage-indicator">Calculating...</div>
                    <div class="result" id="result-mortgage" role="status" aria-live="polite">Enter mortgage details above</div>
                    <div class="result-detailed" id="result-mortgage-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-mortgage" style="display: none;">
                        <canvas id="mortgage-chart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showMortgageComparison()" id="btn-mortgage-compare" disabled>15 vs 30 Year</button>
                        <button class="action-btn secondary" onclick="exportToPDF('mortgage-calc')" id="btn-mortgage-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 3: Investment Return Calculator (ROI) -->
                <article class="calc-card" id="investment-calc" role="region" aria-labelledby="investment-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('investment-calc')" title="Clear all fields" aria-label="Clear investment calculator fields">✕</button>
                    <h3 id="investment-calc-title">Investment Return (ROI)</h3>
                    <button class="info-icon" onclick="openModal('modal3')" title="How to use this calculator?" aria-label="Show investment calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="invest-initial">Initial Investment ($):</label>
                        <input type="number" id="invest-initial" placeholder="e.g., 10000" step="100" min="0" aria-label="Initial investment amount" aria-describedby="error-invest-initial">
                        <div class="error-message" id="error-invest-initial" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="invest-return">Expected Annual Return (%):</label>
                        <input type="number" id="invest-return" placeholder="e.g., 7" step="0.1" min="-100" max="1000" aria-label="Expected annual return percentage" aria-describedby="error-invest-return">
                        <div class="error-message" id="error-invest-return" role="alert">Please enter a valid return rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="invest-years">Investment Period (years):</label>
                        <input type="number" id="invest-years" placeholder="e.g., 20" step="1" min="1" max="100" aria-label="Investment period in years" aria-describedby="error-invest-years">
                        <div class="error-message" id="error-invest-years" role="alert">Please enter a valid period</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="invest-contribution">Monthly Contribution ($):</label>
                        <input type="number" id="invest-contribution" placeholder="e.g., 500 (optional)" step="10" min="0" aria-label="Monthly contribution amount" aria-describedby="error-invest-contribution">
                        <div class="error-message" id="error-invest-contribution" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-investment-indicator">Calculating...</div>
                    <div class="result" id="result-investment" role="status" aria-live="polite">Enter investment details above</div>
                    <div class="result-detailed" id="result-investment-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-investment" style="display: none;">
                        <canvas id="investment-chart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showInvestmentProjection()" id="btn-investment-project" disabled>Year-by-Year</button>
                        <button class="action-btn secondary" onclick="exportToPDF('investment-calc')" id="btn-investment-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 4: Salary Calculator (Gross to Net) -->
                <article class="calc-card" id="salary-calc" role="region" aria-labelledby="salary-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('salary-calc')" title="Clear all fields" aria-label="Clear salary calculator fields">✕</button>
                    <h3 id="salary-calc-title">Salary Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal4')" title="How to use this calculator?" aria-label="Show salary calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="salary-gross">Gross Annual Salary ($):</label>
                        <input type="number" id="salary-gross" placeholder="e.g., 75000" step="1000" min="0" aria-label="Gross annual salary" aria-describedby="error-salary-gross">
                        <div class="error-message" id="error-salary-gross" role="alert">Please enter a valid salary</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="salary-filing">Filing Status:</label>
                        <select id="salary-filing" aria-label="Tax filing status">
                            <option value="single">Single</option>
                            <option value="married">Married Filing Jointly</option>
                            <option value="head">Head of Household</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="salary-state">State Tax Rate (%):</label>
                        <input type="number" id="salary-state" placeholder="e.g., 5 (0 if no state tax)" step="0.1" min="0" max="15" value="5" aria-label="State tax rate" aria-describedby="error-salary-state">
                        <div class="error-message" id="error-salary-state" role="alert">Please enter a valid state tax rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="salary-deductions">Pre-tax Deductions ($):</label>
                        <input type="number" id="salary-deductions" placeholder="e.g., 5000 (401k, HSA, etc.)" step="100" min="0" aria-label="Pre-tax deductions" aria-describedby="error-salary-deductions">
                        <div class="error-message" id="error-salary-deductions" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-salary-indicator">Calculating...</div>
                    <div class="result" id="result-salary" role="status" aria-live="polite">Enter salary details above</div>
                    <div class="result-detailed" id="result-salary-detailed" style="display: none;"></div>
                    <div class="disclaimer-box" style="display: none;" id="salary-disclaimer">
						<strong style="font-size: 1.1rem;">⚠️ ESTIMATE ONLY - NOT TAX ADVICE</strong>
						<p style="margin-top: 10px; line-height: 1.6;">
							This calculator uses <strong>2025 federal tax brackets</strong> for educational purposes only. 
							Your actual tax liability depends on:
						</p>
						<ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
							<li>Itemized vs. standard deductions</li>
							<li>Tax credits (child tax credit, EITC, education credits, etc.)</li>
							<li>State and local taxes (varies by location)</li>
							<li>Additional income sources (investments, bonuses, side income)</li>
							<li>Retirement contributions (traditional vs. Roth)</li>
							<li>Health insurance premiums and HSA contributions</li>
						</ul>
						<p style="margin-top: 10px; font-weight: 700; color: #7f1d1d;">
							📞 Consult a qualified tax professional or CPA for accurate tax planning and filing.
						</p>
					</div>
                    <div class="action-buttons">
                        <button class="action-btn secondary" onclick="exportToPDF('salary-calc')" id="btn-salary-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 5: Retirement Savings Calculator -->
                <article class="calc-card" id="retirement-calc" role="region" aria-labelledby="retirement-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('retirement-calc')" title="Clear all fields" aria-label="Clear retirement calculator fields">✕</button>
                    <h3 id="retirement-calc-title">Retirement Savings</h3>
                    <button class="info-icon" onclick="openModal('modal5')" title="How to use this calculator?" aria-label="Show retirement calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="retire-age">Current Age:</label>
                        <input type="number" id="retire-age" placeholder="e.g., 30" step="1" min="18" max="100" aria-label="Current age" aria-describedby="error-retire-age">
                        <div class="error-message" id="error-retire-age" role="alert">Please enter a valid age (18-100)</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="retire-target-age">Retirement Age:</label>
                        <input type="number" id="retire-target-age" placeholder="e.g., 65" step="1" min="18" max="100" aria-label="Target retirement age" aria-describedby="error-retire-target-age">
                        <div class="error-message" id="error-retire-target-age" role="alert">Please enter a valid retirement age</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="retire-current">Current Savings ($):</label>
                        <input type="number" id="retire-current" placeholder="e.g., 50000" step="1000" min="0" aria-label="Current retirement savings" aria-describedby="error-retire-current">
                        <div class="error-message" id="error-retire-current" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="retire-monthly">Monthly Contribution ($):</label>
                        <input type="number" id="retire-monthly" placeholder="e.g., 1000" step="50" min="0" aria-label="Monthly contribution amount" aria-describedby="error-retire-monthly">
                        <div class="error-message" id="error-retire-monthly" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="retire-return">Expected Annual Return (%):</label>
                        <input type="number" id="retire-return" placeholder="e.g., 7" step="0.1" min="0" max="100" aria-label="Expected annual return" aria-describedby="error-retire-return">
                        <div class="error-message" id="error-retire-return" role="alert">Please enter a valid return rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="retire-inflation">Expected Inflation (%):</label>
                        <input type="number" id="retire-inflation" placeholder="e.g., 3" step="0.1" min="0" max="20" value="3" aria-label="Expected inflation rate" aria-describedby="error-retire-inflation">
                        <div class="error-message" id="error-retire-inflation" role="alert">Please enter a valid inflation rate</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-retirement-indicator">Calculating...</div>
                    <div class="result" id="result-retirement" role="status" aria-live="polite">Enter retirement details above</div>
                    <div class="result-detailed" id="result-retirement-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-retirement" style="display: none;">
                        <canvas id="retirement-chart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showRetirementAnalysis()" id="btn-retirement-analysis" disabled>Detailed Analysis</button>
                        <button class="action-btn secondary" onclick="exportToPDF('retirement-calc')" id="btn-retirement-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 6: Car Loan Calculator -->
                <article class="calc-card" id="carloan-calc" role="region" aria-labelledby="carloan-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('carloan-calc')" title="Clear all fields" aria-label="Clear car loan calculator fields">✕</button>
                    <h3 id="carloan-calc-title">Car Loan Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal6')" title="How to use this calculator?" aria-label="Show car loan calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="car-price">Car Price ($):</label>
                        <input type="number" id="car-price" placeholder="e.g., 35000" step="500" min="0" aria-label="Car price" aria-describedby="error-car-price">
                        <div class="error-message" id="error-car-price" role="alert">Please enter a valid price</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="car-down">Down Payment ($):</label>
                        <input type="number" id="car-down" placeholder="e.g., 7000" step="500" min="0" aria-label="Down payment" aria-describedby="error-car-down">
                        <div class="error-message" id="error-car-down" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="car-rate">Interest Rate (%):</label>
                        <input type="number" id="car-rate" placeholder="e.g., 4.5" step="0.01" min="0" max="100" aria-label="Interest rate" aria-describedby="error-car-rate">
                        <div class="error-message" id="error-car-rate" role="alert">Please enter a valid rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="car-term">Loan Term (years):</label>
                        <input type="number" id="car-term" placeholder="e.g., 5" step="1" min="1" max="10" aria-label="Loan term" aria-describedby="error-car-term">
                        <div class="error-message" id="error-car-term" role="alert">Please enter a valid term (1-10 years)</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-carloan-indicator">Calculating...</div>
                    <div class="result" id="result-carloan" role="status" aria-live="polite">Enter car loan details above</div>
                    <div class="result-detailed" id="result-carloan-detailed" style="display: none;"></div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showCarLoanComparison()" id="btn-carloan-compare" disabled>Compare Terms</button>
                        <button class="action-btn secondary" onclick="exportToPDF('carloan-calc')" id="btn-carloan-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 7: Credit Card Payoff Calculator -->
                <article class="calc-card" id="credit-calc" role="region" aria-labelledby="credit-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('credit-calc')" title="Clear all fields" aria-label="Clear credit card calculator fields">✕</button>
                    <h3 id="credit-calc-title">Credit Card Payoff</h3>
                    <button class="info-icon" onclick="openModal('modal7')" title="How to use this calculator?" aria-label="Show credit card calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="credit-balance">Current Balance ($):</label>
                        <input type="number" id="credit-balance" placeholder="e.g., 5000" step="100" min="0" aria-label="Current balance" aria-describedby="error-credit-balance">
                        <div class="error-message" id="error-credit-balance" role="alert">Please enter a valid balance</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="credit-apr">APR (%):</label>
                        <input type="number" id="credit-apr" placeholder="e.g., 18.5" step="0.1" min="0" max="100" aria-label="Annual percentage rate" aria-describedby="error-credit-apr">
                        <div class="error-message" id="error-credit-apr" role="alert">Please enter a valid APR</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="credit-payment">Monthly Payment ($):</label>
                        <input type="number" id="credit-payment" placeholder="e.g., 200" step="10" min="0" aria-label="Monthly payment" aria-describedby="error-credit-payment">
                        <div class="error-message" id="error-credit-payment" role="alert">Please enter a valid payment amount</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-credit-indicator">Calculating...</div>
                    <div class="result" id="result-credit" role="status" aria-live="polite">Enter credit card details above</div>
                    <div class="result-detailed" id="result-credit-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-credit" style="display: none;">
                        <canvas id="credit-chart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showPayoffStrategies()" id="btn-credit-strategies" disabled>Compare Strategies</button>
                        <button class="action-btn secondary" onclick="exportToPDF('credit-calc')" id="btn-credit-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 8: Budget Calculator -->
                <article class="calc-card" id="budget-calc" role="region" aria-labelledby="budget-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('budget-calc')" title="Clear all fields" aria-label="Clear budget calculator fields">✕</button>
                    <h3 id="budget-calc-title">Budget Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal8')" title="How to use this calculator?" aria-label="Show budget calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="budget-income">Monthly Income ($):</label>
                        <input type="number" id="budget-income" placeholder="e.g., 5000" step="100" min="0" aria-label="Monthly income" aria-describedby="error-budget-income">
                        <div class="error-message" id="error-budget-income" role="alert">Please enter a valid income</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="budget-housing">Housing ($):</label>
                        <input type="number" id="budget-housing" placeholder="e.g., 1500" step="50" min="0" aria-label="Housing expenses" aria-describedby="error-budget-housing">
                        <div class="error-message" id="error-budget-housing" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="budget-food">Food & Groceries ($):</label>
                        <input type="number" id="budget-food" placeholder="e.g., 600" step="50" min="0" aria-label="Food expenses" aria-describedby="error-budget-food">
                        <div class="error-message" id="error-budget-food" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="budget-transport">Transportation ($):</label>
                        <input type="number" id="budget-transport" placeholder="e.g., 400" step="50" min="0" aria-label="Transportation expenses" aria-describedby="error-budget-transport">
                        <div class="error-message" id="error-budget-transport" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="budget-other">Other Expenses ($):</label>
                        <input type="number" id="budget-other" placeholder="e.g., 800" step="50" min="0" aria-label="Other expenses" aria-describedby="error-budget-other">
                        <div class="error-message" id="error-budget-other" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-budget-indicator">Calculating...</div>
                    <div class="result" id="result-budget" role="status" aria-live="polite">Enter budget details above</div>
                    <div class="result-detailed" id="result-budget-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-budget" style="display: none;">
                        <canvas id="budget-chart"></canvas>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showBudgetAnalysis()" id="btn-budget-analysis" disabled>50/30/20 Check</button>
                        <button class="action-btn secondary" onclick="exportToPDF('budget-calc')" id="btn-budget-print" disabled>📄 Export PDF</button>
                    </div>
                </article>

                <!-- Calculator 9: Currency Converter -->
                <article class="calc-card" id="currency-calc" role="region" aria-labelledby="currency-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('currency-calc')" title="Clear all fields" aria-label="Clear currency converter fields">✕</button>
                    <h3 id="currency-calc-title">Currency Converter</h3>
                    <button class="info-icon" onclick="openModal('modal9')" title="How to use this calculator?" aria-label="Show currency converter information">💡</button>
                    
                    <div class="input-group">
                        <label for="currency-amount">Amount:</label>
                        <input type="number" id="currency-amount" placeholder="e.g., 1000" step="0.01" min="0" aria-label="Amount to convert" aria-describedby="error-currency-amount">
                        <div class="error-message" id="error-currency-amount" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="currency-from">From Currency:</label>
                        <select id="currency-from" aria-label="From currency">
                            <option value="USD">USD - US Dollar</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="JPY">JPY - Japanese Yen</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="CHF">CHF - Swiss Franc</option>
                            <option value="CNY">CNY - Chinese Yuan</option>
                            <option value="INR">INR - Indian Rupee</option>
                            <option value="MXN">MXN - Mexican Peso</option>
                            <option value="BRL">BRL - Brazilian Real</option>
                            <option value="ZAR">ZAR - South African Rand</option>
                            <option value="SGD">SGD - Singapore Dollar</option>
                            <option value="HKD">HKD - Hong Kong Dollar</option>
                            <option value="SEK">SEK - Swedish Krona</option>
                            <option value="NOK">NOK - Norwegian Krone</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="currency-to">To Currency:</label>
                        <select id="currency-to" aria-label="To currency">
                            <option value="EUR">EUR - Euro</option>
                            <option value="USD">USD - US Dollar</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="JPY">JPY - Japanese Yen</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="CHF">CHF - Swiss Franc</option>
                            <option value="CNY">CNY - Chinese Yuan</option>
                            <option value="INR">INR - Indian Rupee</option>
                            <option value="MXN">MXN - Mexican Peso</option>
                            <option value="BRL">BRL - Brazilian Real</option>
                            <option value="ZAR">ZAR - South African Rand</option>
                            <option value="SGD">SGD - Singapore Dollar</option>
                            <option value="HKD">HKD - Hong Kong Dollar</option>
                            <option value="SEK">SEK - Swedish Krona</option>
                            <option value="NOK">NOK - Norwegian Krone</option>
                        </select>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-currency-indicator">Fetching live rates...</div>
                    <div class="result" id="result-currency" role="status" aria-live="polite">Enter amount and currencies above</div>
                    <div class="result-detailed" id="result-currency-detailed" style="display: none;"></div>
                    <div class="disclaimer-box" style="display: block; margin-top: 15px;">
                        <strong>🔄 Live Exchange Rates:</strong> Rates update from exchangerate-api.com. For actual transactions, check with your bank or payment provider as they may charge additional fees (1-3% markup).
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn secondary" onclick="exportToPDF('currency-calc')" id="btn-currency-print" disabled>📄 Export PDF</button>
                    </div>
                </article>
				<!-- Calculator 10: Inflation Calculator -->
                <article class="calc-card" id="inflation-calc" role="region" aria-labelledby="inflation-calc-title">
                    <button class="clear-btn" onclick="clearCalculator('inflation-calc')" title="Clear all fields" aria-label="Clear inflation calculator fields">✕</button>
                    <h3 id="inflation-calc-title">Inflation Calculator</h3>
                    <button class="info-icon" onclick="openModal('modal10')" title="How to use this calculator?" aria-label="Show inflation calculator information">💡</button>
                    
                    <div class="input-group">
                        <label for="inflation-amount">Amount ($):</label>
                        <input type="number" id="inflation-amount" placeholder="e.g., 1000" step="10" min="0" aria-label="Amount in current dollars" aria-describedby="error-inflation-amount">
                        <div class="error-message" id="error-inflation-amount" role="alert">Please enter a valid amount</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="inflation-rate">Annual Inflation Rate (%):</label>
                        <input type="number" id="inflation-rate" placeholder="e.g., 3" step="0.1" min="0" max="100" aria-label="Expected inflation rate" aria-describedby="error-inflation-rate">
                        <div class="error-message" id="error-inflation-rate" role="alert">Please enter a valid rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="inflation-years">Number of Years:</label>
                        <input type="number" id="inflation-years" placeholder="e.g., 10" step="1" min="1" max="100" aria-label="Number of years" aria-describedby="error-inflation-years">
                        <div class="error-message" id="error-inflation-years" role="alert">Please enter a valid number of years</div>
                    </div>
                    
                    <div class="calculating-indicator" id="calc-inflation-indicator">Calculating...</div>
                    <div class="result" id="result-inflation" role="status" aria-live="polite">Enter inflation details above</div>
                    <div class="result-detailed" id="result-inflation-detailed" style="display: none;"></div>
                    <div class="chart-container" id="chart-inflation" style="display: none;">
                        <canvas id="inflation-chart"></canvas>
                    </div>
                    <div class="disclaimer-box" style="display: none;" id="inflation-disclaimer">
                        <strong>📊 Historical Context:</strong> US inflation averaged 3.3% (1913-2024). Recent years: 2021: 4.7%, 2022: 8.0%, 2023: 4.1%, 2024: ~3.2%. Actual inflation varies by category (housing, food, healthcare differ significantly).
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="showInflationBreakdown()" id="btn-inflation-breakdown" disabled>Category Impact</button>
                        <button class="action-btn secondary" onclick="exportToPDF('inflation-calc')" id="btn-inflation-print" disabled>📄 Export PDF</button>
                    </div>
                </article>
            </div>
        </section>
		
		<!-- SECCIÓN DE BANNERS: Cuadrado arriba, Horizontal abajo -->
		<div style="max-width: 1400px; margin: 0 auto 40px; padding: 0 20px;">
    
			<!-- Banner Cuadrado (300x250) -->
			<div style="display: flex; justify-content: flex-end; margin-bottom: 30px;">
				<div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; padding: 30px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border: 1px solid rgba(45, 212, 191, 0.1); position: relative; overflow: hidden;">
					<div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%); border-radius: 24px 24px 0 0;"></div>
					<iframe data-aa='2415316' src='//ad.a-ads.com/2415316/?size=300x250'
						style='border:0; padding:0; width:300px; height:250px; overflow:hidden; display:block; border-radius:12px;' 
						title="Advertisement"></iframe>
				</div>
			</div>

			<!-- Banner Horizontal (728x90) - AHORA CENTRADO Y FULL WIDTH -->
			<div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; padding: 25px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border: 1px solid rgba(45, 212, 191, 0.1); position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center;">
				<div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%); border-radius: 24px 24px 0 0;"></div>
				<iframe data-aa='2415316' src='//ad.a-ads.com/2415316/?size=728x90'
					style='border:0; padding:0; width:100%; max-width:728px; height:90px; overflow:hidden; display:block; border-radius:12px;' 
					title="Advertisement - Leaderboard"></iframe>
			</div>
    
		</div>

        <!-- Information Section -->
        <section class="info-section" role="region" aria-labelledby="guide-title">
            <h2 id="guide-title">How to Use Our Financial Calculators - Complete Guide for Loans, Mortgages, Investments & Retirement Planning</h2>
            
            <div class="info-grid">
                <div class="info-card" itemscope itemtype="https://schema.org/HowTo">
					<h4 itemprop="name">💰 Loan Calculator - Full Amortization Schedule with APR Breakdown</h4>
                    <p><strong>What's New:</strong> Complete month-by-month payment breakdown showing principal vs interest over the entire loan term. Watch how early payments are mostly interest, then gradually shift to principal reduction.</p>
                    <p><strong>Real Example:</strong> $25,000 auto loan at 6% APR for 5 years → Monthly: $483.32, Total interest: $3,999. Payment 1: $358 interest, $125 principal. Payment 60: $2 interest, $481 principal.</p>
                    <p><strong>💡 Strategy:</strong> Add just $50/month extra → Save $580 interest and finish 7 months early. Extra payments attack principal directly, saving exponentially more interest over time.</p>
                </div>
                
                <div class="info-card">
                    <h4>🏠 Mortgage Calculator - Visual Payment Breakdown</h4>
                    <p><strong>Advanced Features:</strong> Interactive charts showing principal vs interest breakdown, 15-year vs 30-year comparison, and total cost analysis with visual representations.</p>
                    <p><strong>$300,000 at 4.5% Comparison:</strong><br>
                    • 30-year: $1,520/mo, $247,220 interest<br>
                    • 15-year: $2,294/mo, $113,034 interest<br>
                    • Savings: $134,186 by choosing 15-year term!</p>
                    <p><strong>Hidden Costs Alert:</strong> Budget for property tax (1-2% of value/year), insurance ($800-2,000/year), maintenance (1% of value/year), HOA fees. A $300k home costs $400-800/month beyond mortgage.</p>
                </div>
                
                <div class="info-card">
                    <h4>📈 Investment ROI - Compound Interest Visualization</h4>
                    <p><strong>Year-by-Year Projection:</strong> See exactly how your money grows each year with compound interest. Visual charts show contributions vs growth, helping you understand the power of time in the market.</p>
                    <p><strong>Real Numbers:</strong> $10,000 + $500/month at 7% for 30 years:<br>
                    • You invest: $190,000<br>
                    • Compound interest adds: $432,470<br>
                    • Final value: $622,470 (227% gain)</p>
                    <p><strong>⏰ Time Beats Timing:</strong> Start at 25 vs 35 (same $300/month): $381,000 more by starting 10 years earlier. The Rule of 72: Divide 72 by return rate = years to double money.</p>
                </div>
                
                <div class="info-card">
                    <h4>💼 Salary Calculator - Progressive Tax Brackets</h4>
                    <p><strong>Real Tax Calculation:</strong> Uses actual 2025 federal tax brackets (10%, 12%, 22%, 24%, 32%, 35%, 37%) based on filing status. Shows breakdown by federal, FICA, state, and deductions.</p>
                    <p><strong>$75,000 Single Filer Reality:</strong><br>
                    • Federal tax (progressive): $10,294<br>
                    • FICA (7.65%): $5,738<br>
                    • State (5%): $3,750<br>
                    • 401k (10%): $7,500<br>
                    • Take-home: $47,718 ($3,977/month)</p>
                    <p><strong>Negotiation Insight:</strong> A $5,000 raise nets ~$3,200 after taxes. Ask for $7,500 to actually gain $5,000 in take-home pay.</p>
                </div>

                <div class="info-card">
                    <h4>🎯 Retirement Savings - Inflation-Adjusted Projections</h4>
                    <p><strong>Real-World Accuracy:</strong> Accounts for inflation impact on purchasing power. Shows both nominal (future dollars) and real (today's dollars) values, plus 4% withdrawal rule analysis.</p>
                    <p><strong>The 25x Rule:</strong> Annual expenses × 25 = retirement target. Need $50,000/year → Save $1,250,000. The 4% rule lets you withdraw 4% annually for 30+ years safely.</p>
                    <p><strong>Age Benchmarks:</strong><br>
                    • Age 30: 1× salary saved<br>
                    • Age 40: 3× salary<br>
                    • Age 50: 6× salary<br>
                    • Age 60: 8× salary<br>
                    • Age 67: 10× salary</p>
                    <p><strong>Inflation Reality:</strong> $50,000/year today needs $121,363/year in 30 years (3% inflation). Our calculator shows both figures so you know the real target.</p>
                </div>

                <div class="info-card">
                    <h4>🚗 Car Loan - Smart Financing Analysis</h4>
                    <p><strong>The 20/4/10 Rule Check:</strong> Calculator validates if your purchase meets: 20% down, max 4-year term, total car costs ≤10% of gross income. Helps prevent over-borrowing.</p>
                    <p><strong>$40,000 Car Reality:</strong><br>
                    • Loan: $32,000 (20% down)<br>
                    • Payment: $737 (4 years, 5%)<br>
                    • + Insurance: $150<br>
                    • + Gas: $200<br>
                    • + Maintenance: $100<br>
                    • = Total: $1,187/month</p>
                    <p><strong>Income Needed:</strong> $142,440/year to safely afford (10% rule). Term comparison shows 6-year loan costs $7,000+ more in interest vs 4-year.</p>
                </div>

                <div class="info-card">
                    <h4>💳 Credit Card Payoff - Strategy Comparison</h4>
                    <p><strong>Advanced Analysis:</strong> Compares minimum payment vs recommended payment vs aggressive payoff. Visual timeline shows interest accumulation and provides avalanche vs snowball strategy comparison.</p>
                    <p><strong>$5,000 at 18% APR Examples:</strong><br>
                    • Minimum ($100/mo): 7.5 years, $4,240 interest<br>
                    • Recommended ($200/mo): 2.5 years, $1,322 interest<br>
                    • Aggressive ($300/mo): 1.5 years, $745 interest<br>
                    • Savings: $3,495 by doubling payment!</p>
                    <p><strong>Warning System:</strong> Calculator alerts if payment is below monthly interest, preventing debt spiral where balance grows instead of shrinking.</p>
                </div>

                <div class="info-card">
                    <h4>📊 Budget Calculator - 50/30/20 Rule Analyzer</h4>
                    <p><strong>Smart Budgeting:</strong> Visual pie chart shows your spending breakdown. Compares your budget against the 50/30/20 rule (50% needs, 30% wants, 20% savings) with personalized recommendations.</p>
                    <p><strong>$4,000/month Income:</strong><br>
                    • Needs (50%): $2,000 max<br>
                    • Wants (30%): $1,200 max<br>
                    • Savings (20%): $800 min</p>
                    <p><strong>Housing Alert:</strong> If housing exceeds 30% of income, calculator warns you're "house poor" and suggests adjustments. Tracks multiple expense categories for complete financial picture.</p>
                </div>

                <div class="info-card">
                    <h4>💱 Currency Converter - Live Exchange Rates</h4>
                    <p><strong>Real-Time Data:</strong> Fetches current exchange rates from exchangerate-api.com. Updates automatically every calculation. Covers 16+ major currencies with actual market rates.</p>
                    <p><strong>Fee Awareness:</strong> Shows you the mid-market rate but warns about real-world fees:<br>
                    • Credit cards: 0-3% foreign transaction fee<br>
                    • Banks: 2-4% markup<br>
                    • Airport exchange: 10-15% markup<br>
                    • Best option: No-fee credit cards or ATM withdrawals</p>
                    <p><strong>Travel Planning:</strong> $3,000 trip using airport exchange loses $450 to fees. Using no-fee card saves $420-450 = 2 extra nights accommodation!</p>
                </div>

                <div class="info-card">
                    <h4>📉 Inflation Calculator - Category-Specific Analysis</h4>
                    <p><strong>Beyond Simple Compounding:</strong> Shows purchasing power loss with historical context. Explains that different categories inflate at different rates (healthcare: 5-6%, technology: -2 to 0%, housing: 3-4%).</p>
                    <p><strong>Retirement Impact:</strong> $50,000/year today becomes $121,363 needed in 30 years (3% inflation). Calculator shows both nominal and real values, helping you set accurate savings targets.</p>
                    <p><strong>Historical Reality:</strong><br>
                    • 1970-2024 average: 3.7%<br>
                    • Recent: 2022 spike (8%), now ~3%<br>
                    • Rule of 70: Money loses half its value in 70÷inflation years</p>
                    <p><strong>Salary Trap:</strong> 2% raise with 3% inflation = 1% real pay cut. Need 4-5% raises to actually increase purchasing power.</p>
                </div>
            </div>

            <div class="highlight-box">
                <h3>🚀 Why Use Our Advanced Financial Calculator Suite?</h3>
                <p>Our professional-grade financial calculators provide real-time data, advanced visualizations, and accurate projections for all your money management needs. Unlike basic calculators, we offer:</p>
                <br>
                <p><strong>✓ Real-Time Data:</strong> Live currency exchange rates and current tax brackets<br>
                <strong>✓ Visual Analytics:</strong> Interactive charts and graphs for better understanding<br>
                <strong>✓ Comparison Tools:</strong> Side-by-side scenario analysis<br>
                <strong>✓ Full Amortization:</strong> Complete payment schedules, not just totals<br>
                <strong>✓ Inflation Adjusted:</strong> Real purchasing power projections<br>
                <strong>✓ Progressive Tax:</strong> Accurate bracket-based calculations<br>
                <strong>✓ Print/Export:</strong> Save your calculations for reference<br>
                <strong>✓ Mobile Optimized:</strong> Works perfectly on any device</p>
                <br>
                <p>All calculators are free, require no registration, and respect your privacy. Make informed financial decisions with tools trusted by professionals and individuals worldwide.</p>
            </div>
        </section>

        <!-- Donation Section -->
        <section class="info-section">
            <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; padding: 40px; text-align: center; max-width: 500px; margin: 0 auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border: 1px solid rgba(45, 212, 191, 0.1);">
                <h3 style="background: linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.4rem; font-weight: 700; margin-bottom: 20px;">Buy me a coffee?</h3>
                <p style="color: #475569; font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px;">If RapidPercent helped you make better financial decisions, consider supporting with a small Bitcoin donation. Your support keeps these tools free for everyone!</p>
                <button onclick="document.getElementById('btcAddress').style.display = document.getElementById('btcAddress').style.display === 'none' ? 'block' : 'none'" style="background: linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%); color: white; border: none; padding: 15px 30px; border-radius: 20px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 20px rgba(45, 212, 191, 0.3);" aria-label="Show Bitcoin donation address">Donate Bitcoin</button>
                <div id="btcAddress" style="display: none; margin-top: 20px; background: #f8fafc; border: 2px solid #2dd4bf; border-radius: 12px; padding: 20px;">
                    <p style="margin-bottom: 10px; font-weight: 600; color: #0f172a;">Bitcoin Address:</p>
                    <code style="font-family: monospace; font-size: 0.9rem; color: #0f172a; word-break: break-all; display: block; margin-bottom: 15px;">bc1qxfc70kg5gtavn3mw5nypps970hqkzw6c885ya4</code>
                    <button onclick="copyBitcoinAddress(this)" style="background: #2dd4bf; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer;" aria-label="Copy Bitcoin address to clipboard">Copy Address</button>
                    <p style="color: #059669; font-weight: 600; margin-top: 15px;">Thank you for your support!</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <!-- Modal 1: Loan Calculator -->
    <div id="modal1" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal1-title" aria-describedby="modal1-desc">
    <div class="info-modal-content">
        <h3 id="modal1-title">&#128161; Loan Calculator Guide</h3>
        
        <div id="modal1-desc" class="modal-section">
            <h4>&#127919; What This Calculator Does</h4>
            <p><strong>Primary Function:</strong> Calculates your exact monthly loan payment using the industry-standard amortization formula that banks use.</p>
            <p><strong>Advanced Feature:</strong> Generates a complete payment-by-payment breakdown table showing exactly how much of each payment goes to principal vs. interest over the entire loan lifetime.</p>
            <p><strong>Key Insight:</strong> You'll see how early payments are mostly interest (often 70-80%), while later payments are mostly principal. This visualization helps you understand the true cost of borrowing.</p>
        </div>

        <div class="modal-section">
            <h4>🔧 Step-by-Step Instructions</h4>
            <p><strong>Step 1:</strong> Enter your <strong>Loan Amount</strong> in dollars (the total you're borrowing)</p>
            <p><strong>Step 2:</strong> Enter the <strong>Annual Interest Rate</strong> as a percentage (e.g., 5.5 for 5.5% APR - find this on your loan offer)</p>
            <p><strong>Step 3:</strong> Enter the <strong>Loan Term</strong> in years (how long you have to repay)</p>
            <p><strong>Step 4:</strong> Results calculate automatically! Review:</p>
            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li>Your monthly payment amount</li>
                <li>Total interest you'll pay over the life of the loan</li>
                <li>Complete amortization schedule (scroll through all payments)</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Click "Compare Options" to see how changing the term by ±2 years affects your total interest paid.</p>
            
            <div class="example-box">
                <strong>Real-World Example:</strong><br>
                <strong>Scenario:</strong> $50,000 personal loan at 5.5% APR for 10 years<br><br>
                <strong>Results:</strong><br>
                • Monthly Payment: $542.49<br>
                • Total Interest Paid: $15,098.80 (30% of loan amount!)<br>
                • Total Amount Repaid: $65,098.80<br><br>
                <strong>Payment Breakdown Discovery:</strong><br>
                • Payment #1: $229 interest, $313 principal<br>
                • Payment #60: $140 interest, $402 principal<br>
                • Payment #120: $2 interest, $540 principal<br><br>
                <strong>Key Takeaway:</strong> You pay $15k extra in interest. Making extra payments early saves the most money because it reduces the principal balance faster.
            </div>
        </div>

        <div class="modal-section">
            <h4>💼 Common Use Cases</h4>
            <p><strong>✓ Personal Loans:</strong> Calculate if you can afford the monthly payment before applying. Compare offers from different lenders by seeing total interest.</p>
            <p><strong>✓ Student Loans:</strong> Plan your repayment strategy. See how increasing monthly payment by $100 shortens payoff time and saves thousands.</p>
            <p><strong>✓ Business Equipment Financing:</strong> Budget accurately for equipment purchases. Factor loan payments into your cash flow projections.</p>
            <p><strong>✓ Debt Consolidation:</strong> Compare your current multiple debts vs. a single consolidation loan. See if you'll actually save money.</p>
            <p><strong>✓ Auto Loans:</strong> While we have a dedicated car loan calculator, this works too! See the full amortization schedule banks use.</p>
            <p><strong>✓ Home Improvement Loans:</strong> Calculate payments for renovation projects before committing.</p>
        </div>

        <button class="modal-close-btn" onclick="closeModal('modal1')">Got it ✓</button>
    </div>
</div>

    <!-- Modal 2: Mortgage Calculator -->
    <div id="modal2" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal2-title" aria-describedby="modal2-desc">
        <div class="info-modal-content">
            <h3 id="modal2-title">&#128161; Mortgage Calculator Guide</h3>
            
            <div id="modal2-desc" class="modal-section">
                <h4>&#127919; What This Calculator Does</h4>
                <p><strong>Primary Function:</strong> Calculates your monthly mortgage payment (principal + interest only) using the exact formulas that mortgage lenders use.</p>
                <p><strong>Visual Analysis:</strong> Shows an interactive pie chart breaking down how much of your total payments go to principal vs. interest over the entire loan.</p>
                <p><strong>PMI Warning System:</strong> Automatically detects if your down payment is less than 20% and calculates the additional Private Mortgage Insurance (PMI) cost you'll need to budget for.</p>
                <p><strong>Comparison Tool:</strong> Side-by-side analysis of 15-year vs 30-year mortgages showing the massive interest savings (often $100k+) of shorter terms.</p>
            </div>

            <div class="modal-section">
            <h4>&#128295; Step-by-Step Instructions</h4>
            <p><strong>Step 1:</strong> Enter <strong>Home Price</strong> - the purchase price of the house</p>
            <p><strong>Step 2:</strong> Enter <strong>Down Payment</strong> - how much you're paying upfront (typical: 20% = no PMI, 10% = PMI required, 3.5% = FHA loan minimum)</p>
            <p><strong>Step 3:</strong> Enter <strong>Interest Rate</strong> - the APR from your mortgage quote (e.g., 4.5 means 4.5%)</p>
            <p><strong>Step 4:</strong> Enter <strong>Loan Term</strong> - typically 15 or 30 years</p>
            <p><strong>Step 5:</strong> Review your results:</p>
            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li>Monthly P&I payment (principal + interest)</li>
                <li>Total interest over life of loan</li>
                <li>PMI warning if applicable</li>
                <li>Visual pie chart of payment breakdown</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Click "15 vs 30 Year" to see how much you save in interest with a shorter term (spoiler: it's usually $100,000+). Monthly payment is higher, but you're debt-free 15 years sooner!</p>
            
            <div class="example-box">
                <strong>Real-World Example:</strong><br>
                <strong>Scenario:</strong> $300,000 home, $60,000 down (20%), 4.5% rate, 30 years<br><br>
                <strong>Loan Details:</strong><br>
                • Amount Financed: $240,000<br>
                • Down Payment: 20% ✓ (No PMI required!)<br><br>
                <strong>30-Year Mortgage:</strong><br>
                • Monthly Payment: $1,216<br>
                • Total Interest: $197,757<br>
                • Total Paid: $437,757<br><br>
                <strong>15-Year Mortgage (same loan):</strong><br>
                • Monthly Payment: $1,835 (+$619/month)<br>
                • Total Interest: $90,280<br>
                • Total Paid: $330,280<br>
                • <strong>Savings: $107,477!</strong><br><br>
                <strong>Key Insight:</strong> The pie chart reveals that with a 30-year mortgage, you pay almost as much in interest ($197k) as you borrowed ($240k). With 15 years, interest is only 38% of principal.<br><br>
                <strong>Hidden Costs Not Included:</strong> Remember to budget for property tax (~$3,000-6,000/year), homeowner's insurance (~$1,000-2,000/year), and maintenance (1% of home value/year). Your actual monthly housing cost will be $300-800 more than the mortgage payment!
            </div>
        </div>

        <div class="modal-section">
            <h4>💼 Common Use Cases</h4>
            <p><strong>✓ First-Time Home Buyers:</strong> Determine what monthly payment you can afford BEFORE house hunting. Rule of thumb: total housing costs ≤ 28% of gross income.</p>
            <p><strong>✓ Down Payment Planning:</strong> See exactly how much PMI costs if you put down less than 20%. Often $100-200/month! Decide if waiting to save more is worth it.</p>
            <p><strong>✓ Refinancing Decision:</strong> Compare your current mortgage payment vs. refinancing at today's rates. Calculate break-even point factoring in closing costs.</p>
            <p><strong>✓ Rate Shopping:</strong> Compare offers from different lenders. A 0.5% rate difference = tens of thousands in savings over 30 years.</p>
            <p><strong>✓ Affordability Analysis:</strong> Work backwards - if you can afford $1,500/month, what's your maximum home price? Adjust inputs until monthly payment fits your budget.</p>
            <p><strong>✓ 15 vs 30 Year Decision:</strong> See if you can afford the higher payment of a 15-year mortgage. Building equity twice as fast and saving $100k+ in interest is powerful.</p>
            <p><strong>✓ Investment Property Analysis:</strong> Calculate if rental income will cover the mortgage payment. Include property management fees and vacancy estimates.</p>
        </div>

        <button class="modal-close-btn" onclick="closeModal('modal2')">Got it ✓</button>
    </div>
</div>
			
    <div id="modal3" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal3-title" aria-describedby="modal3-desc">
    <div class="info-modal-content">
        <h3 id="modal3-title">&#128161; Investment ROI Calculator Guide</h3>
        
        <div id="modal3-desc" class="modal-section">
            <h4>&#127919; What This Calculator Does</h4>
            <p><strong>Primary Function:</strong> Projects how your investments will grow over time using compound interest calculations - the same math that makes the rich richer!</p>
            <p><strong>Two Growth Sources:</strong> Calculates growth from both your initial lump sum AND ongoing monthly contributions, showing how consistent investing multiplies wealth.</p>
            <p><strong>Visual Timeline:</strong> Interactive line chart shows your contributions (what you put in) vs. portfolio value (what it grows to) year by year. You'll see the "hockey stick" curve where growth accelerates exponentially in later years.</p>
            <p><strong>Year-by-Year Breakdown:</strong> Detailed table showing exactly how much your portfolio is worth at each year milestone, plus how much came from contributions vs. compound growth.</p>
        </div>

        <div class="modal-section">
            <h4>&#128295; Step-by-Step Instructions</h4>
            <p><strong>Step 1:</strong> Enter <strong>Initial Investment</strong> - the lump sum you're starting with (can be $0 if you're starting from scratch)</p>
            <p><strong>Step 2:</strong> Enter <strong>Expected Annual Return</strong> percentage:</p>
            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li><strong>Conservative (3-5%):</strong> Bonds, savings accounts, CDs</li>
                <li><strong>Moderate (7-8%):</strong> Balanced portfolio, real estate</li>
                <li><strong>Aggressive (10-12%):</strong> Stock market (S&P 500 historical average is 10%)</li>
                <li><strong>Very Aggressive (15%+):</strong> Individual stocks, high-risk investments</li>
            </ul>
            <p><strong>Step 3:</strong> Enter <strong>Investment Period</strong> in years - how long you plan to invest</p>
            <p><strong>Step 4:</strong> Enter <strong>Monthly Contribution</strong> (optional but powerful!) - amount you'll invest each month consistently</p>
            <p><strong>Step 5:</strong> Review results:</p>
			<ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li>Final portfolio value</li>
                <li>Total you contributed (your money)</li>
                <li>Investment growth (free money from compound interest!)</li>
                <li>Return on Investment (ROI) percentage</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Click "Year-by-Year" to see the compound interest magic in action. Notice how in early years growth is slow, but by years 15-20 your money is doubling every 7-10 years (Rule of 72)!</p>
            
            <div class="example-box">
                <strong>Real-World Example:</strong><br>
                <strong>Scenario:</strong> $10,000 initial + $500/month at 7% annual return for 20 years<br><br>
                <strong>Your Contributions:</strong><br>
                • Initial: $10,000<br>
                • Monthly contributions: $500 × 240 months = $120,000<br>
                • <strong>Total YOU invested: $130,000</strong><br><br>
                <strong>Investment Growth (Compound Interest):</strong><br>
                • Growth from compounding: $132,481<br>
                • <strong>Final Portfolio Value: $262,481</strong><br>
                • <strong>ROI: 102%</strong> (you doubled your money!)<br><br>
                <strong>The Hockey Stick Effect:</strong><br>
                • Year 5: $41,519 (mostly your contributions)<br>
                • Year 10: $93,448 (growth accelerating)<br>
                • Year 15: $162,633 (compound interest taking over)<br>
                • Year 20: $262,481 (exponential growth!)<br><br>
                <strong>Key Insight:</strong> In the final 5 years alone, your portfolio grows by $99,848 - that's almost as much as you contributed in the ENTIRE first 10 years. This is compound interest working its magic!<br><br>
                <strong>Time Beats Timing:</strong> Starting at age 25 vs age 35 (same $500/month) results in $381,000 MORE by age 65. The best time to start investing was yesterday. The second best time is today.
            </div>
        </div>

        <div class="modal-section">
            <h4>💼 Common Use Cases</h4>
            <p><strong>✓ Retirement Planning (401k/IRA):</strong> See if your current savings rate will give you enough for retirement. Most financial advisors recommend saving 15% of income. Test different scenarios!</p>
            <p><strong>✓ Financial Independence Goal:</strong> Calculate how long until you reach $1 million (or whatever your target is). Adjust monthly contributions to see what's needed.</p>
            <p><strong>✓ College Savings (529 Plan):</strong> If college costs $200k in 18 years, how much do you need to save monthly? Work backwards from your goal.</p>
            <p><strong>✓ House Down Payment:</strong> Saving for a $60k down payment? See how long it takes at different contribution levels and investment returns.</p>
            <p><strong>✓ Comparing Investment Options:</strong> Should you choose the safe bond fund (5% return) or stock index fund (10% return)? The difference is MASSIVE over 20+ years.</p>
            <p><strong>✓ Wealth Building Strategy:</strong> Visualize how "paying yourself first" with automatic investments builds serious wealth. Even $200/month becomes $163k in 25 years at 8% return.</p>
            <p><strong>✓ Emergency Fund Planning:</strong> Calculate how long to build a 6-month emergency fund if you save $300/month with minimal returns (2-3% in high-yield savings).</p>
        </div>

        <button class="modal-close-btn" onclick="closeModal('modal3')">Got it ✓</button>
    </div>
</div>
	
    <!-- Modal 4: Salary Calculator -->
    <div id="modal4" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal4-title" aria-describedby="modal4-desc">
        <div class="info-modal-content">
            <h3 id="modal4-title">&#128161; Advanced Salary Calculator</h3>
            
            <div id="modal4-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Calculates your actual take-home pay using real 2025 federal tax brackets with progressive taxation (not flat rate - much more accurate!).</p>
    <p><strong>Tax Breakdown:</strong> Shows exactly where your money goes: federal income tax (using 7 bracket tiers), FICA (Social Security 6.2% + Medicare 1.45%), state tax, and pre-tax deductions.</p>
    <p><strong>Multiple Pay Periods:</strong> Displays your net income as annual, monthly, weekly, daily, and hourly so you know your real earnings in any format.</p>
    <p><strong>Effective Tax Rate:</strong> Calculates your true tax percentage (not your marginal bracket) - most people are surprised it's lower than they think!</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter your <strong>Gross Annual Salary</strong> - the amount before any deductions (what's on your job offer)</p>
    <p><strong>Step 2:</strong> Select <strong>Filing Status</strong> from dropdown:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>Single:</strong> Unmarried, no dependents</li>
        <li><strong>Married Filing Jointly:</strong> Married, filing together (best rates)</li>
        <li><strong>Head of Household:</strong> Unmarried with dependents</li>
    </ul>
    <p><strong>Step 3:</strong> Enter <strong>State Tax Rate</strong> percentage. Common rates:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>0%:</strong> AK, FL, NV, SD, TN, TX, WA, WY (no income tax!)</li>
        <li><strong>3-5%:</strong> Most states with flat tax</li>
        <li><strong>5-10%:</strong> Progressive tax states (CA, NY can go higher)</li>
    </ul>
    <p><strong>Step 4:</strong> Enter <strong>Pre-tax Deductions</strong> like 401k contributions, HSA, flexible spending accounts (these reduce your taxable income!)</p>
    <p><strong>Step 5:</strong> Review your breakdown showing net income in all formats</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Increasing 401k contributions reduces your taxable income AND builds retirement savings. Every $1,000 more saves you ~$220 in federal taxes (22% bracket).</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> $75,000 gross salary, Single filer, 5% state tax, $5,000 in 401k<br><br>
        <strong>Tax Calculation (Progressive Brackets):</strong><br>
        • First $11,600 taxed at 10% = $1,160<br>
        • Next $35,550 taxed at 12% = $4,266<br>
        • Next $23,850 taxed at 22% = $5,247<br>
        • Remaining $0 taxed at 24%+ = $0<br>
        • <strong>Total Federal Tax: $10,673</strong><br><br>
        <strong>Other Deductions:</strong><br>
        • FICA (7.65%): $5,738<br>
        • State Tax (5% on $70k taxable): $3,500<br>
        • 401k Contribution: $5,000<br><br>
        <strong>Final Take-Home:</strong><br>
        • Net Annual: $50,089<br>
        • Net Monthly: $4,174<br>
        • Net Weekly: $963<br>
        • Net Daily: $193<br>
        • Net Hourly: $24.08<br><br>
        <strong>Key Insight:</strong> Your advertised salary is $75k but your spending power is only $50k. That's 33% gone to taxes! This is why budgeting on gross income fails.<br><br>
        <strong>Effective Tax Rate:</strong> 26.2% (even though you're in the 22% "tax bracket" - people confuse marginal vs effective rates!)<br><br>
        <strong>401k Magic:</strong> That $5k contribution saved you $1,100 in federal taxes + $250 in state taxes = $1,350 tax savings while building retirement!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Comparing Job Offers:</strong> Don't just compare salaries! A $80k job in Texas (0% state tax) nets MORE than a $85k job in California (9-13% state tax). Calculate both to see real difference.</p>
    <p><strong>✓ Budget Planning:</strong> Base your monthly budget on net monthly income ($4,174 in example), not gross. Prevents overspending and credit card debt.</p>
    <p><strong>✓ Negotiating Raises:</strong> Know that a $5k raise only nets ~$3,200 after taxes. Ask for $7,500 if you want $5k more take-home.</p>
    <p><strong>✓ 401k Contribution Planning:</strong> See how increasing retirement contributions reduces taxes NOW while building wealth. It's not really "costing" you the full amount.</p>
    <p><strong>✓ Relocation Decisions:</strong> Moving from CA (13% state tax) to FL (0% state tax) on $100k salary = $13k/year extra take-home. That's $1,083/month!</p>
    <p><strong>✓ Side Hustle Tax Planning:</strong> Add side income to see how it's taxed at your marginal rate (top bracket). $10k side hustle in 22% bracket = only $7,800 after federal taxes.</p>
    <p><strong>✓ Bonus Tax Calculation:</strong> Bonuses are taxed same as regular income (despite feeling different). See real impact before spending that bonus check!</p>
</div>

            <button class="modal-close-btn" onclick="closeModal('modal4')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 5: Retirement Savings Calculator -->
    <div id="modal5" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal5-title" aria-describedby="modal5-desc">
        <div class="info-modal-content">
            <h3 id="modal5-title">&#128161; Retirement Savings Calculator</h3>
            
            <div id="modal5-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Projects your retirement savings growth accounting for compound interest AND inflation to show real purchasing power in retirement.</p>
    <p><strong>Dual Value Display:</strong> Shows both nominal dollars (what your account will say) and real dollars (what it's actually worth in today's purchasing power after inflation).</p>
    <p><strong>4% Rule Calculator:</strong> Automatically calculates safe annual withdrawal amount using the Trinity Study's 4% rule - how much income your nest egg can generate for 30+ years.</p>
    <p><strong>Age-Based Benchmarks:</strong> Compares your projected savings against Fidelity's recommended targets (1Ã— salary at 30, 3Ã— at 40, 6Ã— at 50, 8Ã— at 60, 10Ã— at 67).</p>
    <p><strong>Visual Growth Chart:</strong> Interactive chart showing nominal vs real value over time so you can see inflation's impact clearly.</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter your <strong>Current Age</strong> (18-100)</p>
    <p><strong>Step 2:</strong> Enter <strong>Retirement Age</strong> - traditional is 65-67, but many target 55-60 (early retirement) or 70+ (work longer)</p>
    <p><strong>Step 3:</strong> Enter <strong>Current Savings</strong> - total in all retirement accounts (401k, IRA, Roth, etc.) today</p>
    <p><strong>Step 4:</strong> Enter <strong>Monthly Contribution</strong> - how much you'll save each month going forward. Financial advisors recommend 15% of gross income.</p>
    <p><strong>Step 5:</strong> Enter <strong>Expected Annual Return</strong>:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>5-6%:</strong> Conservative (bonds, CDs)</li>
        <li><strong>7-8%:</strong> Moderate (balanced portfolio) - recommended default</li>
        <li><strong>10%:</strong> Aggressive (stock-heavy, historical S&P 500 average)</li>
    </ul>
    <p><strong>Step 6:</strong> Enter <strong>Expected Inflation</strong> - 3% is historical US average (2-4% range is normal)</p>
    <p><strong>Step 7:</strong> Review results and click "Detailed Analysis" to see age benchmarks</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> The difference between nominal and real value shows why you need MORE than you think! $2 million in 35 years only has $774k purchasing power at 3% inflation.</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> Age 30, retire at 65, $50,000 currently saved, $1,000/month contribution, 7% return, 3% inflation<br><br>
        <strong>Time Period:</strong><br>
        • Years to retirement: 35<br>
        • Total months: 420<br><br>
        <strong>Your Contributions Over Time:</strong><br>
        • Current savings: $50,000<br>
        • Monthly contributions: $1,000 × 420 = $420,000<br>
        • <strong>Total invested: $470,000</strong><br><br>
        <strong>Compound Growth Magic:</strong><br>
        • Investment growth: $1,715,296<br>
        • <strong>Final value (nominal): $2,185,296</strong><br>
        • Final value (real/today's $): $774,654<br><br>
        <strong>The 4% Rule:</strong><br>
        • Safe annual withdrawal: $87,412<br>
        • Safe monthly income: $7,284<br>
        • This withdrawal rate can sustain 30+ years per historical data<br><br>
        <strong>Age Benchmark Status:</strong><br>
        • Age 30: Need 1× salary ($60k est) → You'll have $50k ⚠️<br>
        • Age 40: Need 3× salary ($180k) → On track ✅<br>
        • Age 50: Need 6× salary ($360k) → On track ✅<br>
        • Age 60: Need 8× salary ($480k) → Exceeds target ✅<br>
        • Age 67: Need 10× salary ($600k) → Far exceeds! ✅<br><br>
        <strong>Key Insight:</strong> You invested $470k but ended with $2.2M nominal. That's 4.6× your contributions! However, due to inflation, the real purchasing power is only $774k - still 1.6× what you put in.<br><br>
        <strong>The Inflation Warning:</strong> If you retired today with $2.2M, you'd live very comfortably. But in 35 years, $2.2M will feel more like $775k feels today. Always plan with inflation!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Retirement Readiness Check:</strong> Are you on track? Compare against age benchmarks. If behind, increase monthly contributions or delay retirement 2-3 years.</p>
    <p><strong>✓ Monthly Contribution Planning:</strong> Start with what you can afford, see projected result. Not enough? Work backwards from desired retirement income to find needed monthly savings.</p>
    <p><strong>✓ Late Start Recovery:</strong> Started saving at 40? Calculator shows you need higher contributions but IT'S NOT TOO LATE. Even 25 years of aggressive saving can build substantial nest egg.</p>
    <p><strong>✓ Early Retirement Planning (FIRE):</strong> Want to retire at 50? See that you need 25× your annual expenses saved (4% rule). Adjust monthly contributions to hit that target.</p>
    <p><strong>✓ Catch-Up Contributions:</strong> Age 50+ can contribute extra to 401k ($7,500 more/year in 2025). See how this accelerates your final number.</p>
    <p><strong>✓ Social Security Supplement:</strong> Social Security provides ~$20-40k/year. Calculate how much personal savings needed to reach your desired retirement income.</p>
    <p><strong>✓ Inheritance/Windfall Planning:</strong> Got $100k inheritance? See how investing it now vs. spending it affects your retirement 30 years from now (often $500k+ difference!).</p>
</div>
						
            <button class="modal-close-btn" onclick="closeModal('modal5')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 6: Car Loan Calculator -->
    <div id="modal6" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal6-title" aria-describedby="modal6-desc">
        <div class="info-modal-content">
            <h3 id="modal6-title">&#128161; Car Loan Calculator</h3>
            
            <div id="modal6-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Calculates exact monthly car loan payment with total interest cost over the loan term.</p>
    <p><strong>20/4/10 Rule Validator:</strong> Automatically checks if your purchase follows smart car buying rules: 20% down payment, max 4-year loan, total car costs â‰¤10% of gross income.</p>
    <p><strong>Total Ownership Cost:</strong> Estimates REAL monthly cost including loan payment + insurance + gas + maintenance (the "hidden" costs dealers don't mention!).</p>
    <p><strong>Income Requirement Calculator:</strong> Tells you exactly what annual income you need to safely afford this car using the 10% rule.</p>
    <p><strong>Term Comparison Tool:</strong> Shows side-by-side how 3, 4, 5, and 6-year loans compare in monthly payment vs total interest paid.</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter <strong>Car Price</strong> - the sticker price or negotiated price BEFORE trade-in/down payment</p>
    <p><strong>Step 2:</strong> Enter <strong>Down Payment</strong> - cash + trade-in value. Aim for 20%+ to:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li>Avoid being "underwater" (owing more than car's worth)</li>
        <li>Get better interest rates</li>
        <li>Lower monthly payments significantly</li>
    </ul>
    <p><strong>Step 3:</strong> Enter <strong>Interest Rate</strong> - what the dealer/bank quoted you (APR). Typical ranges:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>Excellent credit (750+):</strong> 3-5%</li>
        <li><strong>Good credit (700-749):</strong> 5-7%</li>
        <li><strong>Fair credit (650-699):</strong> 7-10%</li>
        <li><strong>Poor credit (&lt;650):</strong> 10-15%+ (consider fixing credit first!)</li>
    </ul>
    <p><strong>Step 4:</strong> Enter <strong>Loan Term</strong> in years. Financial experts recommend MAX 4 years, but dealers push 6-7 years (DO NOT FALL FOR THIS!).</p>
    <p><strong>Step 5:</strong> Review results and click "Compare Terms" to see interest cost differences</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> That 6-year loan might have a "lower payment" but you'll pay THOUSANDS more in interest AND be underwater for years (car depreciates faster than you pay it off).</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> $35,000 car, $7,000 down (20%), 4.5% APR, 5-year term<br><br>
        <strong>Loan Details:</strong><br>
        • Car price: $35,000<br>
        • Down payment: $7,000 (20% ✓)<br>
        • Amount financed: $28,000<br><br>
        <strong>5-Year Loan Results:</strong><br>
        • Monthly payment: $522<br>
        • Total interest: $3,323<br>
        • Total paid: $31,323<br><br>
        <strong>20/4/10 Rule Check:</strong><br>
        • 20% down: ✓ Met ($7k is 20%)<br>
        • 4-year max: ⚠️ Failed (5 years selected)<br>
        • 10% income rule: Need $78,480/year<br><br>
        <strong>REAL Monthly Cost (Total Ownership):</strong><br>
        • Loan payment: $522<br>
        • Insurance estimate: $150<br>
        • Gas estimate: $200<br>
        • Maintenance: $100<br>
        • <strong>TOTAL: $972/month</strong><br><br>
        <strong>Term Comparison (same car):</strong><br>
        • 3-year: $846/month, $2,062 interest ✓ BEST<br>
        • 4-year: $640/month, $2,752 interest ✓ Recommended<br>
        • 5-year: $522/month, $3,323 interest ⚠️<br>
        • 6-year: $442/month, $3,871 interest ❌ Underwater<br><br>
        <strong>Savings:</strong> 3-year vs 6-year = $1,809 interest saved + debt-free 3 years sooner!<br><br>
        <strong>The Underwater Trap:</strong> With 6-year loan, after 3 years you owe $15,400 but car worth only $12,600. You're stuck - can't trade in or sell without paying $2,800 out of pocket!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Pre-Shopping Budget:</strong> Calculate affordability BEFORE going to dealership. Salespeople will try to sell you on "just $50 more per month" - know your limit!</p>
    <p><strong>✓ Dealer Negotiation:</strong> Arrive with your own numbers. When dealer says "$400/month" ask "at what interest rate and term?" Often it's 7 years at inflated APR.</p>
    <p><strong>✓ New vs Used Decision:</strong> Compare $35k new car vs $25k used car. That $10k difference is $186/month saved plus lower insurance. Over 4 years that's $8,928 + insurance savings!</p>
    <p><strong>✓ Down Payment Planning:</strong> See how saving extra 3 months for bigger down payment drops monthly payment $100+ AND saves thousands in interest.</p>
    <p><strong>✓ Trade-In Value Check:</strong> Dealer offered $5k trade-in? Add it to down payment and see new monthly payment. Compare vs selling privately for $6,500.</p>
    <p><strong>✓ Lease vs Buy Comparison:</strong> Calculate loan payment. If lease is similar monthly cost but you own nothing after 3 years, buying wins long-term.</p>
    <p><strong>✓ Income Qualification:</strong> Worried about approval? See what income lenders expect. If you're under the 10% rule threshold, consider cheaper car or bigger down payment.</p>
</div>
            <button class="modal-close-btn" onclick="closeModal('modal6')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 7: Credit Card Payoff Calculator -->
    <div id="modal7" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal7-title" aria-describedby="modal7-desc">
        <div class="info-modal-content">
            <h3 id="modal7-title">&#128161; Credit Card Payoff Calculator</h3>
            
            <div id="modal7-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Calculates exactly when you'll be debt-free and how much interest you'll pay based on your monthly payment amount.</p>
    <p><strong>Debt Spiral Detector:</strong> BLOCKS calculation if your payment doesn't even cover the monthly interest charge (preventing you from unknowingly growing your debt).</p>
    <p><strong>Visual Payoff Timeline:</strong> Interactive chart shows your balance decreasing month-by-month and cumulative interest piling up over time.</p>
    <p><strong>Strategy Comparison Tool:</strong> Compares minimum payment vs. current payment vs. aggressive payment (current + $50, +$100) showing time saved and interest saved for each approach.</p>
    <p><strong>Warning System:</strong> Alerts if payment is below recommended minimums (typically 2-3% of balance), helping you avoid the "eternal debt trap."</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter <strong>Current Balance</strong> - total amount you owe (find on your latest statement)</p>
    <p><strong>Step 2:</strong> Enter <strong>APR</strong> (Annual Percentage Rate) - the interest rate on your card. Common ranges:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>Excellent credit:</strong> 14-17% (still high!)</li>
        <li><strong>Average credit:</strong> 18-22%</li>
        <li><strong>Poor credit:</strong> 24-29% (predatory rates)</li>
        <li>Find yours on statement under "Interest Rate" or "APR"</li>
    </ul>
    <p><strong>Step 3:</strong> Enter <strong>Monthly Payment</strong> - how much you plan to pay each month. Important notes:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>Minimum payment:</strong> Usually 2-3% of balance (keeps you in debt FOREVER)</li>
        <li><strong>Recommended:</strong> At least 5% of balance or $100, whichever is higher</li>
        <li><strong>Aggressive:</strong> 10%+ of balance to escape debt quickly</li>
    </ul>
    <p><strong>Step 4:</strong> If calculator shows RED warning that payment is too low, you MUST increase it or your debt will grow, not shrink!</p>
    <p><strong>Step 5:</strong> Click "Compare Strategies" to see how small payment increases have MASSIVE impact</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Credit card interest compounds DAILY. Every extra dollar you pay goes directly to principal, immediately reducing daily interest charges. Even $25 extra per month makes a big difference!</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> $5,000 balance at 18.5% APR (typical credit card rate)<br><br>
        <strong>Monthly Interest Charge:</strong><br>
        • 18.5% ÷ 12 = 1.54% per month<br>
        • $5,000 × 1.54% = $77 interest EVERY MONTH<br>
        • Any payment under $77 makes your debt GROW!<br><br>
        <strong>Payment Strategy Comparison:</strong><br><br>
        <strong>$100/month (Minimum - 2%):</strong><br>
        • Payoff time: 7 years 6 months<br>
        • Total interest paid: $4,240<br>
        • Total paid: $9,240 (almost double!)<br>
        • Final payment date: June 2032<br><br>
        <strong>$200/month (Recommended):</strong><br>
        • Payoff time: 2 years 6 months<br>
        • Total interest paid: $1,322<br>
        • Total paid: $6,322<br>
        • Final payment date: May 2027<br>
        • <strong>Savings vs minimum: $2,918 + 5 years sooner!</strong><br><br>
        <strong>$300/month (Aggressive):</strong><br>
        • Payoff time: 1 year 6 months<br>
        • Total interest paid: $745<br>
        • Total paid: $5,745<br>
        • Final payment date: May 2026<br>
        • <strong>Savings vs minimum: $3,495 + 6 years sooner!</strong><br><br>
        <strong>The $50 Extra Rule:</strong><br>
        Paying just $50 more per month ($150 total) saves you $1,858 in interest and gets you debt-free 3 years earlier. That's $50 × 30 months = $1,500 paid early saving you $1,858!<br><br>
        <strong>Key Insight:</strong> With minimum payments, $4,240 of your $9,240 total (46%!) is pure interest. You're working for the credit card company, not yourself.<br><br>
        <strong>Debt Spiral Example:</strong><br>
        If you tried paying $50/month (below the $77 interest), your balance would INCREASE by $27/month. After 1 year you'd owe $5,324 instead of paying anything off!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Debt Payoff Planning:</strong> Create realistic timeline to become debt-free. Print results and track monthly progress - watching balance decrease is motivating!</p>
    <p><strong>✓ Payment Optimization:</strong> Test what happens if you skip that $100 dinner out and put it toward debt instead. Often 1-2 sacrifices per month = debt-free YEARS earlier.</p>
	<p><strong>✓ Balance Transfer Decision:</strong> If you're paying 22% APR and get 0% balance transfer offer for 18 months, see how much you'll save. Often worth the 3-5% transfer fee.</p>
    <p><strong>✓ Emergency Validation:</strong> Had emergency expense that maxed your card? Calculate if your planned payment will even make progress or if you're in danger zone.</p>
    <p><strong>✓ Multiple Card Strategy:</strong> Have 3 cards? Calculate each separately. Pay minimums on two, attack highest interest card aggressively (avalanche method). When paid off, roll that payment to next card.</p>
    <p><strong>✓ Motivation Tracker:</strong> Recalculate every 3-6 months. Seeing "2 years left" become "1.5 years left" keeps you going! Celebrate milestones (under $4k, under $3k, etc.).</p>
    <p><strong>✓ Interest Cost Reality Check:</strong> Show family members/friends who carry balances. Most don't realize minimum payments cost THOUSANDS in interest. Share your calculator results!</p>
    <p><strong>✓ Budget Adjustment Planning:</strong> Calculator shows you need $250/month to be debt-free in 2 years. Go to budget calculator, find $250 to cut. Common: streaming services ($50), eating out ($100), impulse shopping ($100).</p>
</div>
            <button class="modal-close-btn" onclick="closeModal('modal7')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 8: Budget Calculator -->
    <div id="modal8" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal8-title" aria-describedby="modal8-desc">
        <div class="info-modal-content">
            <h3 id="modal8-title">&#128161; Budget Calculator</h3>
            
            <div id="modal8-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Tracks your income vs expenses to show if you have a surplus (saving money) or deficit (going into debt each month).</p>
    <p><strong>Visual Breakdown:</strong> Colorful pie chart shows what percentage of income goes to each category - makes overspending instantly obvious.</p>
    <p><strong>50/30/20 Rule Analyzer:</strong> Compares your actual spending against the famous budgeting rule: 50% for needs, 30% for wants, 20% for savings/debt payoff.</p>
    <p><strong>Warning System:</strong> Automatically flags if you're "house poor" (housing over 30%), not saving enough (under 20%), or overspending in any category.</p>
    <p><strong>Personalized Recommendations:</strong> Gives specific advice on which categories to reduce and by how much to achieve balanced budget.</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter <strong>Monthly Income</strong> - your NET take-home pay (after taxes). If paid biweekly, multiply paycheck × 2.17. Use salary calculator first if unsure!</p>
    <p><strong>Step 2:</strong> Enter <strong>Housing</strong> - rent/mortgage + utilities + insurance + HOA. Everything to keep roof over head. Rule: Should be ≤30% of income.</p>
    <p><strong>Step 3:</strong> Enter <strong>Food & Groceries</strong> - supermarket + restaurants + takeout + coffee shops. Be honest! Check last month's credit card statements.</p>
    <p><strong>Step 4:</strong> Enter <strong>Transportation</strong> - car payment + insurance + gas + parking + maintenance + public transit. Everything to get around.</p>
    <p><strong>Step 5:</strong> Enter <strong>Other Expenses</strong> - everything else:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li>Streaming services (Netflix, Spotify, etc.)</li>
        <li>Phone/internet bills</li>
        <li>Clothing, shopping, entertainment</li>
        <li>Gym membership, hobbies</li>
        <li>Credit card payments, student loans</li>
        <li>Pet expenses, child care</li>
    </ul>
    <p><strong>Step 6:</strong> Review pie chart and surplus/deficit result</p>
    <p><strong>Step 7:</strong> Click "50/30/20 Check" for detailed analysis with progress bars showing if you meet recommended guidelines</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Track expenses for 1 full month using bank/credit card statements to get REAL numbers. Most people underestimate spending by 20-30% when guessing!</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> $5,000 monthly net income (after taxes)<br><br>
        <strong>Expense Breakdown:</strong><br>
        • Housing: $1,500 (rent, utilities, insurance)<br>
        • Food: $600 (groceries $400, dining out $200)<br>
        • Transportation: $400 (car payment $250, gas $100, insurance $50)<br>
        • Other: $800 (streaming $40, phone $80, shopping $300, entertainment $200, misc $180)<br>
        • <strong>Total Expenses: $3,300</strong><br><br>
        <strong>Result:</strong><br>
        • <strong>Monthly Surplus: $1,700 (34%)</strong> ✅ EXCELLENT!<br>
        • You're living on 66% of income<br>
        • Available for savings/investing/debt payoff<br><br>
        <strong>50/30/20 Analysis:</strong><br><br>
        <strong>Needs (Housing + Food + Transport):</strong><br>
        • Your spending: $2,500 (50% of income) ✅<br>
        • Recommended: ≤$2,500 (50%)<br>
        • Status: Perfect! You're meeting basic needs efficiently<br><br>
        <strong>Wants (Other expenses):</strong><br>
        • Your spending: $800 (16% of income) ✅<br>
        • Recommended: ≤$1,500 (30%)<br>
        • Status: Excellent! You have room for $700 more "fun money" if desired<br><br>
        <strong>Savings/Debt Payoff:</strong><br>
        • Your surplus: $1,700 (34% of income) ✅<br>
        • Recommended: ≥$1,000 (20%)<br>
        • Status: Exceeding target by 14%! You're building wealth fast<br><br>
        <strong>Pie Chart Breakdown:</strong><br>
        • Housing: 30% (green slice)<br>
        • Food: 12% (orange slice)<br>
        • Transportation: 8% (yellow slice)<br>
        • Other: 16% (purple slice)<br>
        • Surplus: 34% (teal slice - this is your future!)<br><br>
        <strong>What This Person Should Do:</strong><br>
        1. Invest $1,200/month in retirement (401k, IRA)<br>
        2. Build 6-month emergency fund ($19,800)<br>
        3. Save remaining $500 for goals (vacation, house down payment)<br><br>
        <strong>Contrast: Struggling Budget Example:</strong><br>
        $4,000 income, $2,400 housing (60% - house poor!), $500 food, $600 transport, $800 other = $4,300 spending<br>
        • Deficit: -$300/month (going into debt!)<br>
        • Savings: 0% (no emergency fund, no retirement)<br>
        • Warnings: Housing too high, need cheaper place or roommate
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Monthly Financial Checkup:</strong> Do this every month! Like weighing yourself when dieting. Catches spending creep early before it becomes crisis.</p>
    <p><strong>✓ Finding Money for Goals:</strong> Want to save $500/month for house down payment? Run budget, see you're spending $300 on "other" that could be cut. Boom, found it!</p>
    <p><strong>✓ Debt Payoff Planning:</strong> Use with credit card calculator. Budget shows you have $400 surplus - put it ALL toward highest-interest debt. Coordinate both calculators!</p>
    <p><strong>✓ Lifestyle Inflation Prevention:</strong> Got raise? Run budget before AND after to ensure you're saving the raise, not spending it all on lifestyle upgrades ("keeping up with Joneses").</p>
    <p><strong>✓ Couples Financial Planning:</strong> Combine both incomes and expenses. Often reveals one person is carrying more financial burden or spending patterns causing friction.</p>
    <p><strong>✓ Apartment Affordability:</strong> Landlord requires proof you earn 3× rent. Budget calculator confirms if you can actually AFFORD it even if you qualify (30% rule).</p>
    <p><strong>✓ Emergency Fund Planning:</strong> Budget shows $800 monthly surplus. Put $500 toward emergency fund, keep $300 flexible. You'll have 6 months expenses saved in 15 months!</p>
    <p><strong>✓ Subscription Audit:</strong> Budget reveals "other" is 25% of income. List all subscriptions - Netflix, Spotify, gym, apps. Cut unused ones, save $100-200/month easy.</p>
    <p><strong>✓ Income Increase Validation:</strong> Considering side hustle? Current budget shows $200 deficit. Side hustle earning $500/month would create $300 surplus. Worth it? Calculator shows yes!</p>
</div>

            <button class="modal-close-btn" onclick="closeModal('modal8')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 9: Currency Converter -->
    <div id="modal9" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal9-title" aria-describedby="modal9-desc">
        <div class="info-modal-content">
            <h3 id="modal9-title">&#128161; Currency Converter</h3>
            
            <div id="modal9-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Converts any amount between 16+ major world currencies using LIVE exchange rates that update every hour from exchangerate-api.com.</p>
    <p><strong>Mid-Market Rate:</strong> Shows the "true" exchange rate - the rate banks use when trading with each other (what you see on Google/financial news).</p>
    <p><strong>Real-World Fee Warning:</strong> Displays what you'll ACTUALLY receive after typical fees from credit cards (1-3%), banks (2-4%), and currency exchanges (5-15%).</p>
    <p><strong>Savings Calculator:</strong> Shows exactly how much you save using no-fee credit cards vs. airport exchanges (often $100-200 savings on $1,000!).</p>
    <p><strong>Rate Timestamp:</strong> Tells you when rates were last updated so you know if you're seeing current market conditions.</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter <strong>Amount</strong> you want to convert (in source currency)</p>
    <p><strong>Step 2:</strong> Select <strong>From Currency</strong> dropdown - the currency you have. Popular options:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>USD</strong> - US Dollar</li>
        <li><strong>EUR</strong> - Euro (Eurozone countries)</li>
        <li><strong>GBP</strong> - British Pound</li>
        <li><strong>JPY</strong> - Japanese Yen</li>
        <li><strong>CAD</strong> - Canadian Dollar</li>
        <li>+ 11 more major currencies</li>
    </ul>
    <p><strong>Step 3:</strong> Select <strong>To Currency</strong> dropdown - the currency you want</p>
    <p><strong>Step 4:</strong> Result shows instantly with:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li>Converted amount at mid-market rate</li>
        <li>Exchange rate (1 from = X to)</li>
        <li>Real-world fee scenarios (what you'll actually get)</li>
        <li>Rate update timestamp</li>
    </ul>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> Get a no-foreign-transaction-fee credit card (Chase Sapphire, Capital One Venture, etc.) BEFORE traveling. You'll get mid-market rate + 0% fee = save hundreds on international trips!</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> You're traveling to Europe and need to convert $1,000 USD to EUR<br><br>
        <strong>Live Exchange Rate:</strong><br>
        • 1 USD = 0.9247 EUR (mid-market rate)<br>
        • This is the "true" rate banks use<br>
        • Updated: Nov 7, 2025 10:30 AM<br><br>
        <strong>Mid-Market Conversion:</strong><br>
        • $1,000 × 0.9247 = <strong>924.70 EUR</strong><br>
        • This is theoretical - you won't get this rate!<br><br>
        <strong>Real-World Conversion Options:</strong><br><br>
        <strong>Option 1: No-Fee Travel Credit Card (BEST) ✅</strong><br>
        • Effective rate: 0.9155 EUR per USD (~1% processing)<br>
        • You receive: <strong>915.50 EUR</strong><br>
        • Cost: $9 in fees<br>
        • Cards: Chase Sapphire, Capital One Venture, Discover<br><br>
        <strong>Option 2: Regular Credit Card</strong><br>
        • 3% foreign transaction fee<br>
        • Effective rate: 0.8970 EUR per USD<br>
        • You receive: <strong>897.00 EUR</strong><br>
        • Cost: $30 in fees<br>
        • Most US credit cards charge this!<br><br>
        <strong>Option 3: Bank Wire Transfer</strong><br>
        • 4% fees + markup<br>
        • Effective rate: 0.8877 EUR per USD<br>
        • You receive: <strong>887.70 EUR</strong><br>
        • Cost: $40 in fees<br><br>
        <strong>Option 4: Airport Currency Exchange (WORST) ❌</strong><br>
        • 10-15% markup<br>
        • Effective rate: 0.8322 EUR per USD<br>
        • You receive: <strong>832.20 EUR</strong><br>
        • Cost: $92 in fees (nearly 10%!)<br>
        • NEVER use airport exchanges!<br><br>
        <strong>Savings Comparison:</strong><br>
        • No-fee card vs airport: Save $83 (9.2%!)<br>
        • No-fee card vs regular card: Save $18<br>
        • No-fee card vs bank wire: Save $28<br><br>
        <strong>On $3,000 trip:</strong> Airport exchange costs you $276! No-fee card saves you $249.<br><br>
        <strong>Key Insight:</strong> The "convenience" of airport exchanges costs you 10% of your money. That's $100 stolen from your vacation budget per $1,000. Get no-fee card instead!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Trip Budget Planning:</strong> Converting $2,500 trip budget to EUR/GBP/JPY so you know how much foreign currency you'll have. Factor in the 1-3% fee loss!</p>
    <p><strong>✓ International Online Shopping:</strong> That UK website shows £89.99. Convert to USD to see if it's cheaper than buying domestically (don't forget shipping + import duties!).</p>
    <p><strong>✓ Foreign Income Calculation:</strong> Freelancing for European client paying €5,000? Convert to USD to know your actual income for taxes and budgeting.</p>
    <p><strong>✓ Crypto/Forex Trading:</strong> Quick currency pair checks. If you're trading EUR/USD or GBP/JPY, see current exchange rates to evaluate trade ideas.</p>
    <p><strong>✓ Expatriate Salary Comparison:</strong> Job offer in London pays £60,000. Convert to USD to compare against your current $80,000 US salary. Factor in cost of living differences too!</p>
    <p><strong>✓ Real Estate Investment:</strong> Property in Mexico listed at 3,500,000 MXN. Convert to USD ($205,000) to compare against US properties and evaluate if it's good deal.</p>
    <p><strong>✓ Before Currency Exchange:</strong> About to exchange $500 at hotel? Check calculator first! If rate is much worse than shown here, find ATM or use credit card instead.</p>
    <p><strong>✓ Credit Card Statement Audit:</strong> Foreign transaction on statement charged $1,032 for 950 EUR purchase. Check if bank used fair rate or added hidden markup beyond stated foreign fee.</p>
    <p><strong>✓ Gift/Payment Planning:</strong> Sending $100 gift to friend in Canada? They'll receive ~$135 CAD. Sending via PayPal? Factor in their ~4% fee too.</p>
</div>
            <button class="modal-close-btn" onclick="closeModal('modal9')">Got it ✓</button>
        </div>
    </div>

    <!-- Modal 10: Inflation Calculator -->
    <div id="modal10" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="modal10-title" aria-describedby="modal10-desc">
        <div class="info-modal-content">
            <h3 id="modal10-title">&#128161; Inflation Calculator</h3>
            
            <div id="modal10-desc" class="modal-section">
    <h4>&#127919; What This Calculator Does</h4>
    <p><strong>Primary Function:</strong> Calculates how much money you'll need in the future to have the same purchasing power as a specific amount today due to inflation.</p>
	<p><strong>Purchasing Power Loss:</strong> Shows what percentage of value your money loses over time - why $100 in 2000 could buy much more than $100 today.</p>
    <p><strong>Visual Timeline Chart:</strong> Interactive line graph showing your money's value eroding year by year - the curve gets steeper over time (exponential decay).</p>
    <p><strong>Rule of 70 Calculator:</strong> Automatically tells you how many years until your money loses HALF its purchasing power at given inflation rate (70 Ã· inflation rate = years to halve).</p>
    <p><strong>Category-Specific Analysis:</strong> Shows how inflation affects different spending categories differently - healthcare inflates faster (5-6%) while technology deflates (gets cheaper over time).</p>
    <p><strong>Historical Context:</strong> Provides US inflation averages and recent year data so you can choose realistic inflation rate for your calculations.</p>
</div>

<div class="modal-section">
    <h4>&#128295; Step-by-Step Instructions</h4>
    <p><strong>Step 1:</strong> Enter <strong>Amount in Today's Dollars</strong> - the current cost of something or how much money you're thinking about</p>
    <p><strong>Step 2:</strong> Enter <strong>Annual Inflation Rate</strong> percentage. Use these guidelines:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li><strong>2-3%:</strong> Federal Reserve target, normal healthy economy</li>
        <li><strong>3-4%:</strong> US historical average (1913-2024: 3.3%)</li>
        <li><strong>4-6%:</strong> High inflation periods (like 2021-2023)</li>
        <li><strong>8%+:</strong> Crisis inflation (rare, like 2022)</li>
        <li><strong>Conservative planning:</strong> Use 3-3.5%</li>
    </ul>
    <p><strong>Step 3:</strong> Enter <strong>Number of Years</strong> - how far into the future you're planning (retirement, kid's college, etc.)</p>
    <p><strong>Step 4:</strong> Review results showing:</p>
    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
        <li>Future value needed</li>
        <li>Cumulative inflation amount</li>
        <li>Purchasing power loss percentage</li>
        <li>Years to lose half value (Rule of 70)</li>
    </ul>
    <p><strong>Step 5:</strong> Click "Category Impact" to see how different expenses inflate at different rates (eye-opening!)</p>
    <p style="margin-top: 15px;"><strong>Pro Tip:</strong> When planning retirement, ALWAYS factor in inflation. That $50k/year you live on today will need to be $121k/year in 30 years at 3% inflation. Most people forget this and run out of money!</p>
    
    <div class="example-box">
        <strong>Real-World Example:</strong><br>
        <strong>Scenario:</strong> You want to know what $1,000 today will be worth in 10 years with 3% annual inflation<br><br>
        <strong>Inflation Calculation:</strong><br>
        • Today's value: $1,000<br>
        • Inflation rate: 3% per year<br>
        • Time period: 10 years<br>
        • Formula: $1,000 × (1.03)^10<br><br>
        <strong>Results:</strong><br>
        • Future value needed: <strong>$1,344</strong><br>
        • Cumulative inflation: $344 (34.4% increase)<br>
        • Purchasing power loss: 25.6%<br><br>
        <strong>What This Means:</strong><br>
        In 10 years, you'll need $1,344 to buy what $1,000 buys today. Your money lost over 1/4 of its value!<br><br>
        <strong>Rule of 70 Application:</strong><br>
        • 70 ÷ 3 = 23.3 years<br>
        • At 3% inflation, money loses HALF its value every 23 years<br>
        • $1,000 today = $500 purchasing power in 2048<br><br>
        <strong>Year-by-Year Breakdown:</strong><br>
        • Year 1: Need $1,030 (3% more)<br>
        • Year 5: Need $1,159 (15.9% more)<br>
        • Year 10: Need $1,344 (34.4% more)<br>
        • Year 20: Need $1,806 (80.6% more)<br>
        • Year 30: Need $2,427 (142.7% more)<br><br>
        <strong>Real-Life Context:</strong><br>
        Remember when gas was $1.50/gallon? Movie tickets $7? That was around 2000. With 3% inflation over 25 years:<br>
        • Gas: $1.50 → $3.14 (actual: $3.50, so 4% inflation!)<br>
        • Movie: $7 → $14.65 (actual: $12-18 depending on location)<br>
        • Groceries: $100 cart → $209 for same items<br><br>
        <strong>Category-Specific Inflation (Click "Category Impact"):</strong><br>
        Starting with $1,000 today, in 10 years you'll need:<br>
        • Healthcare: $1,629 (5% inflation - way above average!)<br>
        • Education: $1,710 (5.5% inflation - college getting worse)<br>
        • Housing: $1,380 (3.3% inflation - slightly above average)<br>
        • Food: $1,344 (3% inflation - matches average)<br>
        • Transportation: $1,290 (2.5% inflation - below average)<br>
        • Technology: $970 (-0.3% deflation - electronics get cheaper!)<br><br>
        <strong>Key Insight:</strong> If you're saving for kid's college in 10 years and it costs $30,000 today, you'll need $51,300 (not $30,000!) due to education-specific inflation. Always use category-specific rates for major expenses!
    </div>
</div>

<div class="modal-section">
    <h4>💼 Common Use Cases</h4>
    <p><strong>✓ Retirement Income Planning:</strong> If you need $50k/year to live comfortably today, you'll need $67k in 10 years, $90k in 20 years, $121k in 30 years (3% inflation). Use this to set retirement savings target!</p>
    <p><strong>✓ Salary Negotiation Strategy:</strong> Got 2% raise but inflation is 3%? That's a 1% REAL pay cut! Show boss this calculator - you need 4-5% raise to get ahead (3% inflation + 2% real increase).</p>
    <p><strong>✓ College Savings Planning:</strong> College costs $30k/year today, kid starts in 15 years. With 5.5% education inflation, you need $65,730/year = $263k for 4 years. Start 529 plan NOW!</p>
    <p><strong>✓ Real Estate Investment Analysis:</strong> House rents for $2,000/month today. In 10 years at 3% inflation, market rent will be $2,688/month. Factor this into cash flow projections!</p>
    <p><strong>✓ Fixed Income Trap:</strong> Retired on fixed $3,000/month pension with no COLA (cost of living adjustment)? In 20 years it only buys $1,660 worth of today's goods. You'll struggle - need inflation protection!</p>
    <p><strong>✓ Investment Return Reality Check:</strong> CD paying 4% sounds good, but if inflation is 3%, your REAL return is only 1%. Stock market at 10% with 3% inflation = 7% real return (much better!).</p>
    <p><strong>✓ Emergency Fund Sizing:</strong> You have $10k emergency fund sitting in savings. In 10 years it has same $10k nominally but only $7,440 purchasing power. Need to invest it in inflation-protected assets!</p>
    <p><strong>✓ Inheritance/Trust Planning:</strong> Grandma left you $100k trust that pays out in 20 years. Sounds great! But with 3% inflation, it's only worth $55,368 in today's dollars. Ask for inflation-adjusted terms!</p>
    <p><strong>✓ Long-Term Contract Negotiation:</strong> Offered 5-year contract at $100k/year (no raises). By year 5, you're effectively earning $86,261 in real terms. Negotiate annual 3%+ increases or shorter contract!</p>
    <p><strong>✓ Social Security Planning:</strong> SS benefits adjust for inflation (COLA), but if you claim early at 62 vs waiting to 70, use calculator to see how inflation erodes that reduced benefit over 30-year retirement.</p>
</div>
            <button class="modal-close-btn" onclick="closeModal('modal10')">Got it ✓</button>
        </div>
    </div>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <p>&copy; 2025 RapidPercent.com - Free Financial Calculators for Loan, Mortgage, Investment & Retirement Planning</p>
			<p style="margin-top: 12px; opacity: 0.9;">Trusted by 100,000+ users monthly • Real-time data • No registration required</p>
			<p style="margin-top: 8px; opacity: 0.8; font-size: 0.9rem;">
				<a href="https://rapidpercent.com" style="color: rgba(255,255,255,0.9); text-decoration: none;">Home</a> • 
				<a href="https://rapidpercent.com/privacy" style="color: rgba(255,255,255,0.9); text-decoration: none;">Privacy Policy</a> • 
				<a href="https://rapidpercent.com/terms" style="color: rgba(255,255,255,0.9); text-decoration: none;">Terms of Service</a>
			</p>
            <p style="margin-top: 8px; opacity: 0.8; font-size: 0.9rem;">Trusted by professionals and individuals worldwide for accurate financial planning</p>
        </div>
    </footer>

    <script>
        // Debug mode flag - set to false for production
        const DEBUG_MODE = false;

        // ============================================
        // GLOBAL VARIABLES & CONFIGURATION
        // ============================================
        
        let currencyRates = {};
        let currencyRatesLastFetched = 0;
        const CURRENCY_CACHE_DURATION = 7200000; // 2 hours in milliseconds
        let currencyCalculationController = null;
        
        // 2025 Federal Tax Brackets
        const TAX_BRACKETS_2025 = {
            single: [
                { max: 11600, rate: 0.10 },
                { max: 47150, rate: 0.12 },
                { max: 100525, rate: 0.22 },
                { max: 191950, rate: 0.24 },
                { max: 243725, rate: 0.32 },
                { max: 609350, rate: 0.35 },
                { max: Infinity, rate: 0.37 }
            ],
            married: [
                { max: 23200, rate: 0.10 },
                { max: 94300, rate: 0.12 },
                { max: 201050, rate: 0.22 },
                { max: 383900, rate: 0.24 },
                { max: 487450, rate: 0.32 },
                { max: 731200, rate: 0.35 },
                { max: Infinity, rate: 0.37 }
            ],
            head: [
                { max: 16550, rate: 0.10 },
                { max: 63100, rate: 0.12 },
                { max: 100500, rate: 0.22 },
                { max: 191950, rate: 0.24 },
                { max: 243700, rate: 0.32 },
                { max: 609350, rate: 0.35 },
                { max: Infinity, rate: 0.37 }
            ]
        };
        
        // Chart.js instances for cleanup
        let chartInstances = {};
        let chartJsLoaded = false;
        let chartJsLoading = false;
        let chartJsLoadPromise = null;

        // Debounce timers
        let debounceTimers = {};

        // ============================================
        // CURRENCY API RATE LIMITING
        // ============================================

        const CURRENCY_API_CONFIG = {
			maxRequestsPerHour: 100,        // ⬅️ Aumentado de 50 a 100
			maxRequestsPerDay: 500,         // ⬅️ Aumentado de 200 a 500
			cacheDuration: 7200000,         // ⬅️ Aumentado de 1 hora a 2 horas (en millisegundos)
			cooldownAfterLimit: 180000      // ⬅️ Reducido de 5 min a 3 min
		};
    
// ✅ MEJORADO: Request tracker con límites de tamaño y auto-limpieza
const currencyRequestTracker = {
    STORAGE_KEY: 'rapidpercent_currency_tracker',
    MAX_STORAGE_SIZE: 50000, // 50KB máximo (localStorage típicamente permite 5-10MB)
    hourlyRequests: [],
    dailyRequests: [],
    lastLimitHit: 0,
    
    // Verifica tamaño del storage antes de guardar
    checkStorageSize() {
        try {
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length + key.length;
                }
            }
            return totalSize;
        } catch(e) {
            return 0;
        }
    },
    
    // Limpia datos antiguos si el storage está lleno
    cleanupIfNeeded() {
        const currentSize = this.checkStorageSize();
        const maxSize = this.MAX_STORAGE_SIZE;
        
        if (currentSize > maxSize * 0.8) { // Si usa >80% del límite
            if (DEBUG_MODE) console.warn(`📦 Storage at ${(currentSize/1024).toFixed(1)}KB, cleaning up...`);
            
            // Limpiar requests más antiguos (dejar solo últimas 24 horas)
            const oneDayAgo = Date.now() - 86400000;
            this.hourlyRequests = this.hourlyRequests.filter(time => time > oneDayAgo);
            this.dailyRequests = this.dailyRequests.filter(time => time > oneDayAgo);
            
            // Si aún es grande, limpiar cache de currency rates antiguo
            try {
                const cached = localStorage.getItem('rapidpercent_currency_cache');
                if (cached) {
                    const cacheData = JSON.parse(cached);
                    const cacheAge = Date.now() - (cacheData.timestamp || 0);
                    
                    // Si cache tiene más de 6 horas, borrarlo
                    if (cacheAge > 21600000) {
                        localStorage.removeItem('rapidpercent_currency_cache');
                        if (DEBUG_MODE) console.log('🗑️ Removed stale currency cache');
                    }
                }
            } catch(e) {
                if (DEBUG_MODE) console.warn('Failed to clean cache:', e);
            }
            
            this.save(); // Guardar versión limpia
        }
    },
    
    init() {
        try {
            const stored = localStorage.getItem(this.STORAGE_KEY);
            if (stored) {
                const data = JSON.parse(stored);
                this.hourlyRequests = data.hourlyRequests || [];
                this.dailyRequests = data.dailyRequests || [];
                this.lastLimitHit = data.lastLimitHit || 0;
                
                // Limpiar requests antiguos al cargar
                const now = Date.now();
                this.hourlyRequests = this.hourlyRequests.filter(time => now - time < 3600000);
                this.dailyRequests = this.dailyRequests.filter(time => now - time < 86400000);
                
                // Verificar si necesita limpieza
                this.cleanupIfNeeded();
                
                if (DEBUG_MODE) console.log('📊 Currency tracker loaded from storage');
            }
        } catch(e) {
            console.warn('Failed to load currency tracker from storage:', e);
            // Si hay error (ej: QuotaExceededError), limpiar todo
            try {
                localStorage.removeItem(this.STORAGE_KEY);
                localStorage.removeItem('rapidpercent_currency_cache');
            } catch(cleanupError) {
                // Ignorar errores de cleanup
            }
        }
    },
    
    save() {
        try {
            // Verificar tamaño antes de guardar
            this.cleanupIfNeeded();
            
            const data = {
                hourlyRequests: this.hourlyRequests.slice(-100), // Solo últimos 100 requests
                dailyRequests: this.dailyRequests.slice(-500),   // Solo últimos 500 requests
                lastLimitHit: this.lastLimitHit,
                version: 1
            };
            
            const jsonString = JSON.stringify(data);
            
            // Verificar que el JSON no sea excesivamente grande
            if (jsonString.length > 10000) { // 10KB máximo para tracker
                if (DEBUG_MODE) console.warn('⚠️ Tracker data too large, trimming...');
                data.hourlyRequests = data.hourlyRequests.slice(-50);
                data.dailyRequests = data.dailyRequests.slice(-200);
            }
            
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
        } catch(e) {
            if (e.name === 'QuotaExceededError') {
                console.warn('💾 LocalStorage quota exceeded, clearing old data...');
                // Intentar limpiar agresivamente
                try {
                    this.hourlyRequests = this.hourlyRequests.slice(-20);
                    this.dailyRequests = this.dailyRequests.slice(-50);
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify({
                        hourlyRequests: this.hourlyRequests,
                        dailyRequests: this.dailyRequests,
                        lastLimitHit: this.lastLimitHit,
                        version: 1
                    }));
                } catch(retryError) {
                    // Si aún falla, borrar todo el tracker
                    this.hourlyRequests = [];
                    this.dailyRequests = [];
                    localStorage.removeItem(this.STORAGE_KEY);
                }
            } else {
                console.warn('Failed to save currency tracker:', e);
            }
        }
    },
    
    canMakeRequest() {
        const now = Date.now();
        
        if (this.lastLimitHit && (now - this.lastLimitHit < CURRENCY_API_CONFIG.cooldownAfterLimit)) {
            if (DEBUG_MODE) console.warn('Currency API in cooldown period');
            return false;
        }
        
        this.hourlyRequests = this.hourlyRequests.filter(time => now - time < 3600000);
        this.dailyRequests = this.dailyRequests.filter(time => now - time < 86400000);
        
        if (this.hourlyRequests.length >= CURRENCY_API_CONFIG.maxRequestsPerHour) {
            if (DEBUG_MODE) console.warn('Hourly API limit reached');
            this.lastLimitHit = now;
            this.save();
            return false;
        }
        
        if (this.dailyRequests.length >= CURRENCY_API_CONFIG.maxRequestsPerDay) {
            if (DEBUG_MODE) console.warn('Daily API limit reached');
            this.lastLimitHit = now;
            this.save();
            return false;
        }
        
        return true;
    },
    
    recordRequest() {
        const now = Date.now();
        this.hourlyRequests.push(now);
        this.dailyRequests.push(now);
        this.save();
        
        if (DEBUG_MODE) {
            const remaining = this.getRemainingRequests();
            console.log(`📊 API request recorded. Remaining: ${remaining.hourly}/hour, ${remaining.daily}/day`);
        }
    },
    
    getRemainingRequests() {
        const now = Date.now();
        this.hourlyRequests = this.hourlyRequests.filter(time => now - time < 3600000);
        this.dailyRequests = this.dailyRequests.filter(time => now - time < 86400000);
        
        return {
            hourly: CURRENCY_API_CONFIG.maxRequestsPerHour - this.hourlyRequests.length,
            daily: CURRENCY_API_CONFIG.maxRequestsPerDay - this.dailyRequests.length
        };
    },
    
    reset() {
        this.hourlyRequests = [];
        this.dailyRequests = [];
        this.lastLimitHit = 0;
        try {
            localStorage.removeItem(this.STORAGE_KEY);
            if (DEBUG_MODE) console.log('🔄 Currency tracker reset');
        } catch(e) {
            console.warn('Failed to reset currency tracker:', e);
        }
    }
};


// ✅ CRÍTICO: Inicializar el tracker al cargar
currencyRequestTracker.init();

// ✅ AGREGADO: Exponer reset para debugging (solo en debug mode)
if (DEBUG_MODE && typeof window !== 'undefined') {
    window.resetCurrencyTracker = () => currencyRequestTracker.reset();
    console.log('💡 Debug mode: Use window.resetCurrencyTracker() to reset API limits');
}

        // ============================================
        // CHART.JS LAZY LOADING
        // ============================================

        function loadChartJs() {
			if (chartJsLoaded && typeof Chart !== 'undefined') {
				return Promise.resolve();
			}
    
			if (chartJsLoading && chartJsLoadPromise) {
				return chartJsLoadPromise;
			}
    
			chartJsLoading = true;
    
			chartJsLoadPromise = new Promise((resolve, reject) => {
			// ← LÍNEAS AGREGADAS
			if (chartJsLoaded && typeof Chart !== 'undefined') {
				chartJsLoading = false;
				resolve();
				return;
			}
    
			if (DEBUG_MODE) console.log('Lazy loading Chart.js...');
    
			const script = document.createElement('script');
			script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js';
			script.integrity = 'sha512-SIMGYRUjwY8+gKg7nn9EItdD8LCADSDfJNutF9TPrvEo86sQmFMh6MyralfIyhADlajSxqc7G0gs7+MwWF/ogQ==';
			script.crossOrigin = 'anonymous';
			script.referrerPolicy = 'no-referrer';
    
			// ✅ NUEVO: Crear timeout que se puede limpiar
			const timeoutId = setTimeout(() => {
				if (!chartJsLoaded) {
					chartJsLoading = false;
					reject(new Error('Chart.js load timeout'));
				}
			}, 10000);
    
			script.onload = () => {
				clearTimeout(timeoutId); // ✅ NUEVO: Limpiar timeout
        
				if (typeof Chart !== 'undefined') {
					chartJsLoaded = true;
					chartJsLoading = false;
					if (DEBUG_MODE) console.log('Chart.js loaded successfully');
					resolve();
				} else {
					chartJsLoading = false;
					reject(new Error('Chart.js loaded but Chart object not found'));
				}
			};
    
			script.onerror = () => {
				clearTimeout(timeoutId); // ✅ NUEVO: Limpiar timeout en error
				chartJsLoading = false;
				console.error('Failed to load Chart.js');
				reject(new Error('Failed to load Chart.js library'));
			};
    
			document.head.appendChild(script);
		});
            
            return chartJsLoadPromise;
        }

        async function createChartWithLazyLoad(createChartFunction) {
            try {
                await loadChartJs();
                createChartFunction();
            } catch (error) {
			console.error('Error loading Chart.js:', error);
			const chartContainers = document.querySelectorAll('.chart-container');
			chartContainers.forEach(container => {
				if (container.style.display !== 'none') {
					// ⬅️ MEJORADO: Mostrar datos en tabla como fallback
					const canvasId = container.querySelector('canvas')?.id;
					let fallbackHTML = `
						<div style="padding: 30px; text-align: center; background: rgba(251, 191, 36, 0.1); border-radius: 12px; border: 2px solid #f59e0b;">
							<p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; color: #92400e;">&#128202; Chart Visualization Unavailable</p>
							<p style="font-size: 0.9rem; color: #78350f; margin-bottom: 15px;">Unable to load charting library. Your data is shown in table format below:</p>
					`;
            
					// ⬅️ NUEVO: Generar tabla con datos según el tipo de gráfico
					if (canvasId === 'mortgage-chart' || canvasId === 'budget-chart') {
						fallbackHTML += `
							<p style="font-size: 0.85rem; color: #78350f; font-style: italic;">Pie chart data - see "Detailed Results" section above for breakdown</p>
						`;
					} else if (canvasId === 'investment-chart' || canvasId === 'retirement-chart' || canvasId === 'credit-chart' || canvasId === 'inflation-chart') {
						fallbackHTML += `
							<p style="font-size: 0.85rem; color: #78350f; font-style: italic;">Timeline chart - click the action buttons below for year-by-year breakdown tables</p>
						`;
					}
            
					fallbackHTML += `
							<button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #f59e0b; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
								&#128260; Retry Loading Charts
							</button>
						</div>
					`;
            
					container.innerHTML = fallbackHTML;
				}
			});
		}
    }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function formatNumber(num, decimals = 2) {
            return parseFloat(num.toFixed(decimals)).toLocaleString('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }
		
		// ✅ NUEVO: Helper para sanitizar strings si alguna vez necesitas mostrar texto del usuario
		function sanitizeHTML(str) {
			const div = document.createElement('div');
			div.textContent = str;
			return div.innerHTML;
		}
        
        function debounce(func, calcId, delay = 300) {
            return function(...args) {
                clearTimeout(debounceTimers[calcId]);
                
                const indicator = document.getElementById(`calc-${calcId}-indicator`);
                if (indicator) {
                    indicator.style.display = 'block';
                }
                
                debounceTimers[calcId] = setTimeout(() => {
                    func.apply(this, args);
                    if (indicator) {
                        indicator.style.display = 'none';
                    }
                }, delay);
            };
        }
        
        function showError(inputId, errorId, message) {
            const input = document.getElementById(inputId);
            const error = document.getElementById(errorId);
            if (input) input.classList.add('error');
            if (error) {
                error.textContent = message;
                error.style.display = 'block';
            }
        }
        
        function clearError(inputId, errorId) {
            const input = document.getElementById(inputId);
            const error = document.getElementById(errorId);
            if (input) input.classList.remove('error');
            if (error) error.style.display = 'none';
        }
        
        function destroyChart(chartId) {
			// ✅ Early exit si no existe
			if (!chartInstances[chartId]) {
				return;
			}

			const chartInstance = chartInstances[chartId];
			const isValidChart = chartInstance && 
								typeof chartInstance === 'object' && 
								typeof chartInstance.destroy === 'function';

			if (isValidChart) {
				try {
					chartInstance.destroy();
					if (DEBUG_MODE) console.log(`Chart ${chartId} destroyed successfully`);
				} catch(e) {
					if (DEBUG_MODE) console.warn(`Failed to destroy chart ${chartId}:`, e.message);
    
					// ✅ MEJORADO: Verificar que canvas EXISTE antes de manipularlo
					const canvas = document.getElementById(chartId);
					if (canvas && canvas.getContext && canvas.parentElement) {
						try {
							const ctx = canvas.getContext('2d');
							if (ctx) {
								ctx.clearRect(0, 0, canvas.width, canvas.height);
								if (DEBUG_MODE) console.log(`Manually cleared canvas ${chartId}`);
							}
						} catch(ctxError) {
							if (DEBUG_MODE) console.warn(`Failed to clear canvas ${chartId}:`, ctxError.message);
						}
        
						// ✅ NUEVO: Solo resize si parentElement existe
						try {
							const parentWidth = canvas.parentElement.offsetWidth || 300;
							canvas.width = 1;
							canvas.height = 1;
							canvas.width = parentWidth;
							canvas.height = 300;
						} catch(resizeError) {
							if (DEBUG_MODE) console.warn(`Failed to resize canvas ${chartId}:`, resizeError.message);
						}
					}
				}
			} else {
				if (DEBUG_MODE) console.warn(`Chart ${chartId} instance invalid (type: ${typeof chartInstance})`);
			}

			// ✅ SIEMPRE cleanup la referencia
			if (chartId in chartInstances) {
				delete chartInstances[chartId];
				if (DEBUG_MODE) console.log(`Removed chartInstances['${chartId}'] reference`);
			}
		}

        // ============================================
        // CALCULATOR 1: LOAN CALCULATOR
        // ============================================
        
        function calculateLoan() {
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const rate = parseFloat(document.getElementById('loan-rate').value);
            const term = parseFloat(document.getElementById('loan-term').value);
            
            if (isNaN(amount) || amount <= 0) {
                document.getElementById('result-loan').textContent = 'Please enter a valid loan amount';
                document.getElementById('result-loan-detailed').style.display = 'none';
                document.getElementById('amortization-loan').style.display = 'none';
                document.getElementById('btn-loan-compare').disabled = true;
                document.getElementById('btn-loan-print').disabled = true;
                return;
            }
            
            if (isNaN(rate) || rate < 0 || rate > 100) {
                document.getElementById('result-loan').textContent = 'Please enter a valid interest rate (0-100%)';
                document.getElementById('result-loan-detailed').style.display = 'none';
                document.getElementById('amortization-loan').style.display = 'none';
                document.getElementById('btn-loan-compare').disabled = true;
                document.getElementById('btn-loan-print').disabled = true;
                return;
            }
            
            if (isNaN(term) || term <= 0 || term > 50) {
                document.getElementById('result-loan').textContent = 'Please enter a valid term (1-50 years)';
                document.getElementById('result-loan-detailed').style.display = 'none';
                document.getElementById('amortization-loan').style.display = 'none';
                document.getElementById('btn-loan-compare').disabled = true;
                document.getElementById('btn-loan-print').disabled = true;
                return;
            }
            
            const monthlyRate = rate / 100 / 12;
            const numPayments = term * 12;
            
            let monthlyPayment;
            if (rate === 0) {
                monthlyPayment = amount / numPayments;
            } else {
                monthlyPayment = amount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                 (Math.pow(1 + monthlyRate, numPayments) - 1);
            }
            
            const totalPaid = monthlyPayment * numPayments;
            const totalInterest = totalPaid - amount;
            
            document.getElementById('result-loan').textContent = `Monthly Payment: ${formatCurrency(monthlyPayment)}`;
            
            const detailedResult = `
                <h4>Loan Summary</h4>
                <div class="result-row">
                    <span>Loan Amount:</span>
                    <span>${formatCurrency(amount)}</span>
                </div>
                <div class="result-row">
                    <span>Monthly Payment:</span>
                    <span>${formatCurrency(monthlyPayment)}</span>
                </div>
                <div class="result-row">
                    <span>Number of Payments:</span>
                    <span>${numPayments} months</span>
                </div>
                <div class="result-row">
                    <span>Total Interest:</span>
                    <span>${formatCurrency(totalInterest)}</span>
                </div>
                <div class="result-row">
                    <span>Total Amount Paid:</span>
                    <span>${formatCurrency(totalPaid)}</span>
                </div>
            `;
            
            document.getElementById('result-loan-detailed').innerHTML = detailedResult;
            document.getElementById('result-loan-detailed').style.display = 'block';
            
            generateAmortizationSchedule('loan', amount, monthlyRate, numPayments, monthlyPayment);
            
            document.getElementById('btn-loan-compare').disabled = false;
            document.getElementById('btn-loan-print').disabled = false;
        }
        
        function generateAmortizationSchedule(prefix, principal, monthlyRate, numPayments, monthlyPayment) {
            let balance = principal;
            let scheduleHTML = `
                <h4 style="color: #0d9488; margin-bottom: 15px;">Complete Amortization Schedule</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Payment #</th>
                            <th>Payment</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // ✅ NUEVO: Usar DocumentFragment para mejor rendimiento
			const fragment = document.createDocumentFragment();
			const tempDiv = document.createElement('div');

			for (let i = 1; i <= numPayments; i++) {
				const interestPayment = balance * monthlyRate;
				const principalPayment = monthlyPayment - interestPayment;
				balance -= principalPayment;
    
				if (balance < 0) balance = 0;
    
				scheduleHTML += `
					<tr>
						<td>${i}</td>
						<td>${formatCurrency(monthlyPayment)}</td>
						<td>${formatCurrency(principalPayment)}</td>
						<td>${formatCurrency(interestPayment)}</td>
						<td>${formatCurrency(balance)}</td>
					</tr>
				`;
    
				// ✅ NUEVO: Insertar en batches de 50 para mejorar rendimiento
				if (i % 50 === 0 || i === numPayments) {
					tempDiv.innerHTML = scheduleHTML;
					while (tempDiv.firstChild) {
						fragment.appendChild(tempDiv.firstChild);
					}
					scheduleHTML = '';
				}
			}
            
            scheduleHTML += '</tbody></table>';

			const scheduleContainer = document.getElementById(`amortization-${prefix}`);

			// ✅ MEJORADO: Usar fragment si se creó, sino innerHTML tradicional
			if (fragment.hasChildNodes()) {
				scheduleContainer.innerHTML = '<h4 style="color: #0d9488; margin-bottom: 15px;">Complete Amortization Schedule</h4><table><thead><tr><th>Payment #</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Balance</th></tr></thead><tbody></tbody></table>';
				const tbody = scheduleContainer.querySelector('tbody');
				tbody.appendChild(fragment);
			} else {
				scheduleContainer.innerHTML = scheduleHTML;
			}

			scheduleContainer.style.display = 'block';
        }
        
        function showLoanComparison() {
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const rate = parseFloat(document.getElementById('loan-rate').value);
            const term = parseFloat(document.getElementById('loan-term').value);
            
            if (isNaN(amount) || isNaN(rate) || isNaN(term)) return;
            
            const comparisons = [];
            const terms = [term - 2, term, term + 2].filter(t => t > 0 && t <= 50);
            
            terms.forEach(t => {
                const monthlyRate = rate / 100 / 12;
                const numPayments = t * 12;
                const monthlyPayment = amount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                     (Math.pow(1 + monthlyRate, numPayments) - 1);
                const totalPaid = monthlyPayment * numPayments;
                const totalInterest = totalPaid - amount;
                
                comparisons.push({
                    term: t,
                    monthlyPayment,
                    totalInterest,
                    totalPaid
                });
            });
            
            let comparisonHTML = '<div class="comparison-container">';
            
            comparisons.forEach((comp, index) => {
                const isSelected = comp.term === term;
                comparisonHTML += `
                    <div class="comparison-card" style="${isSelected ? 'border: 3px solid #2dd4bf; background: rgba(45, 212, 191, 0.1);' : ''}">
                        <h5>${comp.term}-Year Term ${isSelected ? '(Current)' : ''}</h5>
                        <div class="result-row">
                            <span>Monthly Payment:</span>
                            <span>${formatCurrency(comp.monthlyPayment)}</span>
                        </div>
                        <div class="result-row">
                            <span>Total Interest:</span>
                            <span>${formatCurrency(comp.totalInterest)}</span>
                        </div>
                        <div class="result-row">
                            <span>Total Paid:</span>
                            <span>${formatCurrency(comp.totalPaid)}</span>
                        </div>
                    </div>
                `;
            });
            
            comparisonHTML += '</div>';
            
            const existingComparison = document.getElementById('loan-comparison');
            if (existingComparison) {
                existingComparison.remove();
            }
            
            const detailedResult = document.getElementById('result-loan-detailed');
            detailedResult.insertAdjacentHTML('afterend', `<div id="loan-comparison" class="result-detailed" style="margin-top: 20px;">${comparisonHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 2: MORTGAGE CALCULATOR
        // ============================================
        
        function calculateMortgage() {
            const price = parseFloat(document.getElementById('mortgage-price').value);
            const down = parseFloat(document.getElementById('mortgage-down').value) || 0;
            const rate = parseFloat(document.getElementById('mortgage-rate').value);
            const term = parseFloat(document.getElementById('mortgage-term').value);
            
            if (isNaN(price) || price <= 0) {
                document.getElementById('result-mortgage').textContent = 'Please enter a valid home price';
                document.getElementById('result-mortgage-detailed').style.display = 'none';
                document.getElementById('chart-mortgage').style.display = 'none';
                document.getElementById('btn-mortgage-compare').disabled = true;
                document.getElementById('btn-mortgage-print').disabled = true;
                return;
            }
            
            if (down >= price) {
                document.getElementById('result-mortgage').textContent = 'Down payment must be less than home price';
                document.getElementById('result-mortgage-detailed').style.display = 'none';
                document.getElementById('chart-mortgage').style.display = 'none';
                document.getElementById('btn-mortgage-compare').disabled = true;
                document.getElementById('btn-mortgage-print').disabled = true;
                return;
            }
            
            if (isNaN(rate) || rate < 0 || rate > 100) {
                document.getElementById('result-mortgage').textContent = 'Please enter a valid interest rate';
                document.getElementById('result-mortgage-detailed').style.display = 'none';
                document.getElementById('chart-mortgage').style.display = 'none';
                document.getElementById('btn-mortgage-compare').disabled = true;
                document.getElementById('btn-mortgage-print').disabled = true;
                return;
            }
            
            if (isNaN(term) || term <= 0 || term > 50) {
                document.getElementById('result-mortgage').textContent = 'Please enter a valid term';
                document.getElementById('result-mortgage-detailed').style.display = 'none';
                document.getElementById('chart-mortgage').style.display = 'none';
                document.getElementById('btn-mortgage-compare').disabled = true;
                document.getElementById('btn-mortgage-print').disabled = true;
                return;
            }
            
            const loanAmount = price - down;
            const monthlyRate = rate / 100 / 12;
            const numPayments = term * 12;
            
            let monthlyPayment;
            if (rate === 0) {
                monthlyPayment = loanAmount / numPayments;
            } else {
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                 (Math.pow(1 + monthlyRate, numPayments) - 1);
            }
            
            const totalPaid = monthlyPayment * numPayments;
            const totalInterest = totalPaid - loanAmount;
            const downPercent = (down / price * 100).toFixed(1);
            
            let pmiMonthly = 0;
            let pmiWarning = '';
            if (down < price * 0.2) {
                pmiMonthly = (loanAmount * 0.005) / 12;
                pmiWarning = `
                    <div style="margin-top: 15px; padding: 15px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.9rem; color: #92400e;">
                        <strong>⚠️ PMI Required:</strong> Down payment is ${downPercent}% (less than 20%). Add ~${formatCurrency(pmiMonthly)}/month for Private Mortgage Insurance until you reach 20% equity. Total monthly: ${formatCurrency(monthlyPayment + pmiMonthly)}
                    </div>
                `;
            }
            
            document.getElementById('result-mortgage').textContent = `Monthly Payment: ${formatCurrency(monthlyPayment)}`;
            
            const detailedResult = `
                <h4>Mortgage Summary</h4>
                <div class="result-row">
                    <span>Home Price:</span>
                    <span>${formatCurrency(price)}</span>
                </div>
                <div class="result-row">
                    <span>Down Payment (${downPercent}%):</span>
                    <span>${formatCurrency(down)}</span>
                </div>
                <div class="result-row">
                    <span>Loan Amount:</span>
                    <span>${formatCurrency(loanAmount)}</span>
                </div>
                <div class="result-row">
                    <span>Monthly Payment (P&I):</span>
                    <span>${formatCurrency(monthlyPayment)}</span>
                </div>
                <div class="result-row">
                    <span>Total Interest:</span>
                    <span>${formatCurrency(totalInterest)}</span>
                </div>
                <div class="result-row">
                    <span>Total Paid (Loan + Interest):</span>
                    <span>${formatCurrency(totalPaid)}</span>
                </div>
                ${pmiWarning}
            `;
            
            document.getElementById('result-mortgage-detailed').innerHTML = detailedResult;
            document.getElementById('result-mortgage-detailed').style.display = 'block';
            
            createMortgageChart(loanAmount, totalInterest);
            
            document.getElementById('btn-mortgage-compare').disabled = false;
            document.getElementById('btn-mortgage-print').disabled = false;
        }
        
        function createMortgageChart(principal, interest) {
            createChartWithLazyLoad(() => {
                destroyChart('mortgage-chart');
                
                const ctx = document.getElementById('mortgage-chart');
                if (!ctx) return;
                
                document.getElementById('chart-mortgage').style.display = 'block';
                
                chartInstances['mortgage-chart'] = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Principal', 'Interest'],
                        datasets: [{
                            data: [principal, interest],
                            backgroundColor: [
                                'rgba(45, 212, 191, 0.8)',
                                'rgba(251, 146, 60, 0.8)'
                            ],
                            borderColor: [
                                'rgba(45, 212, 191, 1)',
                                'rgba(251, 146, 60, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Total Payment Breakdown',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = formatCurrency(context.parsed);
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }
        
        function showMortgageComparison() {
            const price = parseFloat(document.getElementById('mortgage-price').value);
            const down = parseFloat(document.getElementById('mortgage-down').value) || 0;
            const rate = parseFloat(document.getElementById('mortgage-rate').value);
            
            if (isNaN(price) || isNaN(rate)) return;
            
            const loanAmount = price - down;
            const monthlyRate = rate / 100 / 12;
            
            const comparisons = [
                { term: 15, label: '15-Year Fixed' },
                { term: 30, label: '30-Year Fixed' }
            ];
            
            let comparisonHTML = '<div class="comparison-container">';
            
            comparisons.forEach(comp => {
                const numPayments = comp.term * 12;
                const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                     (Math.pow(1 + monthlyRate, numPayments) - 1);
                const totalPaid = monthlyPayment * numPayments;
                const totalInterest = totalPaid - loanAmount;
                
                comparisonHTML += `
                    <div class="comparison-card">
                        <h5>${comp.label}</h5>
                        <div class="result-row">
                            <span>Monthly Payment:</span>
                            <span>${formatCurrency(monthlyPayment)}</span>
                        </div>
                        <div class="result-row">
                            <span>Total Interest:</span>
                            <span>${formatCurrency(totalInterest)}</span>
                        </div>
                        <div class="result-row">
                            <span>Total Paid:</span>
                            <span>${formatCurrency(totalPaid)}</span>
                        </div>
                    </div>
                `;
            });
            
            const term30 = comparisons[1].term * 12;
            const payment30 = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, term30)) / (Math.pow(1 + monthlyRate, term30) - 1);
            const total30 = payment30 * term30;
            
            const term15 = comparisons[0].term * 12;
            const payment15 = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, term15)) / (Math.pow(1 + monthlyRate, term15) - 1);
            const total15 = payment15 * term15;
            
            const savings = total30 - total15;
            
            comparisonHTML += `</div>
                <div style="margin-top: 15px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px; text-align: center;">
                    <strong style="color: #059669; font-size: 1.1rem;">💰 Interest Savings with 15-Year: ${formatCurrency(savings)}</strong>
                    <p style="margin-top: 8px; color: #0d9488; font-size: 0.9rem;">Pay off 15 years faster and save significantly on interest!</p>
                </div>
            `;
            
            const existingComparison = document.getElementById('mortgage-comparison');
            if (existingComparison) {
                existingComparison.remove();
            }
            
            const chartContainer = document.getElementById('chart-mortgage');
            chartContainer.insertAdjacentHTML('afterend', `<div id="mortgage-comparison" class="result-detailed" style="margin-top: 20px;">${comparisonHTML}</div>`);
        }
		
		// ============================================
        // CALCULATOR 3: INVESTMENT ROI CALCULATOR
        // ============================================
        
        function calculateInvestment() {
            const initial = parseFloat(document.getElementById('invest-initial').value);
            const returnRate = parseFloat(document.getElementById('invest-return').value);
            const years = parseFloat(document.getElementById('invest-years').value);
            const contribution = parseFloat(document.getElementById('invest-contribution').value) || 0;
            
            if (isNaN(initial) || initial < 0) {
                document.getElementById('result-investment').textContent = 'Please enter a valid initial investment';
                document.getElementById('result-investment-detailed').style.display = 'none';
                document.getElementById('chart-investment').style.display = 'none';
                document.getElementById('btn-investment-project').disabled = true;
                document.getElementById('btn-investment-print').disabled = true;
                return;
            }
            
            if (isNaN(returnRate)) {
                document.getElementById('result-investment').textContent = 'Please enter a valid return rate';
                document.getElementById('result-investment-detailed').style.display = 'none';
                document.getElementById('chart-investment').style.display = 'none';
                document.getElementById('btn-investment-project').disabled = true;
                document.getElementById('btn-investment-print').disabled = true;
                return;
            }
            
            if (isNaN(years) || years <= 0 || years > 100) {
				document.getElementById('result-inflation').textContent = 'Please enter a valid period';
				document.getElementById('result-inflation-detailed').style.display = 'none';
				document.getElementById('chart-inflation').style.display = 'none';
				document.getElementById('btn-inflation-breakdown').disabled = true;
				document.getElementById('btn-inflation-print').disabled = true;
				return;
			}

			// ✅ NUEVO: Validación del salary opcional
			const optionalSalaryInput = document.getElementById('retire-salary-optional');
			const optionalSalary = optionalSalaryInput ? parseFloat(optionalSalaryInput.value) : null;

			if (optionalSalary !== null && !isNaN(optionalSalary)) {
				if (optionalSalary <= 0) {
					document.getElementById('result-retirement').textContent = '⚠️ Optional salary must be greater than $0';
					document.getElementById('result-retirement-detailed').style.display = 'none';
					document.getElementById('chart-retirement').style.display = 'none';
					document.getElementById('btn-retirement-analysis').disabled = true;
					document.getElementById('btn-retirement-print').disabled = true;
        
					if (optionalSalaryInput) {
						optionalSalaryInput.classList.add('error');
					}
					return;
				}
    
				if (optionalSalary > 10000000) { // $10M máximo razonable
					document.getElementById('result-retirement').textContent = '⚠️ Optional salary seems unrealistic (max $10M)';
					document.getElementById('result-retirement-detailed').style.display = 'none';
					document.getElementById('chart-retirement').style.display = 'none';
					document.getElementById('btn-retirement-analysis').disabled = true;
					document.getElementById('btn-retirement-print').disabled = true;
        
					if (optionalSalaryInput) {
						optionalSalaryInput.classList.add('error');
					}
					return;
				}
			}

			// Limpiar error si pasa validación
			if (optionalSalaryInput) {
				optionalSalaryInput.classList.remove('error');
			}
            
            const monthlyRate = returnRate / 100 / 12;
            const months = years * 12;
            
            let futureValue = initial * Math.pow(1 + monthlyRate, months);
            
            if (contribution > 0 && monthlyRate !== 0) {
                futureValue += contribution * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
            } else if (contribution > 0 && monthlyRate === 0) {
                futureValue += contribution * months;
            }
            
            const totalContributions = initial + (contribution * months);
            const totalGain = futureValue - totalContributions;
            const roi = (totalGain / totalContributions * 100);
            
            document.getElementById('result-investment').textContent = `Final Value: ${formatCurrency(futureValue)}`;
            
            const detailedResult = `
                <h4>Investment Projection</h4>
                <div class="result-row">
                    <span>Initial Investment:</span>
                    <span>${formatCurrency(initial)}</span>
                </div>
                <div class="result-row">
                    <span>Monthly Contributions:</span>
                    <span>${formatCurrency(contribution * months)}</span>
                </div>
                <div class="result-row">
                    <span>Total Invested:</span>
                    <span>${formatCurrency(totalContributions)}</span>
                </div>
                <div class="result-row">
                    <span>Investment Growth:</span>
                    <span style="color: #059669;">${formatCurrency(totalGain)}</span>
                </div>
                <div class="result-row">
                    <span>ROI:</span>
                    <span style="color: #059669;">${formatNumber(roi, 1)}%</span>
                </div>
                <div class="result-row">
                    <span>Final Portfolio Value:</span>
                    <span>${formatCurrency(futureValue)}</span>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; text-align: center; font-size: 0.9rem; color: #0d9488;">
                    Compound interest generated <strong>${formatCurrency(totalGain)}</strong> in growth!
                </div>
            `;
            
            document.getElementById('result-investment-detailed').innerHTML = detailedResult;
            document.getElementById('result-investment-detailed').style.display = 'block';
            
            createInvestmentChart(initial, contribution, monthlyRate, months);
            
            document.getElementById('btn-investment-project').disabled = false;
            document.getElementById('btn-investment-print').disabled = false;
        }
        
        function createInvestmentChart(initial, monthlyContribution, monthlyRate, totalMonths) {
            createChartWithLazyLoad(() => {
                destroyChart('investment-chart');
                
                const ctx = document.getElementById('investment-chart');
                if (!ctx) return;
                
                document.getElementById('chart-investment').style.display = 'block';
                
                const labels = [];
                const contributions = [];
                const values = [];
                
                let balance = initial;
                let totalContrib = initial;
                
                for (let month = 0; month <= totalMonths; month += 12) {
                    const year = month / 12;
                    labels.push(`Year ${year}`);
                    contributions.push(totalContrib);
                    values.push(balance);
                    
                    if (month < totalMonths) {
                        for (let i = 0; i < 12 && month + i < totalMonths; i++) {
                            balance = balance * (1 + monthlyRate) + monthlyContribution;
                            totalContrib += monthlyContribution;
                        }
                    }
                }
                
                chartInstances['investment-chart'] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Total Contributions',
                                data: contributions,
                                borderColor: 'rgba(251, 146, 60, 1)',
                                backgroundColor: 'rgba(251, 146, 60, 0.1)',
                                fill: true,
                                tension: 0.1
                            },
                            {
                                label: 'Portfolio Value',
                                data: values,
                                borderColor: 'rgba(45, 212, 191, 1)',
                                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                                fill: true,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Investment Growth Over Time',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + (value >= 1000 ? (value/1000).toFixed(0) + 'k' : value);
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }
        
        function showInvestmentProjection() {
            const initial = parseFloat(document.getElementById('invest-initial').value);
            const returnRate = parseFloat(document.getElementById('invest-return').value);
            const years = parseFloat(document.getElementById('invest-years').value);
            const contribution = parseFloat(document.getElementById('invest-contribution').value) || 0;
            
            if (isNaN(initial) || isNaN(returnRate) || isNaN(years)) return;
            
            const monthlyRate = returnRate / 100 / 12;
            
            let projectionHTML = `
                <h4 style="color: #0d9488; margin-bottom: 15px;">Year-by-Year Projection</h4>
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="background: var(--secondary); color: white;">
                            <th style="padding: 10px; text-align: left;">Year</th>
                            <th style="padding: 10px; text-align: right;">Contributions</th>
                            <th style="padding: 10px; text-align: right;">Growth</th>
                            <th style="padding: 10px; text-align: right;">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let balance = initial;
            let totalContrib = initial;
            
            projectionHTML += `
                <tr style="border-bottom: 1px solid rgba(45, 212, 191, 0.1);">
                    <td style="padding: 8px;">0</td>
                    <td style="padding: 8px; text-align: right;">${formatCurrency(initial)}</td>
                    <td style="padding: 8px; text-align: right;">$0.00</td>
                    <td style="padding: 8px; text-align: right;">${formatCurrency(initial)}</td>
                </tr>
            `;
            
            for (let year = 1; year <= years; year++) {
                const startBalance = balance;
                const startContrib = totalContrib;
                
                for (let month = 0; month < 12; month++) {
                    balance = balance * (1 + monthlyRate) + contribution;
                    totalContrib += contribution;
                }
                
                const yearGrowth = balance - startBalance - (contribution * 12);
                
                projectionHTML += `
                    <tr style="border-bottom: 1px solid rgba(45, 212, 191, 0.1);">
                        <td style="padding: 8px;">${year}</td>
                        <td style="padding: 8px; text-align: right;">${formatCurrency(totalContrib)}</td>
                        <td style="padding: 8px; text-align: right; color: #059669;">${formatCurrency(yearGrowth)}</td>
                        <td style="padding: 8px; text-align: right; font-weight: 600;">${formatCurrency(balance)}</td>
                    </tr>
                `;
            }
            
            projectionHTML += '</tbody></table>';
            
            const existingProjection = document.getElementById('investment-projection');
            if (existingProjection) {
                existingProjection.remove();
            }
            
            const chartContainer = document.getElementById('chart-investment');
            chartContainer.insertAdjacentHTML('afterend', `<div id="investment-projection" class="result-detailed" style="margin-top: 20px; max-height: 400px; overflow-y: auto;">${projectionHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 4: SALARY CALCULATOR (PROGRESSIVE TAX)
        // ============================================
        
        function calculateProgressiveTax(income, brackets) {
            let tax = 0;
            let previousMax = 0;
            
            for (const bracket of brackets) {
                if (income > previousMax) {
                    const taxableInBracket = Math.min(income, bracket.max) - previousMax;
                    tax += taxableInBracket * bracket.rate;
                    previousMax = bracket.max;
                } else {
                    break;
                }
            }
            
            return tax;
        }
        
    function calculateSalary() {
    const gross = parseFloat(document.getElementById('salary-gross').value);
    const filing = document.getElementById('salary-filing').value;
    const stateRate = parseFloat(document.getElementById('salary-state').value) || 0;
    const deductions = parseFloat(document.getElementById('salary-deductions').value) || 0;
    
    if (isNaN(gross) || gross <= 0) {
		document.getElementById('result-salary').textContent = 'Please enter a valid salary';
		document.getElementById('result-salary-detailed').style.display = 'none';
		document.getElementById('salary-disclaimer').style.display = 'none';
		document.getElementById('btn-salary-print').disabled = true;
		document.getElementById('result-salary').style.background = 'linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%)';
		return;
	}
    
    if (stateRate < 0 || stateRate > 15) {
        document.getElementById('result-salary').textContent = 'Please enter a valid state tax rate (0-15%)';
        document.getElementById('result-salary-detailed').style.display = 'none';
        document.getElementById('salary-disclaimer').style.display = 'none';
        document.getElementById('btn-salary-print').disabled = true;
        return;
    }
    
    // ✅ MOVIDO AL INICIO: Validación de filing status
    const validFilingStatuses = ['single', 'married', 'head'];
    if (!validFilingStatuses.includes(filing)) {
        console.error(`Invalid filing status: ${filing}`);
        document.getElementById('result-salary').textContent = '⚠️ Invalid filing status selected';
        document.getElementById('result-salary-detailed').innerHTML = `
            <div style="padding: 20px; background: rgba(220, 38, 38, 0.15); border-left: 4px solid #dc2626; border-radius: 8px;">
                <h4 style="color: #991b1b; margin-bottom: 10px;">Configuration Error</h4>
                <p style="color: #7f1d1d; line-height: 1.6;">
                    The selected filing status "<strong>${filing}</strong>" is not recognized by the tax calculator.
                </p>
                <p style="color: #7f1d1d; margin-top: 10px;">
                    Valid options are:
                </p>
                <ul style="margin: 10px 0 0 20px; color: #7f1d1d; line-height: 1.6;">
                    <li><strong>single</strong> - Single filer</li>
                    <li><strong>married</strong> - Married Filing Jointly</li>
                    <li><strong>head</strong> - Head of Household</li>
                </ul>
                <p style="color: #7f1d1d; margin-top: 10px; font-weight: 600;">
                    Please refresh the page and try again. If the problem persists, contact support.
                </p>
            </div>
        `;
        document.getElementById('result-salary-detailed').style.display = 'block';
		document.getElementById('salary-disclaimer').style.display = 'none';
		document.getElementById('btn-salary-print').disabled = true;
		document.getElementById('result-salary').style.background = 'linear-gradient(135deg, #fca5a5 0%, #f87171 25%, #ef4444 50%, #dc2626 75%, #b91c1c 100%)';
		return;
    }
    
    // VALIDATION: Check if deductions exceed gross income
    if (deductions >= gross) {
        document.getElementById('result-salary').textContent = '⚠️ Deductions exceed gross salary';
        document.getElementById('result-salary-detailed').innerHTML = `
            <div style="padding: 20px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px;">
                <h4 style="color: #92400e; margin-bottom: 10px;">Invalid Input</h4>
                <p style="color: #78350f; line-height: 1.6;">
                    <strong>Pre-tax deductions (${formatCurrency(deductions)})</strong> cannot exceed 
                    <strong>gross salary (${formatCurrency(gross)})</strong>.
                </p>
                <p style="color: #78350f; margin-top: 10px;">
                    💡 Common deductions include:
                </p>
                <ul style="margin: 10px 0 0 20px; color: #78350f; line-height: 1.8;">
                    <li>401(k) contributions (max $23,000 in 2025, or $30,500 if 50+)</li>
                    <li>Health Savings Account (max $4,150 individual, $8,300 family)</li>
                    <li>Flexible Spending Account (max $3,200)</li>
                    <li>Health insurance premiums</li>
                </ul>
                <p style="color: #78350f; margin-top: 10px; font-weight: 600;">
                    Please review and correct your deduction amount.
                </p>
            </div>
        `;
        document.getElementById('result-salary-detailed').style.display = 'block';
        document.getElementById('salary-disclaimer').style.display = 'none';

        const deductionsInput = document.getElementById('salary-deductions');
        if (deductionsInput) {
            deductionsInput.classList.add('error');
        }

        const errorMessage = document.getElementById('error-salary-deductions');
        if (errorMessage) {
            errorMessage.textContent = `Cannot exceed gross salary (${formatCurrency(gross)})`;
            errorMessage.style.display = 'block';
        }

        document.getElementById('btn-salary-print').disabled = true;
        return;
    }

    // Clear errors if validation passes
    const deductionsInput = document.getElementById('salary-deductions');
    if (deductionsInput) {
        deductionsInput.classList.remove('error');
    }

    const errorMessage = document.getElementById('error-salary-deductions');
    if (errorMessage) {
        errorMessage.style.display = 'none';
    }
    
    const taxableIncome = Math.max(0, gross - deductions);
    
    // Ahora sí es seguro usar el filing status
    if (!TAX_BRACKETS_2025[filing]) {
		console.error(`CRITICAL: Filing status "${filing}" not found in TAX_BRACKETS_2025`);
		document.getElementById('result-salary').textContent = '⚠️ System error - invalid tax bracket configuration';
		document.getElementById('result-salary-detailed').innerHTML = `
			<div style="padding: 20px; background: rgba(220, 38, 38, 0.15); border-left: 4px solid #dc2626; border-radius: 8px;">
				<h4 style="color: #991b1b; margin-bottom: 10px;">System Configuration Error</h4>
				<p style="color: #7f1d1d; line-height: 1.6;">
					The tax calculation system encountered an unexpected error. Please refresh the page and try again.
					If the problem persists, please contact support.
				</p>
			</div>
		`;
		document.getElementById('result-salary-detailed').style.display = 'block';
		document.getElementById('salary-disclaimer').style.display = 'none';
		document.getElementById('btn-salary-print').disabled = true;
		return;
	}

	// Ahora sí es seguro usar el filing status
	const federalTax = calculateProgressiveTax(taxableIncome, TAX_BRACKETS_2025[filing]);
    
    const socialSecurity = Math.min(gross, 168600) * 0.062;
    const medicare = gross * 0.0145;
    const ficaTax = socialSecurity + medicare;
    
    const stateTax = taxableIncome * (stateRate / 100);
    
    const netAnnual = gross - federalTax - ficaTax - stateTax - deductions;
    const netMonthly = netAnnual / 12;
    const netWeekly = netAnnual / 52;
    const netDaily = netAnnual / 260;
    const netHourly = netAnnual / 2080;
    
    const effectiveTaxRate = ((federalTax + ficaTax + stateTax) / gross * 100).toFixed(1);
    
    document.getElementById('result-salary').textContent = `Take-Home: ${formatCurrency(netAnnual)}/year`;
    
    const detailedResult = `
        <h4>Salary Breakdown (${filing})</h4>
        <div class="result-row">
            <span>Gross Annual Salary:</span>
            <span>${formatCurrency(gross)}</span>
        </div>
        <div class="result-row">
            <span>Pre-tax Deductions:</span>
            <span>${formatCurrency(deductions)}</span>
        </div>
        <div class="result-row">
            <span>Taxable Income:</span>
            <span>${formatCurrency(taxableIncome)}</span>
        </div>
        <div class="result-row">
            <span>Federal Tax (Progressive):</span>
            <span style="color: #dc2626;">-${formatCurrency(federalTax)}</span>
        </div>
        <div class="result-row">
            <span>FICA (SS + Medicare):</span>
            <span style="color: #dc2626;">-${formatCurrency(ficaTax)}</span>
        </div>
        <div class="result-row">
            <span>State Tax (${stateRate}%):</span>
            <span style="color: #dc2626;">-${formatCurrency(stateTax)}</span>
        </div>
        <div class="result-row">
            <span>Effective Tax Rate:</span>
            <span>${effectiveTaxRate}%</span>
        </div>
        <div class="result-row" style="border-top: 2px solid rgba(45, 212, 191, 0.3); margin-top: 10px; padding-top: 12px;">
            <span><strong>Net Annual:</strong></span>
            <span style="color: #059669; font-size: 1.1rem;"><strong>${formatCurrency(netAnnual)}</strong></span>
        </div>
        <div class="result-row">
            <span>Net Monthly:</span>
            <span>${formatCurrency(netMonthly)}</span>
        </div>
        <div class="result-row">
            <span>Net Weekly:</span>
            <span>${formatCurrency(netWeekly)}</span>
        </div>
        <div class="result-row">
            <span>Net Daily:</span>
            <span>${formatCurrency(netDaily)}</span>
        </div>
        <div class="result-row">
            <span>Net Hourly:</span>
            <span>${formatCurrency(netHourly)}</span>
        </div>
    `;
    
    document.getElementById('result-salary-detailed').innerHTML = detailedResult;
    document.getElementById('result-salary-detailed').style.display = 'block';
    document.getElementById('salary-disclaimer').style.display = 'block';
    
    document.getElementById('btn-salary-print').disabled = false;
}    
    
// Ahora sí es seguro usar el filing status
const federalTax = calculateProgressiveTax(taxableIncome, TAX_BRACKETS_2025[filing]);

const socialSecurity = Math.min(gross, 168600) * 0.062;
const medicare = gross * 0.0145;
const ficaTax = socialSecurity + medicare;
            
            const stateTax = taxableIncome * (stateRate / 100);
            
            const netAnnual = gross - federalTax - ficaTax - stateTax - deductions;
            const netMonthly = netAnnual / 12;
            const netWeekly = netAnnual / 52;
            const netDaily = netAnnual / 260;
            const netHourly = netAnnual / 2080;
            
            const effectiveTaxRate = ((federalTax + ficaTax + stateTax) / gross * 100).toFixed(1);
            
            document.getElementById('result-salary').textContent = `Take-Home: ${formatCurrency(netAnnual)}/year`;
            
            const detailedResult = `
                <h4>Salary Breakdown (${filing})</h4>
                <div class="result-row">
                    <span>Gross Annual Salary:</span>
                    <span>${formatCurrency(gross)}</span>
                </div>
                <div class="result-row">
                    <span>Pre-tax Deductions:</span>
                    <span>${formatCurrency(deductions)}</span>
                </div>
                <div class="result-row">
                    <span>Taxable Income:</span>
                    <span>${formatCurrency(taxableIncome)}</span>
                </div>
                <div class="result-row">
                    <span>Federal Tax (Progressive):</span>
                    <span style="color: #dc2626;">-${formatCurrency(federalTax)}</span>
                </div>
                <div class="result-row">
                    <span>FICA (SS + Medicare):</span>
                    <span style="color: #dc2626;">-${formatCurrency(ficaTax)}</span>
                </div>
                <div class="result-row">
                    <span>State Tax (${stateRate}%):</span>
                    <span style="color: #dc2626;">-${formatCurrency(stateTax)}</span>
                </div>
                <div class="result-row">
                    <span>Effective Tax Rate:</span>
                    <span>${effectiveTaxRate}%</span>
                </div>
                <div class="result-row" style="border-top: 2px solid rgba(45, 212, 191, 0.3); margin-top: 10px; padding-top: 12px;">
                    <span><strong>Net Annual:</strong></span>
                    <span style="color: #059669; font-size: 1.1rem;"><strong>${formatCurrency(netAnnual)}</strong></span>
                </div>
                <div class="result-row">
                    <span>Net Monthly:</span>
                    <span>${formatCurrency(netMonthly)}</span>
                </div>
                <div class="result-row">
                    <span>Net Weekly:</span>
                    <span>${formatCurrency(netWeekly)}</span>
                </div>
                <div class="result-row">
                    <span>Net Daily:</span>
                    <span>${formatCurrency(netDaily)}</span>
                </div>
                <div class="result-row">
                    <span>Net Hourly:</span>
                    <span>${formatCurrency(netHourly)}</span>
                </div>
            `;
            
            document.getElementById('result-salary-detailed').innerHTML = detailedResult;
            document.getElementById('result-salary-detailed').style.display = 'block';
            document.getElementById('salary-disclaimer').style.display = 'block';
            
            document.getElementById('btn-salary-print').disabled = false;
        }

        // ============================================
        // CALCULATOR 5: RETIREMENT SAVINGS CALCULATOR
        // ============================================
        
        function calculateRetirement() {
            const age = parseInt(document.getElementById('retire-age').value);
            const targetAge = parseInt(document.getElementById('retire-target-age').value);
            const current = parseFloat(document.getElementById('retire-current').value);
            const monthly = parseFloat(document.getElementById('retire-monthly').value);
            const returnRate = parseFloat(document.getElementById('retire-return').value);
            const inflation = parseFloat(document.getElementById('retire-inflation').value);
            
            if (isNaN(age) || age < 18 || age > 100) {
                document.getElementById('result-retirement').textContent = 'Please enter a valid current age';
                document.getElementById('result-retirement-detailed').style.display = 'none';
                document.getElementById('chart-retirement').style.display = 'none';
                document.getElementById('btn-retirement-analysis').disabled = true;
                document.getElementById('btn-retirement-print').disabled = true;
                return;
            }
            
            if (isNaN(targetAge) || targetAge < 18 || targetAge > 100) {
                document.getElementById('result-retirement').textContent = 'Please enter a valid retirement age';
                document.getElementById('result-retirement-detailed').style.display = 'none';
                document.getElementById('chart-retirement').style.display = 'none';
                document.getElementById('btn-retirement-analysis').disabled = true;
                document.getElementById('btn-retirement-print').disabled = true;
                return;
            }
            
            if (targetAge <= age) {
				document.getElementById('result-retirement').textContent = 'Retirement age must be greater than current age';
				document.getElementById('result-retirement-detailed').style.display = 'none';
				document.getElementById('chart-retirement').style.display = 'none';
				document.getElementById('btn-retirement-analysis').disabled = true;
				document.getElementById('btn-retirement-print').disabled = true;
				return;
			}

			// ✅ MEJORADO: Validación con mensaje más claro
			if (targetAge - age > 70) {
				document.getElementById('result-retirement').textContent = '⚠️ Retirement period exceeds 70 years';
				document.getElementById('result-retirement-detailed').innerHTML = `
					<div style="padding: 20px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px;">
						<h4 style="color: #92400e; margin-bottom: 10px;">Period Too Long</h4>
						<p style="color: #78350f; line-height: 1.6;">
							The calculator is limited to a maximum 70-year retirement period to prevent numerical overflow errors.
						</p>
						<p style="color: #78350f; margin-top: 10px;">
							<strong>Your inputs:</strong><br>
							• Current age: ${age}<br>
							• Retirement age: ${targetAge}<br>
							• Period: ${targetAge - age} years (max: 70)
						</p>
						<p style="color: #78350f; margin-top: 10px; font-weight: 600;">
							💡 Consider adjusting your retirement age to be within 70 years of your current age.
						</p>
					</div>
				`;
				document.getElementById('result-retirement-detailed').style.display = 'block';
				document.getElementById('chart-retirement').style.display = 'none';
				document.getElementById('btn-retirement-analysis').disabled = true;
				document.getElementById('btn-retirement-print').disabled = false; // ✅ Permitir imprimir el error
				return;
			}
            
            if (isNaN(current) || current < 0 || isNaN(monthly) || monthly < 0 || isNaN(returnRate) || returnRate < 0 || isNaN(inflation) || inflation < 0) {
                document.getElementById('result-retirement').textContent = 'Please enter valid retirement details';
                document.getElementById('result-retirement-detailed').style.display = 'none';
                document.getElementById('chart-retirement').style.display = 'none';
                document.getElementById('btn-retirement-analysis').disabled = true;
                document.getElementById('btn-retirement-print').disabled = true;
                return;
            }
            
            const years = targetAge - age;
            const months = years * 12;
            const monthlyRate = returnRate / 100 / 12;
            
            let futureValue = current * Math.pow(1 + monthlyRate, months);
            
            if (monthly > 0 && monthlyRate !== 0) {
                futureValue += monthly * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
            } else if (monthly > 0 && monthlyRate === 0) {
                futureValue += monthly * months;
            }
            
            // OVERFLOW PROTECTION: Check if result is valid
			if (!isFinite(futureValue) || futureValue > 1e15 || isNaN(futureValue)) {
				document.getElementById('result-retirement').textContent = '⚠️ Value exceeds calculation limits';
				document.getElementById('result-retirement-detailed').innerHTML = `
					<div style="padding: 20px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px;">
						<h4 style="color: #92400e; margin-bottom: 10px;">⚠️ Calculation Overflow</h4>
						<p style="color: #78350f; line-height: 1.6;">
							The projected value exceeds $1 quadrillion (1,000 trillion), which is beyond practical calculation limits.
						</p>
						<p style="color: #78350f; margin-top: 10px;">
							<strong>Your inputs:</strong><br>
							• Years to retirement: ${years}<br>
							• Expected return: ${returnRate}%<br>
							• Monthly contribution: ${formatCurrency(monthly)}<br>
							• Current savings: ${formatCurrency(current)}
						</p>
						<p style="color: #78350f; margin-top: 10px;">
							This typically happens with:
						</p>
						<ul style="margin: 10px 0 10px 20px; color: #78350f;">
							<li>Very long time periods (50+ years)</li>
							<li>High return rates (>15% annually)</li>
							<li>Large monthly contributions (>$10,000)</li>
						</ul>
						<p style="color: #78350f; margin-top: 10px; font-weight: 600;">
							💡 Try reducing the time period to under 50 years, or lowering the expected return rate to 7-10%.
						</p>
					</div>
				`;
				document.getElementById('result-retirement-detailed').style.display = 'block';
				document.getElementById('chart-retirement').style.display = 'none';
				document.getElementById('btn-retirement-analysis').disabled = true;
				document.getElementById('btn-retirement-print').disabled = false; // ✅ Permitir imprimir el error
				return;
			}
                        <p style="color: #78350f; margin-top: 10px; font-weight: 600;">
                            💡 Try reducing the time period, return rate, or monthly contribution to get accurate results.
                        </p>
                    </div>
                `;
                document.getElementById('result-retirement-detailed').style.display = 'block';
                document.getElementById('chart-retirement').style.display = 'none';
                document.getElementById('btn-retirement-analysis').disabled = true;
                document.getElementById('btn-retirement-print').disabled = true;
                return;
            }
            
            const totalContributions = monthly * months;
            const totalInvested = current + totalContributions;
            const totalGain = futureValue - totalInvested;
            
            const realValue = futureValue / Math.pow(1 + inflation / 100, years);
            
            // Additional validation for derived values
            if (!isFinite(realValue) || realValue > 1e15) {
                document.getElementById('result-retirement').textContent = 'Value too large after inflation adjustment';
                document.getElementById('result-retirement-detailed').style.display = 'none';
                document.getElementById('chart-retirement').style.display = 'none';
                document.getElementById('btn-retirement-analysis').disabled = true;
                document.getElementById('btn-retirement-print').disabled = true;
                return;
            }
            
            const safeAnnualWithdrawal = futureValue * 0.04;
            const safeMonthlyIncome = safeAnnualWithdrawal / 12;
						
            document.getElementById('result-retirement').textContent = `Retirement Fund: ${formatCurrency(futureValue)}`;
            
            const detailedResult = `
                <h4>Retirement Projection</h4>
                <div class="result-row">
                    <span>Years to Retirement:</span>
                    <span>${years} years</span>
                </div>
                <div class="result-row">
                    <span>Current Savings:</span>
                    <span>${formatCurrency(current)}</span>
                </div>
                <div class="result-row">
                    <span>Total Contributions:</span>
                    <span>${formatCurrency(totalContributions)}</span>
                </div>
                <div class="result-row">
                    <span>Total Invested:</span>
                    <span>${formatCurrency(totalInvested)}</span>
                </div>
                <div class="result-row">
                    <span>Investment Growth:</span>
                    <span style="color: #059669;">${formatCurrency(totalGain)}</span>
                </div>
                <div class="result-row" style="border-top: 2px solid rgba(45, 212, 191, 0.3); margin-top: 10px; padding-top: 12px;">
                    <span><strong>Nominal Value (Future $):</strong></span>
                    <span style="font-size: 1.1rem;"><strong>${formatCurrency(futureValue)}</strong></span>
                </div>
                <div class="result-row">
                    <span>Real Value (Today's $):</span>
                    <span style="color: #0d9488;">${formatCurrency(realValue)}</span>
                </div>
                <div style="margin: 15px 0; padding: 15px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <div class="result-row" style="border: none; padding: 5px 0;">
                        <span style="font-weight: 700; color: #0d9488;">Safe Annual Income (4% Rule):</span>
                        <span style="font-weight: 700; color: #059669; font-size: 1.15rem;">${formatCurrency(safeAnnualWithdrawal)}</span>
                    </div>
                    <div class="result-row" style="border: none; padding: 5px 0;">
                        <span style="font-weight: 700; color: #0d9488;">Monthly Retirement Income:</span>
                        <span style="font-weight: 700; color: #059669; font-size: 1.15rem;">${formatCurrency(safeMonthlyIncome)}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.85rem; color: #0d9488;">
                        💡 The 4% rule allows you to withdraw 4% annually for 30+ years safely, adjusted for inflation.
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.85rem; color: #92400e;">
                    <strong>📊 Inflation Impact:</strong> Due to ${inflation}% inflation, your ${formatCurrency(futureValue)} will have the purchasing power of ${formatCurrency(realValue)} in today's dollars.
                </div>
            `;
            
            document.getElementById('result-retirement-detailed').innerHTML = detailedResult;
            document.getElementById('result-retirement-detailed').style.display = 'block';
            
            createRetirementChart(current, monthly, monthlyRate, months, inflation / 100 / 12);
            
            document.getElementById('btn-retirement-analysis').disabled = false;
            document.getElementById('btn-retirement-print').disabled = false;
        }
        
        function createRetirementChart(initial, monthlyContribution, monthlyRate, totalMonths, monthlyInflation) {
            createChartWithLazyLoad(() => {
                destroyChart('retirement-chart');
                
                const ctx = document.getElementById('retirement-chart');
                if (!ctx) return;
                
                document.getElementById('chart-retirement').style.display = 'block';
                
                const labels = [];
                const nominalValues = [];
                const realValues = [];
                
                let balance = initial;
                
                for (let month = 0; month <= totalMonths; month += 12) {
                    const year = month / 12;
                    labels.push(`Year ${year}`);
                    
                    const realValue = balance / Math.pow(1 + monthlyInflation * 12, year);
                    nominalValues.push(balance);
                    realValues.push(realValue);
                    
                    if (month < totalMonths) {
                        for (let i = 0; i < 12 && month + i < totalMonths; i++) {
                            balance = balance * (1 + monthlyRate) + monthlyContribution;
                        }
                    }
                }
                
                chartInstances['retirement-chart'] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Nominal Value (Future $)',
                                data: nominalValues,
                                borderColor: 'rgba(45, 212, 191, 1)',
                                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                                fill: true,
                                tension: 0.1
                            },
                            {
                                label: 'Real Value (Today\'s $)',
                                data: realValues,
                                borderColor: 'rgba(251, 146, 60, 1)',
                                backgroundColor: 'rgba(251, 146, 60, 0.1)',
                                fill: true,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Retirement Savings Growth (Nominal vs Real)',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + (value >= 1000000 ? (value/1000000).toFixed(1) + 'M' : 
                                               value >= 1000 ? (value/1000).toFixed(0) + 'k' : value);
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }
        
        function showRetirementAnalysis() {
            const age = parseInt(document.getElementById('retire-age').value);
            const targetAge = parseInt(document.getElementById('retire-target-age').value);
            const current = parseFloat(document.getElementById('retire-current').value);
            const monthly = parseFloat(document.getElementById('retire-monthly').value);
            const returnRate = parseFloat(document.getElementById('retire-return').value);
            
            if (isNaN(age) || isNaN(targetAge) || isNaN(current) || isNaN(monthly) || isNaN(returnRate)) return;
            
            const years = targetAge - age;
            const months = years * 12;
            const monthlyRate = returnRate / 100 / 12;
            
            let futureValue = current * Math.pow(1 + monthlyRate, months);
            if (monthly > 0 && monthlyRate !== 0) {
                futureValue += monthly * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
            } else if (monthly > 0) {
                futureValue += monthly * months;
            }
            
            let estimatedSalary;
			let savingsRateUsed;
			let salaryNote = '';

			const yearsToRetirement = targetAge - age;
			const inflationMultiplier = Math.pow(1.03, Math.min(yearsToRetirement, 10));

			// Check if user provided optional salary input
			const optionalSalaryInput = document.getElementById('retire-salary-optional');
			const userProvidedSalary = optionalSalaryInput ? parseFloat(optionalSalaryInput.value) : null;

			if (userProvidedSalary && !isNaN(userProvidedSalary) && userProvidedSalary > 0) {
				// Use user-provided salary (most accurate)
				estimatedSalary = Math.round(userProvidedSalary * inflationMultiplier);
				savingsRateUsed = monthly > 0 ? ((monthly * 12 / userProvidedSalary) * 100).toFixed(1) + '%' : 'N/A';
				salaryNote = `<div style="margin-bottom: 20px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px; font-size: 0.9rem; color: #065f46;">
					<strong>✅ Using Your Salary:</strong> Benchmarks calculated based on your provided salary of ${formatCurrency(userProvidedSalary)} (adjusted to ${formatCurrency(estimatedSalary)} for ${yearsToRetirement} years of 3% inflation).
					${monthly > 0 ? `<br><br><strong>Your Current Savings Rate:</strong> ${savingsRateUsed} of gross income` : ''}
				</div>`;
			} else if (monthly <= 0) {
				// No monthly contribution - use median US salary
				estimatedSalary = Math.round(60000 * inflationMultiplier);
				savingsRateUsed = 'N/A';
				salaryNote = `<div style="margin-bottom: 20px; padding: 15px; background: rgba(251, 191, 36, 0.1); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.9rem; color: #92400e;">
					<strong>💡 Benchmark Reference:</strong> Since you haven't entered a monthly contribution or salary, we're using the median US salary (${formatCurrency(estimatedSalary)}) adjusted for expected inflation over ${yearsToRetirement} years. 
					<br><br>
					<strong>For personalized targets:</strong> Enter your current salary in the optional field above for accurate benchmarks, or enter your monthly savings to estimate based on your savings rate.
					<br><br>
					<strong>Tip:</strong> Financial advisors typically recommend saving 15% of gross income for retirement.
				</div>`;
			} else {
				// Estimate salary from monthly contribution (less accurate but better than nothing)
				if (monthly < 100) {
					estimatedSalary = (monthly * 12 / 0.05) * inflationMultiplier;
					savingsRateUsed = '5%';
				} else if (monthly >= 100 && monthly < 500) {
					estimatedSalary = (monthly * 12 / 0.10) * inflationMultiplier;
					savingsRateUsed = '10%';
				} else if (monthly >= 500 && monthly < 1500) {
					estimatedSalary = (monthly * 12 / 0.15) * inflationMultiplier;
					savingsRateUsed = '15%';
				} else {
					estimatedSalary = (monthly * 12 / 0.20) * inflationMultiplier;
					savingsRateUsed = '20%';
				}
    
				const minSalary = Math.round(25000 * inflationMultiplier);
				const maxSalary = Math.round(500000 * inflationMultiplier);
    
				estimatedSalary = Math.max(estimatedSalary, minSalary);
				estimatedSalary = Math.min(estimatedSalary, maxSalary);
				estimatedSalary = Math.round(estimatedSalary / 1000) * 1000;
    
				salaryNote = `<div style="margin-bottom: 20px; padding: 15px; background: rgba(251, 191, 36, 0.1); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.9rem; color: #92400e;">
					<strong>📊 Estimated Salary:</strong> Based on your ${formatCurrency(monthly)}/month contribution, we estimate your salary at ${formatCurrency(estimatedSalary)} (assuming ${savingsRateUsed} savings rate, adjusted for ${yearsToRetirement} years inflation).
					<br><br>
					<strong>⚠️ This is an estimate.</strong> For more accurate benchmarks, enter your actual annual salary in the optional field above.
				</div>`;
			}
			
            const benchmarks = [
                { age: 30, multiple: 1, target: estimatedSalary * 1 },
                { age: 40, multiple: 3, target: estimatedSalary * 3 },
                { age: 50, multiple: 6, target: estimatedSalary * 6 },
                { age: 60, multiple: 8, target: estimatedSalary * 8 },
                { age: 67, multiple: 10, target: estimatedSalary * 10 }
            ];
            
            let analysisHTML = `
                <h4 style="color: #0d9488; margin-bottom: 15px;">Age-Based Savings Benchmarks</h4>
                <p style="margin-bottom: 15px; font-size: 0.9rem; color: #475569;">
                    Based on estimated annual salary of <strong>${formatCurrency(estimatedSalary)}</strong>
                    ${monthly > 0 ? ` (calculated from ${formatCurrency(monthly)}/month contribution assuming ${savingsRateUsed} savings rate)` : ' (using median US salary as reference)'}.
                </p>
                
                ${salaryNote}
                
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="background: var(--secondary); color: white;">
                            <th style="padding: 10px; text-align: left;">Age</th>
                            <th style="padding: 10px; text-align: center;">Target Multiple</th>
                            <th style="padding: 10px; text-align: right;">Target Amount</th>
                            <th style="padding: 10px; text-align: center;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            benchmarks.forEach(benchmark => {
                if (benchmark.age < age) {
                    return;
                }
                
                const yearsToAge = benchmark.age - age;
                const monthsToAge = yearsToAge * 12;
                
                let projectedSavings = current * Math.pow(1 + monthlyRate, monthsToAge);
                if (monthly > 0 && monthlyRate !== 0) {
                    projectedSavings += monthly * ((Math.pow(1 + monthlyRate, monthsToAge) - 1) / monthlyRate);
                } else if (monthly > 0) {
                    projectedSavings += monthly * monthsToAge;
                }
                
                const status = projectedSavings >= benchmark.target ? '✅ On Track' : '⚠️ Behind';
                const statusColor = projectedSavings >= benchmark.target ? '#059669' : '#f59e0b';
                
                analysisHTML += `
                    <tr style="border-bottom: 1px solid rgba(45, 212, 191, 0.1);">
                        <td style="padding: 10px;">${benchmark.age}</td>
                        <td style="padding: 10px; text-align: center;">${benchmark.multiple}× salary</td>
                        <td style="padding: 10px; text-align: right;">${formatCurrency(benchmark.target)}</td>
                        <td style="padding: 10px; text-align: center; color: ${statusColor}; font-weight: 600;">${status}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(45, 212, 191, 0.1); background: rgba(45, 212, 191, 0.05);">
                        <td colspan="4" style="padding: 8px 10px; font-size: 0.8rem; color: #475569;">
                            Your projected savings at age ${benchmark.age}: ${formatCurrency(projectedSavings)}
                        </td>
                    </tr>
                `;
            });
            
            analysisHTML += `
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px;">
                    <h5 style="color: #0d9488; margin-bottom: 10px;">💡 Recommendations:</h5>
                    <ul style="margin-left: 20px; color: #475569; font-size: 0.9rem; line-height: 1.8;">
            `;
            
            const firstBenchmark = benchmarks.find(b => b.age >= age);
            if (firstBenchmark) {
                const yearsToFirst = firstBenchmark.age - age;
                const monthsToFirst = yearsToFirst * 12;
                let projectedAtFirst = current * Math.pow(1 + monthlyRate, monthsToFirst);
                if (monthly > 0 && monthlyRate !== 0) {
                    projectedAtFirst += monthly * ((Math.pow(1 + monthlyRate, monthsToFirst) - 1) / monthlyRate);
                } else if (monthly > 0) {
                    projectedAtFirst += monthly * monthsToFirst;
                }
                
                if (projectedAtFirst < firstBenchmark.target) {
                    const shortfall = firstBenchmark.target - projectedAtFirst;
                    analysisHTML += `<li><strong>Increase savings:</strong> You're projected to be ${formatCurrency(shortfall)} short of the ${firstBenchmark.age} benchmark. Consider increasing monthly contributions.</li>`;
                } else {
                    analysisHTML += `<li><strong>Excellent progress!</strong> You're on track to meet the age ${firstBenchmark.age} benchmark of ${formatCurrency(firstBenchmark.target)}.</li>`;
                }
            }
            
            if (monthly <= 0) {
                analysisHTML += '<li><strong>Start contributing:</strong> Even $100/month can make a significant difference over time due to compound growth.</li>';
            } else if (monthly < 500) {
                analysisHTML += '<li><strong>Maximize employer match:</strong> If your employer offers 401k matching, contribute enough to get the full match - it\'s free money!</li>';
            }
            
            analysisHTML += `
                        <li><strong>Note:</strong> These are general guidelines. Your actual needs depend on desired retirement lifestyle, Social Security benefits, pension (if any), healthcare costs, and life expectancy.</li>
                    </ul>
                </div>
            `;
            
            const existingAnalysis = document.getElementById('retirement-analysis');
            if (existingAnalysis) {
                existingAnalysis.remove();
            }
            
            const chartContainer = document.getElementById('chart-retirement');
            chartContainer.insertAdjacentHTML('afterend', `<div id="retirement-analysis" class="result-detailed" style="margin-top: 20px;">${analysisHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 6: CAR LOAN CALCULATOR
        // ============================================
        
        function calculateCarLoan() {
            const price = parseFloat(document.getElementById('car-price').value);
            const down = parseFloat(document.getElementById('car-down').value) || 0;
            const rate = parseFloat(document.getElementById('car-rate').value);
            const term = parseFloat(document.getElementById('car-term').value);
            
            if (isNaN(price) || price <= 0) {
                document.getElementById('result-carloan').textContent = 'Please enter a valid car price';
                document.getElementById('result-carloan-detailed').style.display = 'none';
                document.getElementById('btn-carloan-compare').disabled = true;
                document.getElementById('btn-carloan-print').disabled = true;
                return;
            }
            
            if (down >= price) {
                document.getElementById('result-carloan').textContent = 'Down payment must be less than car price';
                document.getElementById('result-carloan-detailed').style.display = 'none';
                document.getElementById('btn-carloan-compare').disabled = true;
                document.getElementById('btn-carloan-print').disabled = true;
                return;
            }
            
            if (isNaN(rate) || rate < 0 || rate > 100) {
                document.getElementById('result-carloan').textContent = 'Please enter a valid interest rate';
                document.getElementById('result-carloan-detailed').style.display = 'none';
                document.getElementById('btn-carloan-compare').disabled = true;
                document.getElementById('btn-carloan-print').disabled = true;
                return;
            }
            
            if (isNaN(term) || term <= 0 || term > 10) {
                document.getElementById('result-carloan').textContent = 'Please enter a valid term (1-10 years)';
                document.getElementById('result-carloan-detailed').style.display = 'none';
                document.getElementById('btn-carloan-compare').disabled = true;
                document.getElementById('btn-carloan-print').disabled = true;
                return;
            }
            
            const loanAmount = price - down;
            const monthlyRate = rate / 100 / 12;
            const numPayments = term * 12;
            
            let monthlyPayment;
            if (rate === 0) {
                monthlyPayment = loanAmount / numPayments;
            } else {
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                 (Math.pow(1 + monthlyRate, numPayments) - 1);
            }
            
            const totalPaid = monthlyPayment * numPayments;
            const totalInterest = totalPaid - loanAmount;
            const downPercent = (down / price * 100).toFixed(1);
            
            const twentyPercentDown = price * 0.2;
            const meetsDownRule = down >= twentyPercentDown;
            const meetsTermRule = term <= 4;
            
            const estimatedInsurance = 150;
            const estimatedGas = 200;
            const estimatedMaintenance = 100;
            const totalMonthlyCost = monthlyPayment + estimatedInsurance + estimatedGas + estimatedMaintenance;
            
            const incomeNeeded = (totalMonthlyCost * 12) / 0.10;
            
            let ruleWarning = '';
            if (!meetsDownRule || !meetsTermRule) {
                ruleWarning = `
                    <div style="margin-top: 15px; padding: 15px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.9rem; color: #92400e;">
                        <strong>⚠️ 20/4/10 Rule Check:</strong><br>
                        ${!meetsDownRule ? `• Down payment: ${downPercent}% (recommend 20%+)<br>` : ''}
                        ${!meetsTermRule ? `• Loan term: ${term} years (recommend 4 years max)<br>` : ''}
                        Following this rule helps prevent overpaying on depreciation and interest.
                    </div>
                `;
            }
            
            document.getElementById('result-carloan').textContent = `Monthly Payment: ${formatCurrency(monthlyPayment)}`;
            
            const detailedResult = `
                <h4>Car Loan Summary</h4>
                <div class="result-row">
                    <span>Car Price:</span>
                    <span>${formatCurrency(price)}</span>
                </div>
                <div class="result-row">
                    <span>Down Payment (${downPercent}%):</span>
                    <span>${formatCurrency(down)}</span>
                </div>
                <div class="result-row">
                    <span>Loan Amount:</span>
                    <span>${formatCurrency(loanAmount)}</span>
                </div>
                <div class="result-row">
                    <span>Monthly Payment:</span>
                    <span>${formatCurrency(monthlyPayment)}</span>
                </div>
                <div class="result-row">
                    <span>Total Interest:</span>
                    <span>${formatCurrency(totalInterest)}</span>
                </div>
                <div class="result-row">
                    <span>Total Cost of Car:</span>
                    <span>${formatCurrency(price + totalInterest)}</span>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <h5 style="color: #0d9488; font-size: 1rem; margin-bottom: 10px;">Total Ownership Cost Estimate</h5>
                    <div class="result-row" style="border: none; padding: 3px 0;">
                        <span>Loan Payment:</span>
                        <span>${formatCurrency(monthlyPayment)}</span>
                    </div>
                    <div class="result-row" style="border: none; padding: 3px 0;">
                        <span>Insurance (est.):</span>
                        <span>${formatCurrency(estimatedInsurance)}</span>
                    </div>
                    <div class="result-row" style="border: none; padding: 3px 0;">
                        <span>Gas (est.):</span>
                        <span>${formatCurrency(estimatedGas)}</span>
                    </div>
                    <div class="result-row" style="border: none; padding: 3px 0;">
                        <span>Maintenance (est.):</span>
                        <span>${formatCurrency(estimatedMaintenance)}</span>
                    </div>
                    <div class="result-row" style="border-top: 2px solid rgba(45, 212, 191, 0.3); margin-top: 8px; padding-top: 8px; font-weight: 700;">
                        <span>Total Monthly Cost:</span>
                        <span style="font-size: 1.1rem;">${formatCurrency(totalMonthlyCost)}</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85rem; color: #0d9488;">
                        <strong>10% Rule:</strong> Need ${formatCurrency(incomeNeeded)}/year income to safely afford (${formatCurrency(incomeNeeded/12)}/month).
                    </div>
                </div>
                ${ruleWarning}
            `;
            
            document.getElementById('result-carloan-detailed').innerHTML = detailedResult;
            document.getElementById('result-carloan-detailed').style.display = 'block';
            
            document.getElementById('btn-carloan-compare').disabled = false;
            document.getElementById('btn-carloan-print').disabled = false;
        }
        
        function showCarLoanComparison() {
            const price = parseFloat(document.getElementById('car-price').value);
            const down = parseFloat(document.getElementById('car-down').value) || 0;
            const rate = parseFloat(document.getElementById('car-rate').value);
            
            if (isNaN(price) || isNaN(rate)) return;
            
            const loanAmount = price - down;
            const monthlyRate = rate / 100 / 12;
            
            const terms = [3, 4, 5, 6];
            let comparisonHTML = '<div class="comparison-container" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">';
            
            terms.forEach(term => {
                const numPayments = term * 12;
                const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                     (Math.pow(1 + monthlyRate, numPayments) - 1);
                const totalPaid = monthlyPayment * numPayments;
                const totalInterest = totalPaid - loanAmount;
                
                const isRecommended = term <= 4;
                
                comparisonHTML += `
                    <div class="comparison-card" style="${isRecommended ? 'border: 2px solid #10b981; background: rgba(45, 212, 191, 0.05);' : ''}">
                        <h5>${term}-Year Term ${isRecommended ? '✓' : ''}</h5>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem;">
                            <span>Monthly:</span>
                            <span>${formatCurrency(monthlyPayment)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem;">
                            <span>Interest:</span>
                            <span>${formatCurrency(totalInterest)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem; font-weight: 600;">
                            <span>Total:</span>
                            <span>${formatCurrency(totalPaid)}</span>
                        </div>
                    </div>
                `;
            });
            
            comparisonHTML += '</div>';
            
            const shortTerm = 3 * 12;
            const shortPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, shortTerm)) / (Math.pow(1 + monthlyRate, shortTerm) - 1);
            const shortTotal = shortPayment * shortTerm;
            
            const longTerm = 6 * 12;
            const longPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, longTerm)) / (Math.pow(1 + monthlyRate, longTerm) - 1);
            const longTotal = longPayment * longTerm;
            
            const savings = longTotal - shortTotal;
            
            comparisonHTML += `
                <div style="margin-top: 15px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px; text-align: center;">
                    <strong style="color: #059669; font-size: 1.05rem;">💰 Savings: 3-year vs 6-year term = ${formatCurrency(savings)}</strong>
                    <p style="margin-top: 8px; color: #0d9488; font-size: 0.85rem;">Shorter terms save thousands in interest and protect against depreciation!</p>
                </div>
            `;
            
            const existingComparison = document.getElementById('carloan-comparison');
            if (existingComparison) {
                existingComparison.remove();
            }
            
            const detailedResult = document.getElementById('result-carloan-detailed');
            detailedResult.insertAdjacentHTML('afterend', `<div id="carloan-comparison" class="result-detailed" style="margin-top: 20px;">${comparisonHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 7: CREDIT CARD PAYOFF CALCULATOR
        // ============================================
        
        function getCreditCardErrorHTML(payment, monthlyInterest, minPaymentRequired, recommendedPayment) {
            const absoluteMinimum = Math.max(monthlyInterest * 1.1, minPaymentRequired);
            const shortfall = monthlyInterest - payment;
            
            return `
                <h4 style="color: #dc2626;">🚫 CALCULATION BLOCKED</h4>
                <div style="padding: 20px; background: rgba(220, 38, 38, 0.1); border: 3px solid #dc2626; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1rem; font-weight: 700; color: #991b1b; margin-bottom: 15px;">
                        ⛔ Cannot calculate payoff schedule
                    </p>
                    <div class="result-row">
                        <span>Your Payment:</span>
                        <span style="color: #dc2626; font-weight: 700;">${formatCurrency(payment)}</span>
                    </div>
                    <div class="result-row">
                        <span>Monthly Interest Charge:</span>
                        <span style="color: #dc2626; font-weight: 700;">${formatCurrency(monthlyInterest)}</span>
                    </div>
                    <div class="result-row" style="border-top: 2px solid #dc2626; margin-top: 10px; padding-top: 10px;">
                        <span><strong>Gap (Shortfall):</strong></span>
                        <span style="color: #7f1d1d; font-weight: 700; font-size: 1.1rem;">${formatCurrency(shortfall)}</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 20px; background: rgba(220, 38, 38, 0.15); border-left: 5px solid #dc2626; border-radius: 8px;">
                    <h5 style="color: #991b1b; font-size: 1.1rem; margin-bottom: 12px;">🚨 DEBT SPIRAL ALERT</h5>
                    <p style="font-size: 0.95rem; color: #7f1d1d; font-weight: 600; line-height: 1.7;">
                        Your payment doesn't cover the monthly interest charge. This means:
                    </p>
                    <ul style="margin: 15px 0; padding-left: 25px; color: #991b1b; font-weight: 500;">
                        <li style="margin-bottom: 8px;">Your debt <strong>INCREASES</strong> by ${formatCurrency(shortfall)} every month</li>
                        <li style="margin-bottom: 8px;">You will <strong>NEVER</strong> pay off this debt with current payment</li>
                        <li style="margin-bottom: 8px;">Interest compounds on growing balance = accelerating debt</li>
                    </ul>
                    
                    <div style="margin-top: 15px; padding: 15px; background: rgba(5, 150, 105, 0.1); border: 2px solid #059669; border-radius: 8px;">
                        <h5 style="color: #047857; margin-bottom: 10px;">✅ Required Actions:</h5>
                        <div class="result-row" style="border: none; padding: 5px 0;">
                            <span>Minimum Payment Needed:</span>
                            <span style="color: #059669; font-weight: 700;">${formatCurrency(minPaymentRequired)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0;">
                            <span>Recommended (to make progress):</span>
                            <span style="color: #059669; font-weight: 700;">${formatCurrency(recommendedPayment)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0;">
                            <span>Absolute Minimum (covers interest + 10%):</span>
                            <span style="color: #059669; font-weight: 700;">${formatCurrency(absoluteMinimum)}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: rgba(251, 191, 36, 0.1); border-left: 3px solid #f59e0b; border-radius: 6px; font-size: 0.9rem; color: #92400e;">
                        <strong>💡 Emergency Options:</strong><br>
                        • Balance transfer to 0% APR card (12-18 months)<br>
                        • Debt consolidation loan at lower rate<br>
                        • Contact card issuer for hardship program<br>
                        • Seek non-profit credit counseling (NFCC.org)
                    </div>
                </div>
            `;
        }
        
        function calculateCreditCard() {
            const balance = parseFloat(document.getElementById('credit-balance').value);
            const apr = parseFloat(document.getElementById('credit-apr').value);
            const payment = parseFloat(document.getElementById('credit-payment').value);
            
            if (isNaN(balance) || balance <= 0) {
                document.getElementById('result-credit').textContent = 'Please enter a valid balance';
                document.getElementById('result-credit-detailed').style.display = 'none';
                document.getElementById('chart-credit').style.display = 'none';
                document.getElementById('btn-credit-strategies').disabled = true;
                document.getElementById('btn-credit-print').disabled = true;
                return;
            }
            
            if (isNaN(apr) || apr < 0 || apr > 100) {
                document.getElementById('result-credit').textContent = 'Please enter a valid APR';
                document.getElementById('result-credit-detailed').style.display = 'none';
                document.getElementById('chart-credit').style.display = 'none';
                document.getElementById('btn-credit-strategies').disabled = true;
                document.getElementById('btn-credit-print').disabled = true;
                return;
            }
            
            if (isNaN(payment) || payment <= 0) {
                document.getElementById('result-credit').textContent = 'Please enter a valid payment amount';
                document.getElementById('result-credit-detailed').style.display = 'none';
                document.getElementById('chart-credit').style.display = 'none';
                document.getElementById('btn-credit-strategies').disabled = true;
                document.getElementById('btn-credit-print').disabled = true;
                return;
            }
            
            const monthlyRate = apr / 100 / 12;
            const monthlyInterest = balance * monthlyRate;
            
            const minPaymentPercent = balance * 0.02;
            const minPaymentRequired = Math.max(minPaymentPercent, 25);
            
            const recommendedPayment = Math.max(balance * 0.03, 50);
            
            if (payment <= monthlyInterest && apr > 0) {
			const absoluteMinimum = Math.max(monthlyInterest * 1.1, minPaymentRequired);
    
			// ENHANCED: Super obvious debt spiral warning with animation
			document.getElementById('result-credit').innerHTML = 
				`<div style="animation: pulse 1.5s ease-in-out infinite;">
					<span style="font-size: 1.3rem; font-weight: 900;">🚨 CRITICAL: DEBT SPIRAL ACTIVE</span><br>
					<span style="font-size: 0.95rem; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
						Payment (${formatCurrency(payment)}) &lt; Interest (${formatCurrency(monthlyInterest)})<br>
						💸 Your debt INCREASES by ${formatCurrency(monthlyInterest - payment)}/month!
					</span>
				</div>`;
			document.getElementById('result-credit').style.background = 'linear-gradient(135deg, #450a0a 0%, #7f1d1d 25%, #991b1b 50%, #dc2626 75%, #ef4444 100%)';
			document.getElementById('result-credit').style.border = '4px solid #dc2626';
			document.getElementById('result-credit').style.boxShadow = '0 0 30px rgba(220, 38, 38, 0.6), inset 0 0 20px rgba(0, 0, 0, 0.3)';
    
			// ⬅️ NUEVO: Mostrar proyección de CRECIMIENTO de deuda
		const monthlyGrowth = monthlyInterest - payment;
		const oneYearGrowth = balance + (monthlyGrowth * 12);
		const fiveYearGrowth = balance + (monthlyGrowth * 60);
		const warningResult = `
			<div style="background: linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%); padding: 25px; border-radius: 16px; border: 4px solid #dc2626; box-shadow: 0 0 30px rgba(220, 38, 38, 0.5);">
				<h4 style="color: #fef2f2; font-size: 1.4rem; margin-bottom: 20px; text-align: center; animation: pulse 2s ease-in-out infinite;">
					🚨🚨🚨 EMERGENCY: DEBT SPIRAL ACTIVE 🚨🚨🚨
				</h4>
				<div style="background: rgba(254, 242, 242, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
					<div class="result-row" style="border-color: rgba(254, 242, 242, 0.3);">
						<span style="color: #fca5a5;">Current Balance:</span>
						<span style="color: #fef2f2; font-weight: 700;">${formatCurrency(balance)}</span>
					</div>
					<div class="result-row" style="border-color: rgba(254, 242, 242, 0.3);">
						<span style="color: #fca5a5;">Your Monthly Payment:</span>
						<span style="color: #fef2f2; font-weight: 700;">${formatCurrency(payment)}</span>
					</div>
					<div class="result-row" style="border-color: rgba(254, 242, 242, 0.3);">
						<span style="color: #fca5a5;">Monthly Interest Charge:</span>
						<span style="color: #fef2f2; font-weight: 900; font-size: 1.2rem;">${formatCurrency(monthlyInterest)}</span>
					</div>
					<div class="result-row" style="border-top: 3px solid #dc2626; margin-top: 15px; padding-top: 15px; border-bottom: none;">
						<span style="color: #fef2f2; font-weight: 900; font-size: 1.1rem;">⚠️ Debt GROWS by:</span>
						<span style="color: #fef2f2; font-weight: 900; font-size: 1.3rem; text-shadow: 0 0 10px rgba(220, 38, 38, 0.8);">
							${formatCurrency(monthlyGrowth)}/month
						</span>
					</div>
				</div>
			</div>

			<div style="margin-top: 20px; padding: 25px; background: linear-gradient(135deg, rgba(127, 29, 29, 0.3) 0%, rgba(220, 38, 38, 0.3) 100%); border-left: 6px solid #dc2626; border-radius: 12px; border: 2px solid #dc2626;">
				<h5 style="color: #dc2626; font-size: 1.3rem; margin-bottom: 15px; font-weight: 900;">📈 PROJECTED DEBT EXPLOSION</h5>
				<div style="background: rgba(127, 29, 29, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
					<div class="result-row" style="border: none; padding: 10px 0;">
						<span style="color: #7f1d1d; font-weight: 700;">Balance in 1 year:</span>
						<span style="color: #dc2626; font-weight: 900; font-size: 1.2rem;">${formatCurrency(oneYearGrowth)}</span>
					</div>
					<div class="result-row" style="border: none; padding: 10px 0;">
						<span style="color: #7f1d1d; font-weight: 700;">Balance in 5 years:</span>
						<span style="color: #dc2626; font-weight: 900; font-size: 1.2rem;">${formatCurrency(fiveYearGrowth)}</span>
					</div>
				</div>
				<p style="font-size: 1.05rem; color: #7f1d1d; font-weight: 700; text-align: center; line-height: 1.6; background: rgba(254, 242, 242, 0.5); padding: 15px; border-radius: 8px;">
					⛔ AT THIS RATE, YOUR DEBT WILL <span style="color: #dc2626; font-size: 1.2rem;">NEVER</span> BE PAID OFF.<br>
					IT WILL GROW INDEFINITELY AND COMPOUND AGAINST YOU.
				</p>
			</div>

			<div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, rgba(5, 150, 105, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%); border: 3px solid #059669; border-radius: 12px;">
				<h5 style="color: #047857; margin-bottom: 15px; font-size: 1.2rem; font-weight: 800;">✅ IMMEDIATE ACTIONS REQUIRED:</h5>
				<div class="result-row" style="border: none; padding: 8px 0; background: rgba(5, 150, 105, 0.1); border-radius: 6px; margin-bottom: 8px;">
					<span style="color: #065f46; font-weight: 700;">Absolute Minimum Payment:</span>
					<span style="color: #059669; font-weight: 900; font-size: 1.2rem;">${formatCurrency(absoluteMinimum)}</span>
				</div>
				<div class="result-row" style="border: none; padding: 8px 0; background: rgba(5, 150, 105, 0.1); border-radius: 6px;">
					<span style="color: #065f46; font-weight: 700;">Recommended Payment:</span>
					<span style="color: #059669; font-weight: 900; font-size: 1.2rem;">${formatCurrency(recommendedPayment)}</span>
				</div>
				<div style="margin-top: 15px; padding: 15px; background: rgba(251, 191, 36, 0.2); border-left: 4px solid #f59e0b; border-radius: 8px;">
					<p style="color: #92400e; font-weight: 700; font-size: 0.95rem; line-height: 1.6;">
						<strong style="font-size: 1.1rem;">🆘 EMERGENCY OPTIONS:</strong><br>
						• Balance transfer to 0% APR card (12-18 months grace period)<br>
						• Debt consolidation loan at lower interest rate<br>
						• Contact card issuer for hardship program<br>
						• Seek non-profit credit counseling: <strong>NFCC.org</strong><br>
						• Consider debt management plan (DMP)
					</p>
				</div>
			</div>
		`;
			
			// ✅ MEJORADO: Usar textContent para strings simples, innerHTML solo para HTML sanitizado
			const detailedElement = document.getElementById('result-credit-detailed');
			detailedElement.innerHTML = ''; // Limpiar primero
			const tempDiv = document.createElement('div');
			tempDiv.innerHTML = warningResult;
			detailedElement.appendChild(tempDiv);
			document.getElementById('result-credit-detailed').style.display = 'block';
			document.getElementById('chart-credit').style.display = 'none';
    
			// ⬅️ CAMBIO: DESHABILITAR botones pero NO marcar input como error
			document.getElementById('btn-credit-strategies').disabled = true;
			document.getElementById('btn-credit-print').disabled = false; // ⬅️ Permitir imprimir el warning
    
			const paymentInput = document.getElementById('credit-payment');
			if (paymentInput) {
				paymentInput.classList.add('error');
			}
    
			const errorMessage = document.getElementById('error-credit-payment');
			if (errorMessage) {
				errorMessage.textContent = `Must be > ${formatCurrency(monthlyInterest)} (monthly interest)`;
				errorMessage.style.display = 'block';
			}
    
			return;
		}

            const paymentInput = document.getElementById('credit-payment');
            if (paymentInput) {
                paymentInput.classList.remove('error');
            }
            const errorMessage = document.getElementById('error-credit-payment');
            if (errorMessage) {
                errorMessage.style.display = 'none';
            }
            
            if (payment < minPaymentRequired && apr > 0) {
                document.getElementById('result-credit').innerHTML = 
                    `<span style="font-size: 1rem;">⚠️ Very Slow Payoff</span><br>
                    <span style="font-size: 0.85rem; font-weight: 500;">
                        Payment below minimum<br>
                        Recommend: ${formatCurrency(recommendedPayment)}
                    </span>`;
                document.getElementById('result-credit').style.background = 'linear-gradient(135deg, #fde68a 0%, #fcd34d 25%, #fbbf24 50%, #f59e0b 75%, #d97706 100%)';
                
                // VISUAL FEEDBACK: Mark input with warning styling
                const paymentInput = document.getElementById('credit-payment');
                if (paymentInput) {
                    paymentInput.style.borderColor = '#f59e0b';
                    paymentInput.style.background = 'rgba(251, 191, 36, 0.1)';
                }
                
                const errorMessage = document.getElementById('error-credit-payment');
                if (errorMessage) {
                    errorMessage.textContent = `⚠️ Below recommended minimum (${formatCurrency(minPaymentRequired)})`;
                    errorMessage.style.color = '#f59e0b';
                    errorMessage.style.display = 'block';
                }
            } else {
                // Clear warning styling if payment is adequate
                const paymentInput = document.getElementById('credit-payment');
                if (paymentInput && !paymentInput.classList.contains('error')) {
                    paymentInput.style.borderColor = '';
                    paymentInput.style.background = '';
                }
                
                const errorMessage = document.getElementById('error-credit-payment');
                if (errorMessage && errorMessage.style.color === 'rgb(245, 158, 11)') {
                    errorMessage.style.display = 'none';
                }
            }
            
            let remainingBalance = balance;
			let totalPaid = 0;
			let months = 0;
			const maxMonths = 600; // 50 años máximo
			const monthlyInterest = balance * monthlyRate;

			// ✅ MEJORADO: Verificar múltiples condiciones problemáticas
			const principalPayment = payment - monthlyInterest;
			const isProgressTooSlow = principalPayment < 1 && principalPayment > 0;
			const willTakeTooLong = principalPayment > 0 && (balance / principalPayment) > maxMonths;

			if (isProgressTooSlow || willTakeTooLong) {
				const estimatedMonths = principalPayment > 0 ? Math.ceil(balance / principalPayment) : Infinity;
				const estimatedYears = estimatedMonths === Infinity ? '∞' : (estimatedMonths / 12).toFixed(1);
    
				document.getElementById('result-credit').textContent = '⚠️ Payment too low - extremely long payoff period';
				document.getElementById('result-credit-detailed').innerHTML = `
					<div style="padding: 20px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px;">
						<h4 style="color: #92400e; margin-bottom: 10px;">Payment Insufficient</h4>
						<p style="color: #78350f; line-height: 1.6;">
							Your payment of ${formatCurrency(payment)} only pays ${formatCurrency(Your payment of ${formatCurrency(payment)} only pays ${formatCurrency(
						</p>
						<div class="result-row" style="border: none; padding: 8px 0; background: rgba(127, 29, 29, 0.1); margin: 15px 0; border-radius: 6px;">
							<span style="color: #7f1d1d; font-weight: 600;">Monthly Interest:</span>
							<span style="color: #dc2626; font-weight: 700;">${formatCurrency(monthlyInterest)}</span>
						</div>
						<div class="result-row" style="border: none; padding: 8px 0; background: rgba(127, 29, 29, 0.1); margin: 15px 0; border-radius: 6px;">
							<span style="color: #7f1d1d; font-weight: 600;">Principal Payment:</span>
							<span style="color: #dc2626; font-weight: 700;">${formatCurrency(principalPayment)}</span>
						</div>
						<div class="result-row" style="border: none; padding: 8px 0; background: rgba(127, 29, 29, 0.1); margin: 15px 0; border-radius: 6px;">
							<span style="color: #7f1d1d; font-weight: 600;">Estimated Payoff Time:</span>
							<span style="color: #dc2626; font-weight: 700; font-size: 1.1rem;">${estimatedYears} years</span>
						</div>
						<p style="color: #78350f; margin-top: 15px; font-weight: 600;">
							⚠️ At this rate, it would take over 50 years to pay off the debt. The calculator cannot process such long periods.
						</p>
						<div style="margin-top: 15px; padding: 15px; background: rgba(5, 150, 105, 0.1); border: 2px solid #059669; border-radius: 8px;">
							<p style="color: #065f46; font-weight: 700; margin-bottom: 10px;">💡 Recommended Actions:</p>
							<div class="result-row" style="border: none; padding: 5px 0;">
								<span style="color: #047857;">Minimum recommended:</span>
								<span style="color: #059669; font-weight: 700;">${formatCurrency(monthlyInterest * 1.5)}</span>
							</div>
							<div class="result-row" style="border: none; padding: 5px 0;">
								<span style="color: #047857;">For reasonable payoff:</span>
								<span style="color: #059669; font-weight: 700;">${formatCurrency(Math.max(balance * 0.03, 50))}</span>
							</div>
						</div>
					</div>
				`;
				document.getElementById('result-credit-detailed').style.display = 'block';
				document.getElementById('chart-credit').style.display = 'none';
				document.getElementById('btn-credit-strategies').disabled = true;
				document.getElementById('btn-credit-print').disabled = false;
				return;
			}

			// ✅ Loop con protección adicional contra micro-incrementos
			while (remainingBalance > 0.01 && months < maxMonths) {
				const interest = remainingBalance * monthlyRate;
				const principal = Math.min(payment - interest, remainingBalance);

				// ✅ MEJORADO: Múltiples condiciones de salida
				if (principal <= 0.001) { // Menos de 0.1 centavo
					if (DEBUG_MODE) console.warn('Principal payment too small, breaking loop');
					break;
				}
    
				// ✅ NUEVO: Detectar caso edge donde payment = interest exactamente
				if (monthlyRate === 0 && payment === interest) {
					if (DEBUG_MODE) console.warn('Payment equals interest with 0% rate - infinite loop prevented');
					break;
				}
    
				// ✅ NUEVO: Detectar progreso nulo (balance no cambia)
				const previousBalance = remainingBalance;
				remainingBalance -= principal;
    
				if (Math.abs(previousBalance - remainingBalance) < 0.01 && months > 10) {
					if (DEBUG_MODE) console.warn('Balance not changing significantly, breaking loop');
					break;
				}
   
				totalPaid += payment;
				months++;    
				// ✅ AGREGADO: Detectar progreso estancado
				if (months % 100 === 0 && remainingBalance > balance * 0.95) {
					if (DEBUG_MODE) console.warn('Progress stalled after 100 months, breaking loop');
					break;
				}
			}

            if (months >= maxMonths) {
                document.getElementById('result-credit').textContent = 'Payment too low - will take 50+ years!';
                document.getElementById('result-credit-detailed').style.display = 'none';
                return;
            }
            
            const totalInterest = totalPaid - balance;
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            
            let timeString = '';
            if (years > 0) {
                timeString = `${years} year${years > 1 ? 's' : ''} ${remainingMonths} month${remainingMonths !== 1 ? 's' : ''}`;
            } else {
                timeString = `${months} month${months !== 1 ? 's' : ''}`;
            }
            
            if (payment >= recommendedPayment) {
                document.getElementById('result-credit').style.background = 'linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%)';
            }
            
            document.getElementById('result-credit').textContent = `Payoff Time: ${timeString}`;
            
            const detailedResult = `
                <h4>Payoff Plan</h4>
                <div class="result-row">
                    <span>Current Balance:</span>
                    <span>${formatCurrency(balance)}</span>
                </div>
                <div class="result-row">
                    <span>APR:</span>
                    <span>${apr}%</span>
                </div>
                <div class="result-row">
                    <span>Monthly Payment:</span>
                    <span>${formatCurrency(payment)}</span>
                </div>
                <div class="result-row">
                    <span>Payoff Time:</span>
                    <span>${timeString}</span>
				</div>
                <div class="result-row">
                    <span>Total Interest Paid:</span>
                    <span style="color: #dc2626;">${formatCurrency(totalInterest)}</span>
                </div>
                <div class="result-row">
                    <span>Total Amount Paid:</span>
                    <span>${formatCurrency(totalPaid)}</span>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; font-size: 0.85rem; color: #0d9488; text-align: center;">
                    You'll pay ${formatCurrency(totalInterest)} in interest - that's ${((totalInterest/balance)*100).toFixed(1)}% of your original balance!
                </div>
            `;
            
            document.getElementById('result-credit-detailed').innerHTML = detailedResult;
            document.getElementById('result-credit-detailed').style.display = 'block';
            
            // Create payoff timeline chart
            createCreditPayoffChart(balance, payment, monthlyRate, months);
            
            // Enable action buttons
            document.getElementById('btn-credit-strategies').disabled = false;
            document.getElementById('btn-credit-print').disabled = false;
        }
        
        function createCreditPayoffChart(initialBalance, payment, monthlyRate, totalMonths) {
            createChartWithLazyLoad(() => {
                destroyChart('credit-chart');
                
                const ctx = document.getElementById('credit-chart');
                if (!ctx) return;
                
                document.getElementById('chart-credit').style.display = 'block';
                
                const labels = [];
                const balanceData = [];
                const interestData = [];
                
                let balance = initialBalance;
                let cumulativeInterest = 0;
                
                // Sample every month or every few months depending on total length
                const sampleInterval = Math.max(1, Math.floor(totalMonths / 24));
                
                for (let month = 0; month <= totalMonths; month += sampleInterval) {
                    labels.push(`Month ${month}`);
                    balanceData.push(balance);
                    interestData.push(cumulativeInterest);
                    
                    // Process months in this interval
                    for (let i = 0; i < sampleInterval && month + i < totalMonths; i++) {
                        const interest = balance * monthlyRate;
                        const principal = Math.min(payment - interest, balance);
                        balance -= principal;
                        cumulativeInterest += interest;
                        
                        if (balance <= 0) break;
                    }
                }
                
                chartInstances['credit-chart'] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Remaining Balance',
                                data: balanceData,
                                borderColor: 'rgba(220, 38, 38, 1)',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                fill: true,
                                tension: 0.1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Cumulative Interest',
                                data: interestData,
                                borderColor: 'rgba(251, 146, 60, 1)',
                                backgroundColor: 'rgba(251, 146, 60, 0.1)',
                                fill: true,
                                tension: 0.1,
                                yAxisID: 'y'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Debt Payoff Progress',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + (value >= 1000 ? (value/1000).toFixed(1) + 'k' : value);
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }
        
        function showPayoffStrategies() {
            const balance = parseFloat(document.getElementById('credit-balance').value);
            const apr = parseFloat(document.getElementById('credit-apr').value);
            const payment = parseFloat(document.getElementById('credit-payment').value);
            
            if (isNaN(balance) || isNaN(apr) || isNaN(payment)) return;
            
            const monthlyRate = apr / 100 / 12;
            
            // Calculate different payment strategies
            const strategies = [
                { label: 'Current Payment', payment: payment },
                { label: 'Minimum (2%)', payment: Math.max(balance * 0.02, 25) },
                { label: 'Current + $50', payment: payment + 50 },
                { label: 'Current + $100', payment: payment + 100 },
                { label: 'Aggressive (5%)', payment: Math.max(balance * 0.05, 100) }
            ];
            
            let comparisonHTML = '<div class="comparison-container" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">';
            
            strategies.forEach(strategy => {
                const monthlyInterest = balance * monthlyRate;
                
                // Check if payment covers interest
                if (strategy.payment <= monthlyInterest) {
                    comparisonHTML += `
                        <div class="comparison-card" style="border: 2px solid #dc2626; background: rgba(220, 38, 38, 0.05);">
                            <h5>${strategy.label}</h5>
                            <p style="color: #dc2626; font-size: 0.85rem; font-weight: 600;">Cannot payoff - payment below interest!</p>
                        </div>
                    `;
                    return;
                }
                
                let remainingBalance = balance;
                let totalPaid = 0;
                let months = 0;
                const maxMonths = 600;
                
                while (remainingBalance > 0.01 && months < maxMonths) {
                    const interest = remainingBalance * monthlyRate;
                    const principal = Math.min(strategy.payment - interest, remainingBalance);
                    
                    if (principal <= 0) break;
                    
                    remainingBalance -= principal;
                    totalPaid += strategy.payment;
                    months++;
                }
                
                if (months >= maxMonths) {
                    comparisonHTML += `
                        <div class="comparison-card" style="border: 2px solid #dc2626;">
                            <h5>${strategy.label}</h5>
                            <p style="color: #dc2626; font-size: 0.85rem;">50+ years</p>
                        </div>
                    `;
                    return;
                }
                
                const totalInterest = totalPaid - balance;
                const years = Math.floor(months / 12);
                const remainingMonths = months % 12;
                
                const isCurrent = strategy.payment === payment;
                
                comparisonHTML += `
                    <div class="comparison-card" style="${isCurrent ? 'border: 3px solid #2dd4bf; background: rgba(45, 212, 191, 0.1);' : ''}">
                        <h5>${strategy.label} ${isCurrent ? '(Current)' : ''}</h5>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem;">
                            <span>Payment:</span>
                            <span>${formatCurrency(strategy.payment)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem;">
                            <span>Time:</span>
                            <span>${years}y ${remainingMonths}m</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem;">
                            <span>Interest:</span>
                            <span>${formatCurrency(totalInterest)}</span>
                        </div>
                        <div class="result-row" style="border: none; padding: 5px 0; font-size: 0.85rem; font-weight: 600;">
                            <span>Total:</span>
                            <span>${formatCurrency(totalPaid)}</span>
                        </div>
                    </div>
                `;
            });
            
            comparisonHTML += '</div>';
            
            // Calculate savings comparison
            let currentMonths = 0;
            let currentTotal = 0;
            let tempBalance = balance;
            while (tempBalance > 0.01 && currentMonths < 600) {
                const interest = tempBalance * monthlyRate;
                const principal = Math.min(payment - interest, tempBalance);
                if (principal <= 0) break;
                tempBalance -= principal;
                currentTotal += payment;
                currentMonths++;
            }
            
            const aggressivePayment = payment + 100;
            const monthlyInterestCheck = balance * monthlyRate;
            
            if (aggressivePayment > monthlyInterestCheck) {
                let aggressiveMonths = 0;
                let aggressiveTotal = 0;
                tempBalance = balance;
                while (tempBalance > 0.01 && aggressiveMonths < 600) {
                    const interest = tempBalance * monthlyRate;
                    const principal = Math.min(aggressivePayment - interest, tempBalance);
                    if (principal <= 0) break;
                    tempBalance -= principal;
                    aggressiveTotal += aggressivePayment;
                    aggressiveMonths++;
                }
                
                if (currentMonths < 600 && aggressiveMonths < 600) {
                    const savings = currentTotal - aggressiveTotal;
                    const timeSaved = currentMonths - aggressiveMonths;
                    
                    comparisonHTML += `
                        <div style="margin-top: 15px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px; text-align: center;">
                            <strong style="color: #059669; font-size: 1.05rem;">💰 Add $100/month = Save ${formatCurrency(savings)} and finish ${timeSaved} months earlier!</strong>
                        </div>
                    `;
                }
            }
            
            const existingComparison = document.getElementById('credit-comparison');
            if (existingComparison) {
                existingComparison.remove();
            }
            
            const chartContainer = document.getElementById('chart-credit');
            chartContainer.insertAdjacentHTML('afterend', `<div id="credit-comparison" class="result-detailed" style="margin-top: 20px;">${comparisonHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 8: BUDGET CALCULATOR
        // ============================================
        
        function calculateBudget() {
            const income = parseFloat(document.getElementById('budget-income').value);
            const housing = parseFloat(document.getElementById('budget-housing').value) || 0;
            const food = parseFloat(document.getElementById('budget-food').value) || 0;
            const transport = parseFloat(document.getElementById('budget-transport').value) || 0;
            const other = parseFloat(document.getElementById('budget-other').value) || 0;
            
            // Validation
            if (isNaN(income) || income <= 0) {
                document.getElementById('result-budget').textContent = 'Please enter a valid income';
                document.getElementById('result-budget-detailed').style.display = 'none';
                document.getElementById('chart-budget').style.display = 'none';
                document.getElementById('btn-budget-analysis').disabled = true;
                document.getElementById('btn-budget-print').disabled = true;
                return;
            }
            
            const totalExpenses = housing + food + transport + other;
            const remaining = income - totalExpenses;
            
            const housingPercent = (housing / income * 100).toFixed(1);
            const foodPercent = (food / income * 100).toFixed(1);
            const transportPercent = (transport / income * 100).toFixed(1);
            const otherPercent = (other / income * 100).toFixed(1);
            const remainingPercent = (remaining / income * 100).toFixed(1);
            
            const status = remaining >= 0 ? 'Surplus' : 'Deficit';
            const statusColor = remaining >= 0 ? '#059669' : '#dc2626';
            const emoji = remaining >= 0 ? '✅' : '⚠️';
            
            // Update result
            document.getElementById('result-budget').textContent = `${emoji} ${status}: ${formatCurrency(Math.abs(remaining))}`;
            document.getElementById('result-budget').style.background = remaining >= 0 ? 
                'linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%)' :
                'linear-gradient(135deg, #fca5a5 0%, #f87171 25%, #ef4444 50%, #dc2626 75%, #b91c1c 100%)';
            
            // Budget warnings based on best practices
            let warnings = '';
            
            if (parseFloat(housingPercent) > 30) {
                warnings += `
                    <div style="margin-top: 10px; padding: 10px; background: rgba(245, 158, 11, 0.15); border-left: 3px solid #f59e0b; border-radius: 6px; font-size: 0.85rem; color: #92400e;">
                        ⚠️ <strong>Housing:</strong> ${housingPercent}% of income (recommended: ≤30%). You may be "house poor." Consider cheaper housing or increasing income.
                    </div>
                `;
            }
            
            if (parseFloat(remainingPercent) < 20 && remaining >= 0) {
                warnings += `
                    <div style="margin-top: 10px; padding: 10px; background: rgba(245, 158, 11, 0.15); border-left: 3px solid #f59e0b; border-radius: 6px; font-size: 0.85rem; color: #92400e;">
                        ⚠️ <strong>Savings:</strong> Only ${remainingPercent}% left (recommended: 20%+ for savings/debt). Look for areas to reduce spending.
                    </div>
                `;
            }
            
            if (remaining < 0) {
                warnings += `
                    <div style="margin-top: 10px; padding: 10px; background: rgba(220, 38, 38, 0.15); border-left: 3px solid #dc2626; border-radius: 6px; font-size: 0.85rem; color: #b91c1c;">
                        🚨 <strong>OVERSPENDING:</strong> You're spending ${formatCurrency(Math.abs(remaining))} more than you earn! This leads to debt. Cut expenses immediately or increase income.
                    </div>
                `;
            }
            
            // Detailed breakdown
            const detailedResult = `
                <h4>Budget Summary</h4>
                <div class="result-row">
                    <span>Monthly Income:</span>
                    <span style="color: #059669; font-weight: 600;">${formatCurrency(income)}</span>
                </div>
                <div style="border-top: 1px solid rgba(45, 212, 191, 0.2); margin: 10px 0;"></div>
                <div class="result-row">
                    <span>Housing (${housingPercent}%):</span>
                    <span>${formatCurrency(housing)}</span>
                </div>
                <div class="result-row">
                    <span>Food & Groceries (${foodPercent}%):</span>
                    <span>${formatCurrency(food)}</span>
                </div>
                <div class="result-row">
                    <span>Transportation (${transportPercent}%):</span>
                    <span>${formatCurrency(transport)}</span>
                </div>
                <div class="result-row">
                    <span>Other Expenses (${otherPercent}%):</span>
                    <span>${formatCurrency(other)}</span>
                </div>
                <div style="border-top: 1px solid rgba(45, 212, 191, 0.2); margin: 10px 0;"></div>
                <div class="result-row">
                    <span>Total Expenses:</span>
                    <span style="font-weight: 600;">${formatCurrency(totalExpenses)}</span>
                </div>
                <div class="result-row" style="border-top: 2px solid rgba(45, 212, 191, 0.3); margin-top: 10px; padding-top: 12px;">
                    <span style="font-weight: 700;">${status} (${remainingPercent}%):</span>
                    <span style="color: ${statusColor}; font-size: 1.1rem; font-weight: 700;">${formatCurrency(Math.abs(remaining))}</span>
                </div>
                ${warnings}
            `;
            
            document.getElementById('result-budget-detailed').innerHTML = detailedResult;
            document.getElementById('result-budget-detailed').style.display = 'block';
            
            // Create budget pie chart
            createBudgetChart(housing, food, transport, other, remaining);
            
            // Enable action buttons
            document.getElementById('btn-budget-analysis').disabled = false;
            document.getElementById('btn-budget-print').disabled = false;
        }
        
        function createBudgetChart(housing, food, transport, other, savings) {
            createChartWithLazyLoad(() => {
                destroyChart('budget-chart');
                
                const ctx = document.getElementById('budget-chart');
                if (!ctx) return;
                
                document.getElementById('chart-budget').style.display = 'block';
                
                const data = [];
                const labels = [];
                const colors = [];
                
                if (housing > 0) {
                    data.push(housing);
                    labels.push('Housing');
                    colors.push('rgba(239, 68, 68, 0.8)');
                }
                if (food > 0) {
                    data.push(food);
                    labels.push('Food');
                    colors.push('rgba(251, 146, 60, 0.8)');
                }
                if (transport > 0) {
                    data.push(transport);
                    labels.push('Transportation');
                    colors.push('rgba(251, 191, 36, 0.8)');
                }
                if (other > 0) {
                    data.push(other);
                    labels.push('Other');
                    colors.push('rgba(147, 51, 234, 0.8)');
                }
                if (savings > 0) {
                    data.push(savings);
                    labels.push('Available/Savings');
                    colors.push('rgba(45, 212, 191, 0.8)');
                } else if (savings < 0) {
                    data.push(Math.abs(savings));
                    labels.push('Overspending');
                    colors.push('rgba(127, 29, 29, 0.8)');
                }
                
                chartInstances['budget-chart'] = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderColor: colors.map(c => c.replace('0.8', '1')),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Monthly Budget Breakdown',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = formatCurrency(context.parsed);
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }
        
        function showBudgetAnalysis() {
            const income = parseFloat(document.getElementById('budget-income').value);
            const housing = parseFloat(document.getElementById('budget-housing').value) || 0;
            const food = parseFloat(document.getElementById('budget-food').value) || 0;
            const transport = parseFloat(document.getElementById('budget-transport').value) || 0;
            const other = parseFloat(document.getElementById('budget-other').value) || 0;
            
            if (isNaN(income)) return;
            
            const totalExpenses = housing + food + transport + other;
            const remaining = income - totalExpenses;
            
            // 50/30/20 Rule Analysis
            const needs = housing + food + transport;
            const wants = other;
            const savings = remaining;
            
            const needsPercent = (needs / income * 100).toFixed(1);
            const wantsPercent = (wants / income * 100).toFixed(1);
            const savingsPercent = (savings / income * 100).toFixed(1);
            
            const needsTarget = income * 0.5;
            const wantsTarget = income * 0.3;
            const savingsTarget = income * 0.2;
            
            const needsStatus = needs <= needsTarget ? '✅' : '⚠️';
            const wantsStatus = wants <= wantsTarget ? '✅' : '⚠️';
            const savingsStatus = savings >= savingsTarget ? '✅' : '⚠️';
            
            let analysisHTML = `
                <h4 style="color: #0d9488; margin-bottom: 15px;">50/30/20 Rule Analysis</h4>
                <p style="margin-bottom: 15px; font-size: 0.9rem; color: #475569;">
                    The 50/30/20 rule suggests: 50% for Needs, 30% for Wants, 20% for Savings/Debt payoff.
                </p>
                <div style="background: rgba(255, 255, 255, 0.7); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div class="result-row" style="border: none; padding: 10px 0; font-size: 0.95rem;">
                        <span><strong>${needsStatus} Needs (Housing + Food + Transport):</strong></span>
                        <span style="font-weight: 600;">${needsPercent}% (target: 50%)</span>
                    </div>
                    <div style="background: rgba(45, 212, 191, 0.1); border-radius: 8px; padding: 5px; margin-top: 5px;">
                        <div style="background: ${needs <= needsTarget ? '#10b981' : '#f59e0b'}; height: 20px; border-radius: 8px; width: ${Math.min(parseFloat(needsPercent), 100)}%; transition: width 0.5s ease;"></div>
                    </div>
                    <p style="font-size: 0.8rem; color: #475569; margin-top: 5px;">
                        ${formatCurrency(needs)} / ${formatCurrency(needsTarget)} target
                        ${needs > needsTarget ? ` (${formatCurrency(needs - needsTarget)} over)` : ''}
                    </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.7); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div class="result-row" style="border: none; padding: 10px 0; font-size: 0.95rem;">
                        <span><strong>${wantsStatus} Wants (Entertainment, Dining, etc):</strong></span>
                        <span style="font-weight: 600;">${wantsPercent}% (target: 30%)</span>
                    </div>
                    <div style="background: rgba(45, 212, 191, 0.1); border-radius: 8px; padding: 5px; margin-top: 5px;">
                        <div style="background: ${wants <= wantsTarget ? '#10b981' : '#f59e0b'}; height: 20px; border-radius: 8px; width: ${Math.min(parseFloat(wantsPercent), 100)}%; transition: width 0.5s ease;"></div>
                    </div>
                    <p style="font-size: 0.8rem; color: #475569; margin-top: 5px;">
                        ${formatCurrency(wants)} / ${formatCurrency(wantsTarget)} target
                        ${wants > wantsTarget ? ` (${formatCurrency(wants - wantsTarget)} over)` : ''}
                    </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.7); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div class="result-row" style="border: none; padding: 10px 0; font-size: 0.95rem;">
                        <span><strong>${savingsStatus} Savings/Debt Payoff:</strong></span>
                        <span style="font-weight: 600;">${savingsPercent}% (target: 20%)</span>
                    </div>
                    <div style="background: rgba(45, 212, 191, 0.1); border-radius: 8px; padding: 5px; margin-top: 5px;">
                        <div style="background: ${savings >= savingsTarget ? '#10b981' : '#dc2626'}; height: 20px; border-radius: 8px; width: ${Math.max(0, Math.min(parseFloat(savingsPercent), 100))}%; transition: width 0.5s ease;"></div>
                    </div>
                    <p style="font-size: 0.8rem; color: #475569; margin-top: 5px;">
                        ${formatCurrency(Math.max(0, savings))} / ${formatCurrency(savingsTarget)} target
                        ${savings < savingsTarget ? ` (${formatCurrency(savingsTarget - Math.max(0, savings))} short)` : ''}
                    </p>
                </div>
            `;
            
            // Recommendations
            let recommendations = '<div style="margin-top: 20px; padding: 15px; background: rgba(45, 212, 191, 0.1); border-left: 4px solid #10b981; border-radius: 8px;"><h5 style="color: #0d9488; margin-bottom: 10px;">💡 Recommendations:</h5><ul style="margin-left: 20px; color: #475569; font-size: 0.9rem; line-height: 1.8;">';
            
            if (needs > needsTarget) {
                recommendations += '<li><strong>Reduce needs:</strong> Consider cheaper housing, meal prep to reduce food costs, or carpooling/public transit.</li>';
            }
            if (wants > wantsTarget) {
                recommendations += '<li><strong>Cut discretionary spending:</strong> Reduce dining out, subscriptions, entertainment. Try the "30-day rule" before non-essential purchases.</li>';
            }
            if (savings < savingsTarget) {
                recommendations += '<li><strong>Increase savings:</strong> Automate transfers to savings account on payday. Even $50/month builds emergency fund.</li>';
            }
            if (needs <= needsTarget && wants <= wantsTarget && savings >= savingsTarget) {
                recommendations += '<li><strong>Excellent balance!</strong> You\'re following the 50/30/20 rule well. Consider increasing savings for long-term goals.</li>';
            }
            
            recommendations += '</ul></div>';
            analysisHTML += recommendations;
            
            const existingAnalysis = document.getElementById('budget-analysis');
            if (existingAnalysis) {
                existingAnalysis.remove();
            }
            
            const chartContainer = document.getElementById('chart-budget');
            chartContainer.insertAdjacentHTML('afterend', `<div id="budget-analysis" class="result-detailed" style="margin-top: 20px;">${analysisHTML}</div>`);
        }

        // ============================================
        // CALCULATOR 9: CURRENCY CONVERTER (LIVE RATES)
        // ============================================
        
		// ============================================
		// CENTRALIZED FALLBACK CURRENCY RATES
		// ============================================
		function getFallbackCurrencyRates() {
			console.warn('⚠️ Using fallback approximate rates (last updated: November 2025)');
			return {
				'USD': 1.0,
				'EUR': 0.9247,
				'GBP': 0.7912,
				'JPY': 151.20,
				'CAD': 1.3850,
				'AUD': 1.5340,
				'CHF': 0.8845,
				'CNY': 7.2450,
				'INR': 83.68,
				'MXN': 17.25,
				'BRL': 5.78,
				'ZAR': 18.12,
				'SGD': 1.3420,
				'HKD': 7.7950,
				'SEK': 10.95,
				'NOK': 11.08
			};
		}

		// Ahora sí viene fetchCurrencyRates:
        async function fetchCurrencyRates() {
			const now = Date.now();
    
			// ✅ NUEVO: Intentar cargar desde localStorage primero si memoria está vacía
			if (Object.keys(currencyRates).length === 0) {
				try {
					const cached = localStorage.getItem('rapidpercent_currency_cache');
					if (cached) {
						const cacheData = JSON.parse(cached);
						if (cacheData.rates && cacheData.timestamp && 
							(now - cacheData.timestamp < CURRENCY_CACHE_DURATION)) {
							currencyRates = cacheData.rates;
							currencyRatesLastFetched = cacheData.timestamp;
							if (DEBUG_MODE) console.log('✅ Loaded currency rates from localStorage cache');
						}
					}
				} catch(e) {
					if (DEBUG_MODE) console.warn('Failed to load localStorage cache:', e);
				}
			}
    
			// Check if we have cached rates (less than 2 hours old)
			if (currencyRatesLastFetched && (now - currencyRatesLastFetched < CURRENCY_CACHE_DURATION) && Object.keys(currencyRates).length > 0) {
				if (DEBUG_MODE) console.log('✅ Using cached currency rates');
				return currencyRates;
			}
		
			try {
				try {
					// Enhanced timeout with retry logic
					const controller = new AbortController();
					const timeoutId = setTimeout(() => controller.abort(), 8000);
    
					if (DEBUG_MODE) console.log('🔡 Fetching fresh currency rates...');
    
					const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD', {
						signal: controller.signal,
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
					},
					mode: 'cors',
					cache: 'no-cache'
				});
        
				// ✅ NUEVO: Cleanup if controller was aborted
				if (controller.signal.aborted) {
					if (DEBUG_MODE) console.log('⚠️ Currency fetch was aborted');
					throw new Error('Request aborted');
				}

clearTimeout(timeoutId);
		
				clearTimeout(timeoutId);
        
				// Record successful request
				currencyRequestTracker.recordRequest();
				const remaining = currencyRequestTracker.getRemainingRequests();
				if (DEBUG_MODE) console.log(`✅ Rate limit status: ${remaining.hourly}/hour, ${remaining.daily}/day remaining`);
        
				// HTTP response validation
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
        
				// Content-Type validation
				const contentType = response.headers.get('content-type');
				if (!contentType || !contentType.includes('application/json')) {
					throw new Error('Invalid response format - expected JSON');
				}
        
				const data = await response.json();
        
				// SERVER-SIDE VALIDATION: Data structure
				if (!data || typeof data !== 'object') {
					throw new Error('Invalid data structure received');
				}
        
				// VALIDATION: 'rates' field exists and is object
				if (!data.rates || typeof data.rates !== 'object') {
					throw new Error('Missing or invalid rates object');
				}
        
				// VALIDATION: At least 10 currencies (sanity check)
				const rateKeys = Object.keys(data.rates);
				if (rateKeys.length < 10) {
					throw new Error('Insufficient currency data received');
				}
        
				// VALIDATION: All values are positive numbers
				const invalidRates = rateKeys.filter(key => {
					const rate = data.rates[key];
					return typeof rate !== 'number' || rate <= 0 || !isFinite(rate);
				});
        
				if (invalidRates.length > 0) {
					console.warn('Invalid rates detected:', invalidRates);
					throw new Error('Invalid rate values received');
				}
        
				// VALIDATION: Required currencies are present
				const requiredCurrencies = ['EUR', 'GBP', 'JPY', 'CAD', 'AUD'];
				const missingCurrencies = requiredCurrencies.filter(curr => !(curr in data.rates));
        
				if (missingCurrencies.length > 0) {
					console.warn('Missing required currencies:', missingCurrencies);
					throw new Error('Required currencies missing from API response');
				}
        
				// VALIDATION: Rates reasonable (sanity check)
				if (data.rates.EUR < 0.70 || data.rates.EUR > 1.30) {
					console.warn('EUR rate seems unrealistic:', data.rates.EUR);
					throw new Error('Currency rates appear invalid - possible API data corruption');
				}
        
				// If all validations passed, save data
				currencyRates = { ...data.rates };
				currencyRates['USD'] = 1;
				currencyRatesLastFetched = now;
        
				// ✅ NUEVO: Guardar en localStorage
				try {
					const cacheData = {
						rates: currencyRates,
						timestamp: now,
						version: 1
					};
				localStorage.setItem('rapidpercent_currency_cache', JSON.stringify(cacheData));
					if (DEBUG_MODE) console.log('💾 Currency rates cached in localStorage');
				} catch(storageError) {
					if (DEBUG_MODE) console.warn('Failed to cache currency rates:', storageError);
				}
        
				if (DEBUG_MODE) console.log(`Currency rates fetched successfully: ${rateKeys.length} currencies`);
				return currencyRates;
        
			} catch (error) {
				console.error('Error fetching currency rates:', error);
        
				// Use cached rates if available (even if stale)
				if (Object.keys(currencyRates).length > 0) {
					console.warn('⚠️ Using stale cached currency rates due to fetch error');
					return currencyRates;
				}
        
				// Usar función centralizada como último recurso
				console.warn('⚠️ Using fallback approximate rates');
				const fallbackRates = getFallbackCurrencyRates();
				currencyRates = { ...fallbackRates };
				currencyRatesLastFetched = Date.now();
        
				// Intentar guardar fallback en localStorage
				try {
					const cacheData = {
						rates: fallbackRates,
						timestamp: Date.now(),
						version: 1,
						isFallback: true
					};
					localStorage.setItem('rapidpercent_currency_cache', JSON.stringify(cacheData));
				} catch(e) {
					if (DEBUG_MODE) console.warn('Failed to cache fallback rates:', e);
				}
        
				return fallbackRates;
			}
		}
                
        async function calculateCurrency() {
			// ✅ MEJORADO: Agregar timestamp único para tracking
			const requestId = Date.now() + Math.random();
    
			// Cancel any previous calculation in progress
			if (currencyCalculationController) {
				currencyCalculationController.cancelled = true;
				// ✅ NO nullificar inmediatamente - dejar que termine su cleanup
			}

			// Create new controller for this operation
			const currentController = { 
				cancelled: false,
				id: requestId // ✅ ID único para verificar validez
			};
			currencyCalculationController = currentController;
    
			const amount = parseFloat(document.getElementById('currency-amount').value);
			const from = document.getElementById('currency-from').value;
			const to = document.getElementById('currency-to').value;
    
			// Validation
			if (isNaN(amount) || amount < 0) {
				document.getElementById('result-currency').textContent = 'Please enter a valid amount';
				document.getElementById('result-currency-detailed').style.display = 'none';
				document.getElementById('btn-currency-print').disabled = true;

				// ✅ MEJORADO: Solo cleanup si ESTE controller sigue activo
				if (currencyCalculationController?.id === requestId) {
					currencyCalculationController = null;
				}
				return;
			}
            
            // Show loading indicator
            const indicator = document.getElementById('calc-currency-indicator');
            if (indicator) indicator.style.display = 'block';
            
            try {
				// ✅ NUEVO: Verificar que los inputs no cambiaron ANTES de fetch
				const fromBeforeFetch = document.getElementById('currency-from').value;
				const toBeforeFetch = document.getElementById('currency-to').value;
				const amountBeforeFetch = parseFloat(document.getElementById('currency-amount').value);

				// Fetch rates
				const rates = await fetchCurrencyRates();

				// ✅ CRITICAL: Re-check ALL conditions after async operation
				const fromAfterFetch = document.getElementById('currency-from').value;
				const toAfterFetch = document.getElementById('currency-to').value;
				const amountAfterFetch = parseFloat(document.getElementById('currency-amount').value);

				// ✅ NUEVO: Also check if this request is still the active one
				const isStillActive = currencyCalculationController && 
									currencyCalculationController.id === requestId &&
									!currentController.cancelled;

				if (!isStillActive ||
					fromBeforeFetch !== fromAfterFetch ||
					toBeforeFetch !== toAfterFetch ||
					amountBeforeFetch !== amountAfterFetch) {
					if (DEBUG_MODE) console.log(`Request ${requestId} cancelled or inputs changed`);
					if (indicator) indicator.style.display = 'none';
					return;
				}
    
                if (indicator) indicator.style.display = 'none';
                
                // Convert
                const amountInUSD = amount / rates[from];
                const convertedAmount = amountInUSD * rates[to];
                const rate = rates[to] / rates[from];
                
                // Update result
                document.getElementById('result-currency').textContent = 
                    `${formatNumber(amount, 2)} ${from} = ${formatNumber(convertedAmount, 2)} ${to}`;
                
                // Get timestamp of rates
                const rateAge = currencyRatesLastFetched ? new Date(currencyRatesLastFetched).toLocaleString() : 'Unknown';
                
                // Detailed breakdown with real-world fees
                const detailedResult = `
                    <h4>Conversion Details</h4>
                    <div class="result-row">
                        <span>Amount:</span>
                        <span>${formatNumber(amount, 2)} ${from}</span>
                    </div>
                    <div class="result-row">
                        <span>Exchange Rate:</span>
                        <span>1 ${from} = ${formatNumber(rate, 6)} ${to}</span>
                    </div>
                    <div class="result-row">
                        <span>Converted Amount:</span>
                        <span style="color: #059669; font-weight: 600; font-size: 1.1rem;">${formatNumber(convertedAmount, 2)} ${to}</span>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; font-size: 0.85rem; color: #0d9488; text-align: center;">
                        <strong>🔄 Live Rate:</strong> Updated ${rateAge}<br>
                        Mid-market rate from exchangerate-api.com
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; font-size: 0.85rem; color: #92400e;">
                        <strong>💳 Real Transaction Costs:</strong><br>
                        • No-fee credit card: ~${formatNumber(convertedAmount * 0.99, 2)} ${to} (1% markup)<br>
                        • Regular credit card (3% fee): ~${formatNumber(convertedAmount * 0.97, 2)} ${to}<br>
                        • Bank wire transfer: ~${formatNumber(convertedAmount * 0.96, 2)} ${to} (4% fees)<br>
                        • Airport/hotel exchange: ~${formatNumber(convertedAmount * 0.90, 2)} ${to} (10% markup)
                    </div>
                `;
                
                document.getElementById('result-currency-detailed').innerHTML = detailedResult;
                document.getElementById('result-currency-detailed').style.display = 'block';
                
                // Enable action buttons
                document.getElementById('btn-currency-print').disabled = false;
                
            } catch (error) {
                console.error('Error in currency calculation:', error);
                document.getElementById('result-currency').textContent = 'Error calculating conversion. Please try again.';
                document.getElementById('result-currency-detailed').style.display = 'none';
                if (indicator) indicator.style.display = 'none';
            } finally {
				// ✅ MEJORADO: Solo cleanup si este request específico sigue siendo el activo
				if (currencyCalculationController?.id === requestId) {
					currencyCalculationController = null;
				}
			}
        }

        // ============================================
        // CALCULATOR 10: INFLATION CALCULATOR
        // ============================================
        
        function calculateInflation() {
            const amount = parseFloat(document.getElementById('inflation-amount').value);
            const rate = parseFloat(document.getElementById('inflation-rate').value);
            const years = parseFloat(document.getElementById('inflation-years').value);
            
            // Validation
            if (isNaN(amount) || amount <= 0) {
                document.getElementById('result-inflation').textContent = 'Please enter a valid amount';
                document.getElementById('result-inflation-detailed').style.display = 'none';
                document.getElementById('chart-inflation').style.display = 'none';
                document.getElementById('inflation-disclaimer').style.display = 'none';
                document.getElementById('btn-inflation-breakdown').disabled = true;
                document.getElementById('btn-inflation-print').disabled = true;
                return;
            }
            
            if (isNaN(rate) || rate < 0 || rate > 100) {
                document.getElementById('result-inflation').textContent = 'Please enter a valid rate (0-100%)';
                document.getElementById('result-inflation-detailed').style.display = 'none';
                document.getElementById('chart-inflation').style.display = 'none';
                document.getElementById('inflation-disclaimer').style.display = 'none';
                document.getElementById('btn-inflation-breakdown').disabled = true;
                document.getElementById('btn-inflation-print').disabled = true;
                return;
            }
            
            // DEFLATION WARNING: Alert if rate is 0 or very low
            if (rate === 0) {
                document.getElementById('result-inflation').textContent = '⚠️ Zero inflation entered';
                document.getElementById('result-inflation-detailed').innerHTML = `
                    <div style="padding: 20px; background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; border-radius: 8px;">
                        <h4 style="color: #92400e; margin-bottom: 10px;">💡 Zero Inflation</h4>
                        <p style="color: #78350f; line-height: 1.6;">
                            With 0% inflation, purchasing power remains constant. ${formatCurrency(amount)} today 
                            will have the same value in ${years} years.
                        </p>
                        <p style="color: #78350f; margin-top: 10px;">
                            This is rare in real economies. Historical US average is 3.3% (1913-2024).
                        </p>
                    </div>
                `;
                document.getElementById('result-inflation-detailed').style.display = 'block';
                document.getElementById('chart-inflation').style.display = 'none';
                document.getElementById('inflation-disclaimer').style.display = 'block';
                document.getElementById('btn-inflation-breakdown').disabled = true;
                document.getElementById('btn-inflation-print').disabled = false;
                return;
            }
            
            if (isNaN(years) || years <= 0 || years > 100) {
				document.getElementById('result-inflation').textContent = 'Please enter a valid period';
				document.getElementById('result-inflation-detailed').style.display = 'none';
				document.getElementById('chart-inflation').style.display = 'none';
				document.getElementById('inflation-disclaimer').style.display = 'none';
				document.getElementById('btn-inflation-breakdown').disabled = true;
				document.getElementById('btn-inflation-print').disabled = true;
				return;
			}
            
            // Calculate future value
            const futureValue = amount * Math.pow(1 + rate / 100, years);
            const inflationImpact = futureValue - amount;
            const purchasingPowerLoss = ((futureValue - amount) / futureValue * 100);
            
            // Rule of 70 - years to lose half purchasing power
            const yearsToHalf = rate > 0 ? (70 / rate).toFixed(1) : 'N/A';
            
            // Update result
            document.getElementById('result-inflation').textContent = `Future Value Needed: ${formatCurrency(futureValue)}`;
            
            // Detailed breakdown
            const detailedResult = `
                <h4>Inflation Impact Analysis</h4>
                <div class="result-row">
                    <span>Today's Value:</span>
                    <span>${formatCurrency(amount)}</span>
                </div>
                <div class="result-row">
                    <span>Annual Inflation Rate:</span>
                    <span>${formatNumber(rate, 1)}%</span>
                </div>
                <div class="result-row">
                    <span>Time Period:</span>
                    <span>${years} year${years > 1 ? 's' : ''}</span>
                </div>
                <div class="result-row">
                    <span>Future Value Needed:</span>
                    <span style="color: #dc2626; font-weight: 600;">${formatCurrency(futureValue)}</span>
                </div>
                <div class="result-row">
                    <span>Cumulative Inflation:</span>
                    <span>${formatCurrency(inflationImpact)}</span>
                </div>
                <div class="result-row">
                    <span>Purchasing Power Loss:</span>
                    <span>${formatNumber(purchasingPowerLoss, 1)}%</span>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: rgba(245, 158, 11, 0.15); border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <p style="color: #92400e; font-size: 0.95rem; font-weight: 600; text-align: center;">
                        You'll need ${formatCurrency(futureValue)} in ${years} years to have the same buying power as ${formatCurrency(amount)} today.
                    </p>
                </div>
                <div style="margin-top: 12px; padding: 12px; background: rgba(45, 212, 191, 0.1); border-radius: 8px; font-size: 0.85rem; color: #0d9488;">
                    <strong>📊 Rule of 70:</strong> At ${rate}% inflation, money loses half its purchasing power in ~${yearsToHalf} years.
                </div>
            `;
            
            document.getElementById('result-inflation-detailed').innerHTML = detailedResult;
            document.getElementById('result-inflation-detailed').style.display = 'block';
            document.getElementById('inflation-disclaimer').style.display = 'block';
            
            // Create inflation chart
            createInflationChart(amount, rate, years);
            
            // Enable action buttons
            document.getElementById('btn-inflation-breakdown').disabled = false;
            document.getElementById('btn-inflation-print').disabled = false;
        }
        
        function createInflationChart(initialAmount, inflationRate, years) {
			createChartWithLazyLoad(() => {
				destroyChart('inflation-chart');
        
				const ctx = document.getElementById('inflation-chart');
				if (!ctx) return;
        
				document.getElementById('chart-inflation').style.display = 'block';
        
				const labels = [];
				const futureValues = [];
				const todayValues = [];
        
				// ✅ NUEVO: Limitar años para evitar overflow de memoria
				const maxYearsForChart = Math.min(years, 50);
				const yearStep = years > 50 ? Math.ceil(years / 50) : 1;
        
				// ✅ MEJORADO: Samplear datos para períodos muy largos
				for (let year = 0; year <= maxYearsForChart; year += yearStep) {
					const actualYear = Math.min(year, years);
					labels.push(`Year ${actualYear}`);
    
					// ✅ NUEVO: Calcular con protección contra overflow
					const exponent = actualYear * Math.log(1 + inflationRate / 100);
    
					// ✅ CRITICAL: Prevenir overflow ANTES de calcular
					if (exponent > 34.5) { // ln(1e15) ≈ 34.5
						if (DEBUG_MODE) console.warn('Chart value would overflow, stopping at year', actualYear);
						break;
					}
    
					const futureValue = initialAmount * Math.exp(exponent);
    
					// ✅ Validación adicional por si acaso
					if (!isFinite(futureValue) || futureValue > 1e15) {
						if (DEBUG_MODE) console.warn('Chart value too large, capping at last valid point');
						break;
					}
    
					futureValues.push(futureValue);
					todayValues.push(initialAmount);
				}
        
				chartInstances['inflation-chart'] = new Chart(ctx, {
					type: 'line',
					data: {
						labels: labels,
						datasets: [
							{
								label: 'Amount Needed (Inflated)',
								data: futureValues,
								borderColor: 'rgba(220, 38, 38, 1)',
								backgroundColor: 'rgba(220, 38, 38, 0.1)',
								fill: true,
								tension: 0.1
							},
							{
								label: 'Today\'s Value (Reference)',
								data: todayValues,
								borderColor: 'rgba(45, 212, 191, 1)',
								backgroundColor: 'rgba(45, 212, 191, 0.1)',
								fill: false,
								borderDash: [5, 5],
								tension: 0
							}
						]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
							legend: {
								position: 'bottom'
							},
							title: {
								display: true,
								text: 'Purchasing Power Erosion Over Time',
								font: {
									size: 16,
									weight: 'bold'
								}
							},
							tooltip: {
								callbacks: {
									label: function(context) {
										return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
									}
								}
							}
						},
						scales: {
							y: {
								beginAtZero: true,
								ticks: {
									callback: function(value) {
										return formatCurrency(value);
									}
								}
							}
						}
					}
				});
			});
		}
        
        function showInflationBreakdown() {
			const amount = parseFloat(document.getElementById('inflation-amount').value);
			const rate = parseFloat(document.getElementById('inflation-rate').value);
			const years = parseFloat(document.getElementById('inflation-years').value);
    
			if (isNaN(amount) || isNaN(rate) || isNaN(years)) return;
    
			// Different categories inflate at different rates
			const categories = [
				{ name: 'Healthcare', rate: rate + 2, icon: '🏥' },
				{ name: 'Education', rate: rate + 2.5, icon: '🎓' },
				{ name: 'Housing', rate: rate + 0.5, icon: '🏠' },
				{ name: 'Food', rate: rate + 0.3, icon: '🍽️' },
				{ name: 'Transportation', rate: rate - 0.2, icon: '🚗' },
				{ name: 'Technology', rate: rate - 3, icon: '💻' },
				{ name: 'General', rate: rate, icon: '📊' }
			];
    
			let breakdownHTML = `
				<h4 style="color: #0d9488; margin-bottom: 15px;">Category-Specific Inflation Impact</h4>
				<p style="margin-bottom: 15px; font-size: 0.9rem; color: #475569;">
					Different categories typically inflate at different rates. Here's how ${formatCurrency(amount)} today translates across categories in ${years} years:
				</p>
				<div style="background: rgba(255, 255, 255, 0.7); border-radius: 12px; padding: 15px;">
			`;
    
			categories.forEach(category => {
				const categoryRate = Math.max(0, category.rate); // Prevent negative rates
				const futureValue = amount * Math.pow(1 + categoryRate / 100, years);
				const difference = futureValue - amount;
				const percentIncrease = ((futureValue - amount) / amount * 100).toFixed(1);
        
				breakdownHTML += `
					<div style="margin-bottom: 15px; padding: 15px; background: rgba(45, 212, 191, 0.05); border-left: 3px solid #2dd4bf; border-radius: 8px;">
						<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
							<span style="font-weight: 600; color: #0f172a; font-size: 1rem;">
								${category.icon} ${category.name}
							</span>
							<span style="font-weight: 600; color: #dc2626;">
								${formatNumber(categoryRate, 1)}% annual
							</span>
						</div>
						<div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #475569;">
							<span>Future cost:</span>
							<span style="font-weight: 600;">${formatCurrency(futureValue)}</span>
						</div>
						<div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #dc2626; margin-top: 4px;">
							<span>Increase:</span>
							<span>+${formatCurrency(difference)} (+${percentIncrease}%)</span>
						</div>
					</div>
				`;
			});
    
			breakdownHTML += `
				</div>
				<div style="margin-top: 15px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.85rem; color: #92400e;">
					<strong>📚 Note:</strong> These are illustrative estimates. Healthcare and education typically inflate faster than average. 
					Technology often deflates (gets cheaper). Actual rates vary by location and time period.
				</div>
			`;
    
			const existingBreakdown = document.getElementById('inflation-breakdown');
			if (existingBreakdown) {
				existingBreakdown.remove();
			}
    
			const chartContainer = document.getElementById('chart-inflation');
			chartContainer.insertAdjacentHTML('afterend', `<div id="inflation-breakdown" class="result-detailed" style="margin-top: 20px;">${breakdownHTML}</div>`);
		}

        // ============================================
        // UTILITY FUNCTIONS FOR ALL CALCULATORS
        // ============================================
        
        function clearCalculator(calcId) {
            const card = document.getElementById(calcId);
            if (!card) return;
            
            // Clear all inputs
            const inputs = card.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('error');
            });
            
            // Reset selects to default
            const selects = card.querySelectorAll('select');
            selects.forEach(select => {
                select.selectedIndex = 0;
            });
            
            // Clear error messages
            const errors = card.querySelectorAll('.error-message');
            errors.forEach(error => {
                error.style.display = 'none';
            });
            
            // Reset result
            const result = card.querySelector('.result');
            if (result) {
                result.textContent = 'Enter values above';
                result.style.background = 'linear-gradient(135deg, #6ee7b7 0%, #34d399 25%, #10b981 50%, #059669 75%, #047857 100%)';
            }
            
            // Hide detailed results
            const detailedResult = card.querySelector('.result-detailed');
            if (detailedResult) {
                detailedResult.style.display = 'none';
            }
            
            // Hide charts
            const charts = card.querySelectorAll('.chart-container, .amortization-schedule');
            charts.forEach(chart => {
                chart.style.display = 'none';
            });
            
            // Hide disclaimers
            const disclaimers = card.querySelectorAll('.disclaimer-box');
            disclaimers.forEach(disclaimer => {
                disclaimer.style.display = 'none';
            });
            
            // Disable action buttons
            const buttons = card.querySelectorAll('.action-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
            });
            
            // Destroy associated charts
            const chartCanvas = card.querySelector('canvas');
            if (chartCanvas) {
                const chartId = chartCanvas.id;
                destroyChart(chartId);
            }
            
            // Remove any comparison sections
            const comparisons = document.querySelectorAll(`[id$="-comparison"], [id$="-analysis"], [id$="-projection"], [id$="-breakdown"]`);
            comparisons.forEach(comp => {
                if (card.contains(comp) || comp.previousElementSibling?.closest('.calc-card')?.id === calcId) {
                    comp.remove();
                }
            });
            
            // Focus first input
            const firstInput = card.querySelector('input[type="number"]');
            if (firstInput) {
                firstInput.focus();
            }
        }
		
		// Helper function to generate PDF content (extracted for reusability)
        function generatePDFContent(targetWindow, card, title, resultMain, resultDetailedElement, amortizationElement, comparisonElement, analysisElement) {
            const resultDetailed = resultDetailedElement;
            const amortization = amortizationElement;
            const comparison = comparisonElement;
            const analysis = analysisElement;
            
            // Get timestamp
            const now = new Date();
            const timestamp = now.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            targetWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title} - RapidPercent</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 20mm;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            font-size: 11pt;
                            line-height: 1.6;
                            color: #333;
                            padding: 20px;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 3px solid #2dd4bf;
                        }
                        
                        .header h1 {
                            color: #0d9488;
                            font-size: 24pt;
                            margin-bottom: 10px;
                        }
                        
                        .header .subtitle {
                            color: #666;
                            font-size: 10pt;
                        }
                        
                        .main-result {
                            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
                            padding: 20px;
                            border-radius: 10px;
                            text-align: center;
                            font-size: 16pt;
                            font-weight: bold;
                            color: #047857;
                            margin: 25px 0;
                            border: 2px solid #10b981;
                        }
                        
                        .section {
                            margin: 25px 0;
                            padding: 20px;
                            background: #f9fafb;
                            border-radius: 8px;
                            border-left: 4px solid #2dd4bf;
                        }
                        
                        .section h2 {
                            color: #0d9488;
                            font-size: 14pt;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 2px solid #e5e7eb;
                        }
                        
                        .result-row {
                            display: flex;
                            justify-content: space-between;
                            padding: 8px 0;
                            border-bottom: 1px solid #e5e7eb;
                        }
                        
                        .result-row:last-child {
                            border-bottom: none;
                            font-weight: bold;
                            color: #0d9488;
                            font-size: 12pt;
                            padding-top: 12px;
                            margin-top: 8px;
                            border-top: 2px solid #2dd4bf;
                        }
                        
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 15px 0;
                            font-size: 9pt;
                        }
                        
                        th {
                            background: linear-gradient(135deg, #6ee7b7 0%, #10b981 100%);
                            color: white;
                            padding: 10px;
                            text-align: left;
                            font-weight: bold;
                        }
                        
                        td {
                            padding: 8px 10px;
                            border-bottom: 1px solid #e5e7eb;
                        }
                        
                        tr:nth-child(even) {
                            background: #f9fafb;
                        }
                        
                        tr:hover {
                            background: #f0fdfa;
                        }
                        
                        .footer {
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 2px solid #e5e7eb;
                            text-align: center;
                            color: #6b7280;
                            font-size: 9pt;
                        }
                        
                        .footer .timestamp {
                            font-weight: bold;
                            color: #0d9488;
                            margin-bottom: 5px;
                        }
                        
                        .footer .disclaimer {
                            background: #fef3c7;
                            border: 1px solid #f59e0b;
                            border-radius: 5px;
                            padding: 10px;
                            margin-top: 15px;
                            font-size: 8pt;
                            text-align: left;
                        }
                        
                        @media print {
                            body {
                                padding: 0;
                            }
                            
                            .section {
                                page-break-inside: avoid;
                            }
                            
                            table {
                                page-break-inside: auto;
                            }
                            
                            tr {
                                page-break-inside: avoid;
                                page-break-after: auto;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p class="subtitle">Generated by RapidPercent.com Financial Calculators</p>
                    </div>
                    
                    <div class="main-result">
                        ${resultMain}
                    </div>
            `);
            
            // Add detailed results
            if (resultDetailed && resultDetailed.style.display !== 'none') {
                targetWindow.document.write(`
                    <div class="section">
                        ${resultDetailed.innerHTML}
                    </div>
                `);
            }
            
            // Add amortization schedule
            if (amortization && amortization.style.display !== 'none') {
                targetWindow.document.write(`
                    <div class="section">
                        ${amortization.innerHTML}
                    </div>
                `);
            }
            
            // Add comparison if exists
            if (comparison) {
                targetWindow.document.write(`
                    <div class="section">
                        <h2>Comparison Analysis</h2>
                        ${comparison.innerHTML}
                    </div>
                `);
            }
            
            // Add analysis if exists
            if (analysis) {
                targetWindow.document.write(`
                    <div class="section">
                        ${analysis.innerHTML}
                    </div>
                `);
            }
            
            // Add footer
            targetWindow.document.write(`
                    <div class="footer">
                        <p class="timestamp">Generated: ${timestamp}</p>
                        <p style="margin: 10px 0;">RapidPercent.com - Professional Financial Calculators</p>
                        <p>Visit https://rapidpercent.com for more free financial tools</p>
                        <div class="disclaimer">
                            <strong>⚠️ Disclaimer:</strong> These calculations are estimates for educational and planning purposes only. 
                            Actual results may vary based on individual circumstances, market conditions, and other factors. 
                            Consult with qualified financial professionals before making important financial decisions.
                        </div>
                    </div>
                </body>
                </html>
            `);
            
            targetWindow.document.close();
            
            // Wait for content to load, then trigger print dialog
            setTimeout(() => {
                targetWindow.focus();
                targetWindow.print();
            }, 500);
        }
        
        async function exportToPDF(calcId) {
			const card = document.getElementById(calcId);
			if (!card) return;

			const title = card.querySelector('h3')?.textContent || 'Calculator Results';
			const resultMain = card.querySelector('.result')?.textContent || '';
			const resultDetailed = card.querySelector('.result-detailed');
			const amortization = card.querySelector('.amortization-schedule');
			const comparison = document.querySelector(`[id$="-comparison"]`);
			const analysis = document.querySelector(`[id$="-analysis"]`);

			let pdfWindow = null;
			let popupBlocked = false;
    
			try {
				pdfWindow = window.open('', '_blank', 'height=800,width=800,scrollbars=yes,resizable=yes');
        
				if (!pdfWindow) {
					popupBlocked = true;
				} else {
					setTimeout(() => {
						try {
							if (pdfWindow.closed || !pdfWindow.document) {
								popupBlocked = true;
							}
						} catch(e) {
							popupBlocked = true;
						}
					}, 100);
				}
			} catch(e) {
				console.warn('Popup blocked:', e);
				popupBlocked = true;
			}

			// ✅ MEJORADO: Esperar más tiempo en dispositivos lentos
				setTimeout(() => {
					// ✅ NUEVO: Verificación más robusta
					let isBlocked = popupBlocked;
    
					if (!isBlocked && pdfWindow) {
						try {
							// Intentar acceder a propiedades del popup
							isBlocked = !pdfWindow.document || pdfWindow.closed || typeof pdfWindow.closed === 'undefined';
						} catch(e) {
							isBlocked = true;
						}
					} else {
						isBlocked = true;
					}
    
					if (isBlocked) {
						// ✅ MEJORADO: Remover modal existente antes de crear uno nuevo
						const existingModal = document.getElementById('pdf-popup-modal');
					if (existingModal) {
						if (DEBUG_MODE) console.log('Removing existing PDF popup modal');
						if (existingModal.parentElement) {
							existingModal.parentElement.removeChild(existingModal);
						}
						// Esperar un frame para asegurar que el DOM se actualice
						await new Promise(resolve => requestAnimationFrame(resolve));
					}
                
					const modalHTML = `
						<div style="position: fixed; inset: 0; background: rgba(0,0,0,0.75); display: flex; align-items: center; justify-content: center; z-index: 999999; backdrop-filter: blur(3px);">
							<div style="background: white; padding: 40px; border-radius: 20px; max-width: 550px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
								<div style="font-size: 3rem; margin-bottom: 15px;">🚫</div>
								<h2 style="color: #dc2626; margin-bottom: 15px; font-size: 1.5rem;">Popup Blocked</h2>
								<p style="margin-bottom: 20px; color: #475569; line-height: 1.7; font-size: 1rem;">
									Your browser blocked the PDF preview window for security. Please choose an option below:
								</p>
								<div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 20px;">
									<button id="pdf-newtab-btn" style="flex: 1; padding: 14px 20px; background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1rem; transition: transform 0.2s;">
										📄 Open in New Tab
									</button>
									<button id="pdf-cancel-btn" style="flex: 1; padding: 14px 20px; background: #94a3b8; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: transform 0.2s;">
										✕ Cancel
									</button>
								</div>
								<div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 15px; text-align: left; font-size: 0.9rem;">
									<p style="color: #92400e; font-weight: 600; margin-bottom: 10px;">💡 How to allow popups:</p>
									<ul style="margin: 0 0 0 20px; color: #78350f; line-height: 1.6;">
										<li><strong>Chrome/Edge:</strong> Click 🚫 icon in address bar → "Always allow"</li>
										<li><strong>Firefox:</strong> Click 🔒 icon → Settings → "Allow pop-ups"</li>
										<li><strong>Safari:</strong> Safari menu → Preferences → Websites → Pop-up Windows</li>
									</ul>
								</div>
							</div>
						</div>
					`;
    
					const modalDiv = document.createElement('div');
					modalDiv.id = 'pdf-popup-modal';
					modalDiv.innerHTML = modalHTML;
					document.body.appendChild(modalDiv);
            
					const newTabBtn = modalDiv.querySelector('#pdf-newtab-btn');
					const cancelBtn = modalDiv.querySelector('#pdf-cancel-btn');
            
					newTabBtn.addEventListener('mouseenter', () => newTabBtn.style.transform = 'scale(1.05)');
					newTabBtn.addEventListener('mouseleave', () => newTabBtn.style.transform = 'scale(1)');
					cancelBtn.addEventListener('mouseenter', () => cancelBtn.style.transform = 'scale(1.05)');
					cancelBtn.addEventListener('mouseleave', () => cancelBtn.style.transform = 'scale(1)');
    
					newTabBtn.onclick = function() {
						document.body.removeChild(modalDiv);
						const newTab = window.open('about:blank', `pdf-${Date.now()}`);
						if (newTab) {
							generatePDFContent(newTab, card, title, resultMain, resultDetailed, amortization, comparison, analysis);
						} else {
							alert('❌ Unable to open new tab. Please check your browser settings and allow popups for this site.');
						}
					};
    
					cancelBtn.onclick = function() {
						if (document.body.contains(modalDiv)) {
							document.body.removeChild(modalDiv);
						}
					};
            
					const handleEscape = function(e) {
						if (e.key === 'Escape' && document.body.contains(modalDiv)) {
							document.body.removeChild(modalDiv);
							document.removeEventListener('keydown', handleEscape);
						}
					};
					document.addEventListener('keydown', handleEscape);
    
					return;
				}
        
				if (pdfWindow && !pdfWindow.closed) {
					generatePDFContent(pdfWindow, card, title, resultMain, resultDetailed, amortization, comparison, analysis);
				}
			}, 250);
		}

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function openModal(modalId) {
			const modal = document.getElementById(modalId);
			if (modal) {
				modal.classList.add('show');
				document.body.style.overflow = 'hidden';

				// ✅ AGREGADO: Guardar elemento que tenía focus
				modal._previousFocus = document.activeElement;

				// Focus trap for accessibility
				const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
				const firstElement = focusableElements[0];
				const lastElement = focusableElements[focusableElements.length - 1];

				if (firstElement) {
					// ✅ MEJORADO: Delay focus para evitar conflictos con animaciones
					setTimeout(() => firstElement.focus(), 100);
				}

				// ✅ MEJORADO: Limpiar listener anterior si existe
				if (modal._tabHandler) {
					modal.removeEventListener('keydown', modal._tabHandler);
					delete modal._tabHandler;
				}

				// Handle Tab key for focus trap
				const handleTabKey = function(e) {
					if (e.key === 'Tab') {
						if (e.shiftKey) {
							if (document.activeElement === firstElement) {
								e.preventDefault();
								lastElement.focus();
							}
						} else {
							if (document.activeElement === lastElement) {
								e.preventDefault();
								firstElement.focus();
							}
						}
					}
					// ✅ AGREGADO: También cerrar con Escape
					if (e.key === 'Escape') {
						closeModal(modalId);
					}
				};

				// ✅ MEJORADO: Usar AbortController para limpiar listeners automáticamente
				if (!modal._abortController) {
					modal._abortController = new AbortController();
				}

				modal.addEventListener('keydown', handleTabKey, { 
					signal: modal._abortController.signal 
				});
			}
		}

		function closeModal(modalId) {
			const modal = document.getElementById(modalId);
			if (modal) {
				modal.classList.remove('show');
				document.body.style.overflow = '';

				// ✅ MEJORADO: Usar AbortController para limpiar todos los listeners
				if (modal._abortController) {
					modal._abortController.abort();
					modal._abortController = null;
				}
        
				modal.removeAttribute('data-has-tab-listener');
        
				// ✅ MEJORADO: Restaurar focus al elemento original
				if (modal._previousFocus && typeof modal._previousFocus.focus === 'function') {
					setTimeout(() => modal._previousFocus.focus(), 100);
					delete modal._previousFocus;
				}
			}
		}

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('info-modal')) {
                event.target.classList.remove('show');
                document.body.style.overflow = '';
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.info-modal.show');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                    document.body.style.overflow = '';
                });
            }
        });

        // ============================================
        // BITCOIN ADDRESS COPY FUNCTION
        // ============================================
        
        function copyBitcoinAddress(button) {
            const address = 'bc1qxfc70kg5gtavn3mw5nypps970hqkzw6c885ya4';
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(address).then(() => {
                    button.textContent = '✓ Copied!';
                    button.style.background = '#059669';
                    setTimeout(() => {
                        button.textContent = 'Copy Address';
                        button.style.background = '#2dd4bf';
                    }, 2000);
                }).catch(() => {
                    copyToClipboardFallback(address, button);
                });
            } else {
                copyToClipboardFallback(address, button);
            }
        }

        function copyToClipboardFallback(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                button.textContent = '✓ Copied!';
                button.style.background = '#059669';
                setTimeout(() => {
                    button.textContent = 'Copy Address';
                    button.style.background = '#2dd4bf';
                }, 2000);
            } catch (err) {
                button.textContent = '✗ Copy failed';
                setTimeout(() => {
                    button.textContent = 'Copy Address';
                }, 2000);
            }
            
            document.body.removeChild(textArea);
        }

        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        // Setup debounced event listeners for all calculators
        document.addEventListener('DOMContentLoaded', function() {
            // Loan Calculator
            ['loan-amount', 'loan-rate', 'loan-term'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateLoan, 'loan', 300));
                }
            });
            
            // Mortgage Calculator
            ['mortgage-price', 'mortgage-down', 'mortgage-rate', 'mortgage-term'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateMortgage, 'mortgage', 300));
                }
            });
            
            // Investment Calculator
            ['invest-initial', 'invest-return', 'invest-years', 'invest-contribution'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateInvestment, 'investment', 300));
                }
            });
            
            // Salary Calculator
            ['salary-gross', 'salary-state', 'salary-deductions'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateSalary, 'salary', 300));
                }
            });
            
            const salaryFiling = document.getElementById('salary-filing');
            if (salaryFiling) {
                salaryFiling.addEventListener('change', calculateSalary);
            }
            
            // Retirement Calculator
            ['retire-age', 'retire-target-age', 'retire-current', 'retire-monthly', 'retire-return', 'retire-inflation'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateRetirement, 'retirement', 300));
                }
            });
			
			// ⬇️ AGREGAR ESTA LÍNEA NUEVA:
			const retireSalaryOptional = document.getElementById('retire-salary-optional');
			if (retireSalaryOptional) {
				retireSalaryOptional.addEventListener('input', debounce(calculateRetirement, 'retirement', 300));
			}
            
            // Car Loan Calculator
            ['car-price', 'car-down', 'car-rate', 'car-term'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateCarLoan, 'carloan', 300));
                }
            });
            
            // Credit Card Calculator
            ['credit-balance', 'credit-apr', 'credit-payment'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateCreditCard, 'credit', 300));
                }
            });
            
            // Budget Calculator
            ['budget-income', 'budget-housing', 'budget-food', 'budget-transport', 'budget-other'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateBudget, 'budget', 300));
                }
            });
            
            // Currency Converter
            ['currency-amount'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateCurrency, 'currency', 500));
                }
            });
            
            ['currency-from', 'currency-to'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.addEventListener('change', calculateCurrency);
                }
            });
            
            // Inflation Calculator
            ['inflation-amount', 'inflation-rate', 'inflation-years'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', debounce(calculateInflation, 'inflation', 300));
                }
            });
            
            // Input validation setup
            const validators = {
				'loan-amount': { min: 0.01, message: 'Please enter a valid amount (greater than $0)' },
				'loan-rate': { min: 0, max: 100, message: 'Please enter a valid rate (0-100)' },
				'loan-term': { min: 1, max: 50, message: 'Please enter a valid term (1-50 years)' },
				'mortgage-price': { min: 0.01, message: 'Please enter a valid price (greater than $0)' },
				'mortgage-down': { min: 0, message: 'Please enter a valid amount' },
				'mortgage-rate': { min: 0, max: 100, message: 'Please enter a valid rate (0-100)' },
				'mortgage-term': { min: 1,max: 50, message: 'Please enter a valid term (1-50 years)' },
				'invest-initial': { min: 0, message: 'Please enter a valid amount' },
				'invest-return': { min: -100, max: 1000, message: 'Please enter a valid return rate' },
				'invest-years': { min: 1, max: 100, message: 'Please enter a valid period (1-100 years)' },
				'invest-contribution': { min: 0, message: 'Please enter a valid amount' },
				'salary-gross': { min: 0.01, message: 'Please enter a valid salary (greater than $0)' },
				'salary-state': { min: 0, max: 15, message: 'Please enter a valid state tax rate (0-15)' },
				'salary-deductions': { min: 0, message: 'Please enter a valid amount' },
				'retire-age': { min: 18, max: 100, message: 'Please enter a valid age (18-100)' },
				'retire-target-age': { min: 18, max: 100, message: 'Please enter a valid retirement age (18-100)' },
				'retire-current': { min: 0, message: 'Please enter a valid amount' },
				'retire-monthly': { min: 0, message: 'Please enter a valid amount' },
				'retire-return': { min: 0, max: 100, message: 'Please enter a valid return rate (0-100)' },
				'retire-inflation': { min: 0, max: 20, message: 'Please enter a valid inflation rate (0-20)' },
				'car-price': { min: 0.01, message: 'Please enter a valid price (greater than $0)' },
				'car-down': { min: 0, message: 'Please enter a valid amount' },
				'car-rate': { min: 0, max: 100, message: 'Please enter a valid rate (0-100)' },
				'car-term': { min: 1, max: 10, message: 'Please enter a valid term (1-10 years)' },
				'credit-balance': { min: 0.01, message: 'Please enter a valid balance (greater than $0)' },
				'credit-apr': { min: 0, max: 100, message: 'Please enter a valid APR (0-100)' },
				'credit-payment': { min: 0.01, message: 'Please enter a valid payment amount (greater than $0)' },
				'budget-income': { min: 0.01, message: 'Please enter a valid income (greater than $0)' },
				'budget-housing': { min: 0, message: 'Please enter a valid amount' },
				'budget-food': { min: 0, message: 'Please enter a valid amount' },
				'budget-transport': { min: 0, message: 'Please enter a valid amount' },
				'budget-other': { min: 0, message: 'Please enter a valid amount' },
				'currency-amount': { min: 0.01, message: 'Please enter a valid amount (greater than 0)' },
				'inflation-amount': { min: 0.01, message: 'Please enter a valid amount (greater than $0)' },
				'inflation-rate': { min: 0, max: 100, message: 'Please enter a valid rate (0-100)' },
				'inflation-years': { min: 1, max: 100, message: 'Please enter a valid period (1-100 years)' }
			};
            
            // Apply validation to all inputs
            Object.keys(validators).forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('blur', function() {
                        const errorId = 'error-' + id;
                        const validator = validators[id];
                        
                        if (this.value === '') {
                            clearError(id, errorId);
                            return;
                        }
                        
                        const value = parseFloat(this.value);
                        
                        if (isNaN(value)) {
                            showError(id, errorId, validator.message);
                        } else if ((validator.min !== undefined && value < validator.min) || 
                                   (validator.max !== undefined && value > validator.max)) {
                            showError(id, errorId, validator.message);
                        } else {
                            clearError(id, errorId);
                        }
                    });
                }
            });
            
            // Sanitize numeric input
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', function(e) {
                    // Allow negative numbers only for investment return
                    const allowNegative = this.id === 'invest-return';
                    if (allowNegative) {
                        this.value = this.value.replace(/[^-0-9.]/g, '');
                    } else {
                        this.value = this.value.replace(/[^0-9.]/g, '');
                    }
                    
                    // Prevent multiple decimal points
                    const parts = this.value.split('.');
                    if (parts.length > 2) {
                        this.value = parts[0] + '.' + parts.slice(1).join('');
                    }
                    
                    // Prevent multiple negative signs
                    if (allowNegative) {
                        const negativeCount = (this.value.match(/-/g) || []).length;
                        if (negativeCount > 1) {
                            this.value = '-' + this.value.replace(/-/g, '');
                        }
                        // Ensure negative sign is at the start
                        if (this.value.indexOf('-') > 0) {
                            this.value = '-' + this.value.replace(/-/g, '');
                        }
                    }
                });
            });
            
            // Prevent form submission on Enter
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        this.blur(); // Trigger blur event for validation
                    }
                });
            });
            
            // Animation on load
            const cards = document.querySelectorAll('.calc-card, .info-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 50);
            });
            
            // Prefetch currency rates on page load (non-blocking)
            setTimeout(() => {
                fetchCurrencyRates().catch(err => {
                    console.warn('Failed to prefetch currency rates:', err);
                });
            }, 1000);
        });

        // ============================================
        // ACCESSIBILITY ENHANCEMENTS
        // ============================================
        
        // Announce dynamic content changes to screen readers
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.className = 'visually-hidden';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        // Add keyboard navigation for calculator cards
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                const focused = document.activeElement;
                if (focused.classList.contains('calc-card') || focused.closest('.calc-card')) {
                    e.preventDefault();
                    const cards = Array.from(document.querySelectorAll('.calc-card'));
                    const currentCard = focused.classList.contains('calc-card') ? focused : focused.closest('.calc-card');
                    const currentIndex = cards.indexOf(currentCard);
                    const nextIndex = e.key === 'ArrowDown' ? currentIndex + 1 : currentIndex - 1;
                    
                    if (nextIndex >= 0 && nextIndex < cards.length) {
                        const nextCard = cards[nextIndex];
                        const firstInput = nextCard.querySelector('input[type="number"]');
                        if (firstInput) {
                            firstInput.focus();
                        } else {
                            nextCard.focus();
                        }
                    }
                }
            }
        });

        // ============================================
        // PERFORMANCE OPTIMIZATIONS
        // ============================================
        
        // Intersection Observer for lazy loading
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });
            
            document.querySelectorAll('.calc-card, .info-card').forEach(card => {
                observer.observe(card);
            });
        }

        // ✅ MEJORADO: Cleanup comprehensivo on page unload
window.addEventListener('beforeunload', function() {
    // Destroy all chart instances
    Object.keys(chartInstances).forEach(chartId => {
        destroyChart(chartId);
    });
    
    // Clear any pending debounce timers
    Object.keys(debounceTimers).forEach(key => {
        clearTimeout(debounceTimers[key]);
        delete debounceTimers[key]; // ✅ Remover referencia
    });
    
    // ✅ AGREGADO: Cancel pending currency request
    if (currencyCalculationController) {
        currencyCalculationController.cancelled = true;
        currencyCalculationController = null;
    }
    
    // ✅ AGREGADO: Clear modal listeners
    const modals = document.querySelectorAll('.info-modal');
    modals.forEach(modal => {
        if (modal._tabHandler) {
            modal.removeEventListener('keydown', modal._tabHandler);
            delete modal._tabHandler;
        }
        modal.removeAttribute('data-has-tab-listener');
    });
    
    // ✅ AGREGADO: Clear any open PDF modals
    const pdfModal = document.getElementById('pdf-popup-modal');
    if (pdfModal && pdfModal.parentElement) {
        pdfModal.parentElement.removeChild(pdfModal);
    }
});

        // ============================================
        // ERROR HANDLING
        // ============================================
        
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            // Don't show errors to users, just log them for debugging
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
        });

        // ============================================
        // CONSOLE MESSAGE
        // ============================================
        
        console.log('%c\uD83D\uDCB0 RapidPercent Financial Calculators', 'font-size: 20px; font-weight: bold; color: #2dd4bf;');
		console.log('%cProfessional-grade financial calculators with real-time data', 'font-size: 14px; color: #475569;');
		console.log('%cFeatures: Live exchange rates, progressive tax calculation, compound interest visualization, and more!', 'font-size: 12px; color: #6b7280;');
		console.log('%c\u00A9 2025 RapidPercent.com', 'font-size: 10px; color: #9ca3af;');
		
		// ============================================
        // CLEANUP ON PAGE UNLOAD
        // ============================================
        window.addEventListener('beforeunload', function() {
            if (DEBUG_MODE) console.log('🧹 Cleaning up...');
            
            // Destroy charts
            Object.keys(chartInstances).forEach(chartId => {
                destroyChart(chartId);
            });
            
            // Clear timers
            Object.keys(debounceTimers).forEach(key => {
                clearTimeout(debounceTimers[key]);
                delete debounceTimers[key];
            });
            
            // Cancel currency requests
            if (currencyCalculationController) {
                currencyCalculationController.cancelled = true;
                currencyCalculationController = null;
            }
            
            // Clean modals
            const modals = document.querySelectorAll('.info-modal');
            modals.forEach(modal => {
                if (modal._tabHandler) {
                    modal.removeEventListener('keydown', modal._tabHandler);
                    delete modal._tabHandler;
                }
            });
        });
        
        // Manual cleanup function
        function cleanupCalculators() {
            Object.keys(debounceTimers).forEach(key => {
                clearTimeout(debounceTimers[key]);
                delete debounceTimers[key];
            });
            if (currencyCalculationController) {
                currencyCalculationController.cancelled = true;
                currencyCalculationController = null;
            }
            Object.keys(chartInstances).forEach(chartId => destroyChart(chartId));
        }
        
        if (typeof window !== 'undefined') {
            window.cleanupCalculators = cleanupCalculators;
        }
    </script>
</body>
</html>